!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("ethers")):"function"==typeof define&&define.amd?define(["exports","ethers"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).sequence={},e.ethers)}(this,(function(e,t){"use strict";const n={erc1271:Object.freeze({__proto__:null,abi:[{type:"function",name:"isValidSignature",constant:!0,inputs:[{type:"bytes32"},{type:"bytes"}],outputs:[{type:"bytes4"}],payable:!1,stateMutability:"view"}],returns:{isValidSignatureBytes32:"0x1626ba7e"}}),factory:Object.freeze({__proto__:null,abi:[{type:"function",name:"deploy",constant:!1,inputs:[{type:"address"},{type:"bytes32"}],outputs:[],payable:!0,stateMutability:"payable"}]}),mainModule:Object.freeze({__proto__:null,abi:[{type:"function",name:"nonce",constant:!0,inputs:[],outputs:[{type:"uint256"}],payable:!1,stateMutability:"view"},{type:"function",name:"readNonce",constant:!0,inputs:[{type:"uint256"}],outputs:[{type:"uint256"}],payable:!1,stateMutability:"view"},{type:"function",name:"updateImplementation",constant:!1,inputs:[{type:"address"}],outputs:[],payable:!1,stateMutability:"nonpayable"},{type:"function",name:"selfExecute",constant:!1,inputs:[{components:[{type:"bool",name:"delegateCall"},{type:"bool",name:"revertOnError"},{type:"uint256",name:"gasLimit"},{type:"address",name:"target"},{type:"uint256",name:"value"},{type:"bytes",name:"data"}],type:"tuple[]"}],outputs:[],payable:!1,stateMutability:"nonpayable"},{type:"function",name:"execute",constant:!1,inputs:[{components:[{type:"bool",name:"delegateCall"},{type:"bool",name:"revertOnError"},{type:"uint256",name:"gasLimit"},{type:"address",name:"target"},{type:"uint256",name:"value"},{type:"bytes",name:"data"}],type:"tuple[]"},{type:"uint256"},{type:"bytes"}],outputs:[],payable:!1,stateMutability:"nonpayable"},{type:"function",name:"createContract",inputs:[{type:"bytes"}],payable:!0,stateMutability:"payable"}]}),mainModuleUpgradable:Object.freeze({__proto__:null,abi:[{type:"function",name:"updateImageHash",constant:!0,inputs:[{type:"bytes32"}],outputs:[],payable:!1,stateMutability:"view"},{type:"function",name:"imageHash",constant:!0,inputs:[],outputs:[{type:"bytes32"}],payable:!1,stateMutability:"view"}]}),sequenceUtils:Object.freeze({__proto__:null,abi:[{inputs:[{internalType:"address",name:"_factory",type:"address"},{internalType:"address",name:"_mainModule",type:"address"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"_wallet",type:"address"},{indexed:!0,internalType:"bytes32",name:"_imageHash",type:"bytes32"},{indexed:!1,internalType:"uint256",name:"_threshold",type:"uint256"},{indexed:!1,internalType:"bytes",name:"_signers",type:"bytes"}],name:"RequiredConfig",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"_wallet",type:"address"},{indexed:!0,internalType:"address",name:"_signer",type:"address"}],name:"RequiredSigner",type:"event"},{inputs:[{internalType:"address",name:"_addr",type:"address"}],name:"callBalanceOf",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"callBlockNumber",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"_i",type:"uint256"}],name:"callBlockhash",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"callChainId",outputs:[{internalType:"uint256",name:"id",type:"uint256"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"address",name:"_addr",type:"address"}],name:"callCode",outputs:[{internalType:"bytes",name:"code",type:"bytes"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_addr",type:"address"}],name:"callCodeHash",outputs:[{internalType:"bytes32",name:"codeHash",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_addr",type:"address"}],name:"callCodeSize",outputs:[{internalType:"uint256",name:"size",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"callCoinbase",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"callDifficulty",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"callGasLeft",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"callGasLimit",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"callGasPrice",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"callOrigin",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"callTimestamp",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"knownImageHashes",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"",type:"bytes32"}],name:"lastImageHashUpdate",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"lastSignerUpdate",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"lastWalletUpdate",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{components:[{internalType:"bool",name:"delegateCall",type:"bool"},{internalType:"bool",name:"revertOnError",type:"bool"},{internalType:"uint256",name:"gasLimit",type:"uint256"},{internalType:"address",name:"target",type:"address"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"bytes",name:"data",type:"bytes"}],internalType:"struct IModuleCalls.Transaction[]",name:"_txs",type:"tuple[]"}],name:"multiCall",outputs:[{internalType:"bool[]",name:"_successes",type:"bool[]"},{internalType:"bytes[]",name:"_results",type:"bytes[]"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"_wallet",type:"address"},{internalType:"uint256",name:"_threshold",type:"uint256"},{components:[{internalType:"uint256",name:"weight",type:"uint256"},{internalType:"address",name:"signer",type:"address"}],internalType:"struct RequireUtils.Member[]",name:"_members",type:"tuple[]"},{internalType:"bool",name:"_index",type:"bool"}],name:"publishConfig",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_wallet",type:"address"},{internalType:"bytes32",name:"_hash",type:"bytes32"},{internalType:"uint256",name:"_sizeMembers",type:"uint256"},{internalType:"bytes",name:"_signature",type:"bytes"},{internalType:"bool",name:"_index",type:"bool"}],name:"publishInitialSigners",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_wallet",type:"address"},{internalType:"uint256",name:"_nonce",type:"uint256"}],name:"requireMinNonce",outputs:[],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"_expiration",type:"uint256"}],name:"requireNonExpired",outputs:[],stateMutability:"view",type:"function"}]}),requireFreshSigner:Object.freeze({__proto__:null,abi:[{inputs:[{internalType:"address",name:"",type:"address"}],name:"requireFreshSigner",outputs:[],stateMutability:"nonpayable",type:"function"}]})};var s=Object.freeze({__proto__:null,walletContracts:n});function i(){return i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},i.apply(this,arguments)}let r,a,o;!function(e){e.UNKNOWN="UNKNOWN",e.RUNNING_CHECKS="RUNNING_CHECKS",e.PROCESSING="PROCESSING",e.FAILED="FAILED",e.COMPLETE="COMPLETE"}(r||(r={})),function(e){e.UNKNOWN="UNKNOWN",e.SUCCESSFUL="SUCCESSFUL",e.FAILED="FAILED"}(a||(a={})),function(e){e.DESC="DESC",e.ASC="ASC"}(o||(o={}));class c{constructor(e,t){this.hostname=void 0,this.fetch=void 0,this.path="/rpc/API/",this.ping=e=>this.fetch(this.url("Ping"),l({},e)).then((e=>h(e).then((e=>({status:e.status}))))),this.version=e=>this.fetch(this.url("Version"),l({},e)).then((e=>h(e).then((e=>({version:e.version}))))),this.runtimeStatus=e=>this.fetch(this.url("RuntimeStatus"),l({},e)).then((e=>h(e).then((e=>({status:e.status}))))),this.getSequenceContext=e=>this.fetch(this.url("GetSequenceContext"),l({},e)).then((e=>h(e).then((e=>({data:e.data}))))),this.getAuthToken=(e,t)=>this.fetch(this.url("GetAuthToken"),l(e,t)).then((e=>h(e).then((e=>({status:e.status,jwtToken:e.jwtToken,address:e.address,user:e.user}))))),this.sendPasswordlessLink=(e,t)=>this.fetch(this.url("SendPasswordlessLink"),l(e,t)).then((e=>h(e).then((e=>({status:e.status}))))),this.friendList=(e,t)=>this.fetch(this.url("FriendList"),l(e,t)).then((e=>h(e).then((e=>({page:e.page,friends:e.friends}))))),this.getFriendByAddress=(e,t)=>this.fetch(this.url("GetFriendByAddress"),l(e,t)).then((e=>h(e).then((e=>({status:e.status,friend:e.friend}))))),this.searchFriends=(e,t)=>this.fetch(this.url("SearchFriends"),l(e,t)).then((e=>h(e).then((e=>({friends:e.friends}))))),this.addFriend=(e,t)=>this.fetch(this.url("AddFriend"),l(e,t)).then((e=>h(e).then((e=>({status:e.status,friend:e.friend}))))),this.updateFriendNickname=(e,t)=>this.fetch(this.url("UpdateFriendNickname"),l(e,t)).then((e=>h(e).then((e=>({status:e.status,friend:e.friend}))))),this.removeFriend=(e,t)=>this.fetch(this.url("RemoveFriend"),l(e,t)).then((e=>h(e).then((e=>({status:e.status}))))),this.contractCall=(e,t)=>this.fetch(this.url("ContractCall"),l(e,t)).then((e=>h(e).then((e=>({returns:e.returns}))))),this.decodeContractCall=(e,t)=>this.fetch(this.url("DecodeContractCall"),l(e,t)).then((e=>h(e).then((e=>({call:e.call}))))),this.lookupContractCallSelectors=(e,t)=>this.fetch(this.url("LookupContractCallSelectors"),l(e,t)).then((e=>h(e).then((e=>({signatures:e.signatures}))))),this.userStorageFetch=(e,t)=>this.fetch(this.url("UserStorageFetch"),l(e,t)).then((e=>h(e).then((e=>({object:e.object}))))),this.userStorageSave=(e,t)=>this.fetch(this.url("UserStorageSave"),l(e,t)).then((e=>h(e).then((e=>({ok:e.ok}))))),this.userStorageDelete=(e,t)=>this.fetch(this.url("UserStorageDelete"),l(e,t)).then((e=>h(e).then((e=>({ok:e.ok}))))),this.userStorageFetchAll=(e,t)=>this.fetch(this.url("UserStorageFetchAll"),l(e,t)).then((e=>h(e).then((e=>({objects:e.objects}))))),this.getMoonpayLink=(e,t)=>this.fetch(this.url("GetMoonpayLink"),l(e,t)).then((e=>h(e).then((e=>({signedUrl:e.signedUrl}))))),this.getSardineClientToken=e=>this.fetch(this.url("GetSardineClientToken"),l({},e)).then((e=>h(e).then((e=>({token:e.token}))))),this.isUsingGoogleMail=(e,t)=>this.fetch(this.url("IsUsingGoogleMail"),l(e,t)).then((e=>h(e).then((e=>({yes:e.yes}))))),this.isValidSignature=(e,t)=>this.fetch(this.url("IsValidSignature"),l(e,t)).then((e=>h(e).then((e=>({isValid:e.isValid}))))),this.isValidMessageSignature=(e,t)=>this.fetch(this.url("IsValidMessageSignature"),l(e,t)).then((e=>h(e).then((e=>({isValid:e.isValid}))))),this.isValidTypedDataSignature=(e,t)=>this.fetch(this.url("IsValidTypedDataSignature"),l(e,t)).then((e=>h(e).then((e=>({isValid:e.isValid}))))),this.isValidETHAuthProof=(e,t)=>this.fetch(this.url("IsValidETHAuthProof"),l(e,t)).then((e=>h(e).then((e=>({isValid:e.isValid}))))),this.getCoinPrices=(e,t)=>this.fetch(this.url("GetCoinPrices"),l(e,t)).then((e=>h(e).then((e=>({tokenPrices:e.tokenPrices}))))),this.getCollectiblePrices=(e,t)=>this.fetch(this.url("GetCollectiblePrices"),l(e,t)).then((e=>h(e).then((e=>({tokenPrices:e.tokenPrices}))))),this.getExchangeRate=(e,t)=>this.fetch(this.url("GetExchangeRate"),l(e,t)).then((e=>h(e).then((e=>({exchangeRate:e.exchangeRate}))))),this.listPayCardsOnFile=e=>this.fetch(this.url("ListPayCardsOnFile"),l({},e)).then((e=>h(e).then((e=>({payCards:e.payCards}))))),this.savePayCard=(e,t)=>this.fetch(this.url("SavePayCard"),l(e,t)).then((e=>h(e).then((e=>({ok:e.ok,payCard:e.payCard}))))),this.updatePayCardCVC=(e,t)=>this.fetch(this.url("UpdatePayCardCVC"),l(e,t)).then((e=>h(e).then((e=>({ok:e.ok}))))),this.deletePayCard=(e,t)=>this.fetch(this.url("DeletePayCard"),l(e,t)).then((e=>h(e).then((e=>({ok:e.ok}))))),this.smartRampQuote=(e,t)=>this.fetch(this.url("SmartRampQuote"),l(e,t)).then((e=>h(e).then((e=>({status:e.status,quoteDetails:e.quoteDetails}))))),this.smartRampPurchase=(e,t)=>this.fetch(this.url("SmartRampPurchase"),l(e,t)).then((e=>h(e).then((e=>({processing:e.processing,receipt:e.receipt}))))),this.smartRampWaitOrderConfirmation=(e,t)=>this.fetch(this.url("SmartRampWaitOrderConfirmation"),l(e,t)).then((e=>h(e).then((e=>({done:e.done,receipt:e.receipt}))))),this.smartRampGetOrder=(e,t)=>this.fetch(this.url("SmartRampGetOrder"),l(e,t)).then((e=>h(e).then((e=>({order:e.order}))))),this.smartRampCheckCardAuthorization=(e,t)=>this.fetch(this.url("SmartRampCheckCardAuthorization"),l(e,t)).then((e=>h(e).then((e=>({cardAuth:e.cardAuth}))))),this.smartRampOrdersList=(e,t)=>this.fetch(this.url("SmartRampOrdersList"),l(e,t)).then((e=>h(e).then((e=>({page:e.page,orders:e.orders}))))),this.smartRampGetOrderTxnHash=(e,t)=>this.fetch(this.url("SmartRampGetOrderTxnHash"),l(e,t)).then((e=>h(e).then((e=>({txnHash:e.txnHash,txnSuccessful:e.txnSuccessful}))))),this.smartRampSubmitCardAuthorization=(e,t)=>this.fetch(this.url("SmartRampSubmitCardAuthorization"),l(e,t)).then((e=>h(e).then((e=>({status:e.status}))))),this.adminSmartRampGetOrder=(e,t)=>this.fetch(this.url("AdminSmartRampGetOrder"),l(e,t)).then((e=>h(e).then((e=>({order:e.order}))))),this.adminSmartRampListCompletedOrders=(e,t)=>this.fetch(this.url("AdminSmartRampListCompletedOrders"),l(e,t)).then((e=>h(e).then((e=>({orders:e.orders}))))),this.adminSmartRampListPendingOrders=(e,t)=>this.fetch(this.url("AdminSmartRampListPendingOrders"),l(e,t)).then((e=>h(e).then((e=>({pendingOrders:e.pendingOrders}))))),this.getInviteInfo=e=>this.fetch(this.url("GetInviteInfo"),l({},e)).then((e=>h(e).then((e=>({inviteInfo:e.inviteInfo}))))),this.isValidAccessCode=(e,t)=>this.fetch(this.url("IsValidAccessCode"),l(e,t)).then((e=>h(e).then((e=>({status:e.status}))))),this.internalClaimAccessCode=(e,t)=>this.fetch(this.url("InternalClaimAccessCode"),l(e,t)).then((e=>h(e).then((e=>({status:e.status}))))),this.walletRecover=(e,t)=>this.fetch(this.url("WalletRecover"),l(e,t)).then((e=>h(e).then((e=>({encryptedWallet:e.encryptedWallet}))))),this.blockNumberAtTime=(e,t)=>this.fetch(this.url("BlockNumberAtTime"),l(e,t)).then((e=>h(e).then((e=>({blocks:e.blocks}))))),this.hostname=e,this.fetch=(e,n)=>t(e,n)}url(e){return this.hostname+this.path+e}}const l=(e={},t={})=>({method:"POST",headers:i({},t,{"Content-Type":"application/json"}),body:JSON.stringify(e||{})}),h=e=>e.text().then((t=>{let n;try{n=JSON.parse(t)}catch(n){throw{code:"unknown",msg:`expecting JSON, got: ${t}`,status:e.status}}if(!e.ok)throw n;return n}));class d extends c{constructor(e,t){super(e.endsWith("/")?e.slice(0,-1):e,global.fetch),this.jwtAuth=t,this._fetch=(e,t)=>{const n={};return this.jwtAuth&&this.jwtAuth.length>0&&(n.Authorization=`BEARER ${this.jwtAuth}`),t.headers=i({},t.headers,n),global.fetch(e,t)},this.fetch=this._fetch}}var u=Object.freeze({__proto__:null,WebRPCVersion:"v1",WebRPCSchemaVersion:"v0.4.0",WebRPCSchemaHash:"8e34a4b927a5faab07d6558c21251a5218b82ac4",get SmartRampOrderStatus(){return r},get SmartRampTxnStatus(){return a},get SortOrder(){return o},API:c,SequenceAPIClient:d});const p="function"==typeof atob,g="function"==typeof btoa,f="function"==typeof Buffer,w="function"==typeof TextDecoder?new TextDecoder:void 0,m="function"==typeof TextEncoder?new TextEncoder:void 0,y=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),v=(e=>{let t={};return e.forEach(((e,n)=>t[e]=n)),t})(y),b=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,C=String.fromCharCode.bind(String),E="function"==typeof Uint8Array.from?Uint8Array.from.bind(Uint8Array):(e,t=(e=>e))=>new Uint8Array(Array.prototype.slice.call(e,0).map(t)),_=e=>e.replace(/=/g,"").replace(/[+\/]/g,(e=>"+"==e?"-":"_")),k=e=>e.replace(/[^A-Za-z0-9\+\/]/g,""),S=e=>{let t,n,s,i,r="";const a=e.length%3;for(let a=0;a<e.length;){if((n=e.charCodeAt(a++))>255||(s=e.charCodeAt(a++))>255||(i=e.charCodeAt(a++))>255)throw new TypeError("invalid character found");t=n<<16|s<<8|i,r+=y[t>>18&63]+y[t>>12&63]+y[t>>6&63]+y[63&t]}return a?r.slice(0,a-3)+"===".substring(a):r},I=g?e=>btoa(e):f?e=>Buffer.from(e,"binary").toString("base64"):S,N=f?e=>Buffer.from(e).toString("base64"):e=>{let t=[];for(let n=0,s=e.length;n<s;n+=4096)t.push(C.apply(null,e.subarray(n,n+4096)));return I(t.join(""))},T=e=>{if(e.length<2)return(t=e.charCodeAt(0))<128?e:t<2048?C(192|t>>>6)+C(128|63&t):C(224|t>>>12&15)+C(128|t>>>6&63)+C(128|63&t);var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return C(240|t>>>18&7)+C(128|t>>>12&63)+C(128|t>>>6&63)+C(128|63&t)},x=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,A=e=>e.replace(x,T),O=f?e=>Buffer.from(e,"utf8").toString("base64"):m?e=>N(m.encode(e)):e=>I(A(e)),P=(e,t=!1)=>t?_(O(e)):O(e),R=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,M=e=>{switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return C(55296+(t>>>10))+C(56320+(1023&t));case 3:return C((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return C((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},L=e=>e.replace(R,M),U=e=>{if(e=e.replace(/\s+/g,""),!b.test(e))throw new TypeError("malformed base64.");e+="==".slice(2-(3&e.length));let t,n,s,i="";for(let r=0;r<e.length;)t=v[e.charAt(r++)]<<18|v[e.charAt(r++)]<<12|(n=v[e.charAt(r++)])<<6|(s=v[e.charAt(r++)]),i+=64===n?C(t>>16&255):64===s?C(t>>16&255,t>>8&255):C(t>>16&255,t>>8&255,255&t);return i},D=p?e=>atob(k(e)):f?e=>Buffer.from(e,"base64").toString("binary"):U,q=f?e=>E(Buffer.from(e,"base64")):e=>E(D(e),(e=>e.charCodeAt(0))),W=f?e=>Buffer.from(e,"base64").toString("utf8"):w?e=>w.decode(q(e)):e=>L(D(e)),B=e=>k(e.replace(/[-_]/g,(e=>"-"==e?"+":"/"))),F=e=>W(B(e)),G=P,j=F;var $=function(){return $=Object.assign||function(e){for(var t,n=1,s=arguments.length;n<s;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},$.apply(this,arguments)};function H(e,t,n,s){return new(n||(n=Promise))((function(i,r){function a(e){try{c(s.next(e))}catch(e){r(e)}}function o(e){try{c(s.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((s=s.apply(e,t||[])).next())}))}function V(e,t){var n,s,i,r,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function o(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,o[0]&&(a=0)),a;)try{if(n=1,s&&(i=2&o[0]?s.return:o[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,o[1])).done)return i;switch(s=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,s=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],s=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}}var J=function(){function e(e){this.prefix=X,this.address=(null==e?void 0:e.address)?e.address.toLowerCase():"",this.claims=(null==e?void 0:e.claims)?e.claims:{app:"",iat:0,exp:0,v:Q},this.signature=(null==e?void 0:e.signature)?e.signature:"",this.extra=(null==e?void 0:e.extra)?e.extra:""}return e.prototype.setIssuedAtNow=function(){this.claims.iat=Math.round((new Date).getTime()/1e3)},e.prototype.setExpiryIn=function(e){this.claims.exp=Math.round((new Date).getTime()/1e3)+e},e.prototype.validateClaims=function(){return K(this.claims)},e.prototype.messageDigest=function(){var e,n=this.validateClaims();if(n.err)throw n.err;return t.ethers.utils.arrayify((e=this.messageTypedData(),t.ethers.utils._TypedDataEncoder.hash(e.domain,e.types,e.message)))},e.prototype.messageTypedData=function(){var e={domain:$({},ee),types:{Claims:[]},message:{}};return this.claims.app&&this.claims.app.length>0&&(e.types.Claims.push({name:"app",type:"string"}),e.message.app=this.claims.app),this.claims.iat&&this.claims.iat>0&&(e.types.Claims.push({name:"iat",type:"int64"}),e.message.iat=this.claims.iat),this.claims.exp&&this.claims.exp>0&&(e.types.Claims.push({name:"exp",type:"int64"}),e.message.exp=this.claims.exp),this.claims.n&&this.claims.n>0&&(e.types.Claims.push({name:"n",type:"uint64"}),e.message.n=this.claims.n),this.claims.typ&&this.claims.typ.length>0&&(e.types.Claims.push({name:"typ",type:"string"}),e.message.typ=this.claims.typ),this.claims.ogn&&this.claims.ogn.length>0&&(e.types.Claims.push({name:"ogn",type:"string"}),e.message.ogn=this.claims.ogn),this.claims.v&&this.claims.v.length>0&&(e.types.Claims.push({name:"v",type:"string"}),e.message.v=this.claims.v),e},e}(),K=function(e){if(""===e.app)return{ok:!1,err:new Error("claims: app is empty")};var t=Math.round((new Date).getTime()/1e3),n=31536300;return""===e.v?{ok:!1,err:new Error("claims: ethauth version is empty")}:e.iat&&0!==e.iat&&(e.iat>t+300||e.iat<t-n)?{ok:!1,err:new Error("claims: iat is invalid")}:e.exp<t-300||e.exp>t+n?{ok:!1,err:new Error("claims: token has expired")}:{ok:!0}},z=function(e,n,s){return H(void 0,void 0,void 0,(function(){var e,n;return V(this,(function(i){return e=s.messageDigest(),"0x"===(n=t.ethers.utils.verifyMessage(e,s.signature)).slice(0,2)&&42===n.length&&n.toLowerCase()===s.address.toLowerCase()?[2,{isValid:!0,address:s.address}]:[2,{isValid:!1}]}))}))},Z=function(e,n,s){return H(void 0,void 0,void 0,(function(){var n,i,r;return V(this,(function(a){switch(a.label){case 0:return e&&void 0!==e?(n=s.messageDigest(),[4,e.getCode(s.address)]):[2,{isValid:!1}];case 1:if("0x"===(i=a.sent())||i.length<=2)throw new Error("ValidateContractAccountProof failed. unable to fetch wallet contract code");return r=["function isValidSignature(bytes32, bytes) public view returns (bytes4)"],[4,new t.ethers.Contract(s.address,r,e).isValidSignature(n,t.ethers.utils.arrayify(s.signature))];case 2:return a.sent()===Y?[2,{isValid:!0,address:s.address}]:[2,{isValid:!1}]}}))}))},Y="0x1626ba7e",Q="1",X="eth",ee={name:"ETHAuth",version:Q},te=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var s=this;this.configJsonRpcProvider=function(e){return H(s,void 0,void 0,(function(){var n;return V(this,(function(s){switch(s.label){case 0:return this.provider=new t.ethers.providers.JsonRpcProvider(e),[4,this.provider.send("net_version",[])];case 1:if(n=s.sent(),this.chainId=parseInt(n),!this.chainId||0===this.chainId||NaN===this.chainId)throw new Error("ethauth: unable to get chainId");return this.ethereumJsonRpcURL=e,[2]}}))}))},this.configValidators=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(0==e.length)throw new Error("validators list is empty");s.validators=e},this.encodeProof=function(e,t){return void 0===t&&(t=!1),H(s,void 0,void 0,(function(){var n,s;return V(this,(function(i){switch(i.label){case 0:if(42!==e.address.length||"0x"!==e.address.slice(0,2))throw new Error("ethauth: invalid address");if(""===e.signature||"0x"!==e.signature.slice(0,2))throw new Error("ethauth: invalid signature");if(e.extra&&"0x"!==e.extra.slice(0,2))throw new Error("ethauth: invalid extra encoding, expecting hex data");return[4,this.validateProof(e,t)];case 1:if(!i.sent())throw new Error("ethauth: proof is invalid");return n=JSON.stringify(e.claims),s=X+"."+e.address.toLowerCase()+"."+G(n,!0)+"."+e.signature,e.extra&&e.extra.length>0&&(s+="."+e.extra),[2,s]}}))}))},this.decodeProof=function(e,t){return void 0===t&&(t=!1),H(s,void 0,void 0,(function(){var n,s,i,r,a,o,c,l,h;return V(this,(function(d){switch(d.label){case 0:if((n=e.split(".")).length<4||n.length>5)throw new Error("ethauth: invalid proof string");if(s=n[0],i=n[1],r=n[2],a=n[3],o=n[4],s!==X)throw new Error("ethauth: not an ethauth proof");return c=j(r),l=JSON.parse(c),h=new J({address:i,claims:l,signature:a,extra:o}),[4,this.validateProof(h,t)];case 1:if(!d.sent())throw new Error("ethauth: proof is invalid");return[2,h]}}))}))},this.validateProof=function(e,t){return void 0===t&&(t=!1),H(s,void 0,void 0,(function(){var n;return V(this,(function(s){switch(s.label){case 0:if((n=this.validateProofClaims(e)).err)throw new Error("ethauth: proof claims are invalid ".concat(n.err));return!0===t?[3,2]:[4,this.validateProofSignature(e)];case 1:if(!0!==s.sent())throw new Error("ethauth: proof signature is invalid");s.label=2;case 2:return[2,!0]}}))}))},this.validateProofSignature=function(e){return H(s,void 0,void 0,(function(){var t,n,s;return V(this,(function(i){switch(i.label){case 0:t=[],s=0,i.label=1;case 1:if(!(s<this.validators.length))return[3,6];i.label=2;case 2:return i.trys.push([2,4,,5]),[4,(0,this.validators[s])(this.provider,this.chainId,e)];case 3:return!0===(n=i.sent().isValid)?[2,!0]:(t.push(n),[3,5]);case 4:return i.sent(),t.push(!1),[3,5];case 5:return s++,[3,1];case 6:for(s=0;s<t.length;s++)if(t[s])return[2,!0];return[2,!1]}}))}))},this.validateProofClaims=function(e){return e.validateClaims()},0==e.length?this.validators=[z,Z]:this.validators=e};const ne="0x603a600e3d39601a805130553df3363d3d373d3d3d363d30545af43d82803e903d91601857fd5bf3",se="@sequence.config.imageHashes",ie=e=>`@sequence.config.${e}`;let re;try{re=localStorage}catch(e){const t=new Map;re={getItem:e=>{var n;return null!=(n=t.get(e))?n:null},setItem:(e,n)=>t.set(e,n),removeItem:e=>t.delete(e)}}function ae(e){var t;const n=JSON.parse(null!=(t=re.getItem(ie(e)))?t:"null");return n?(oe(e),n):void 0}function oe(e){var t;let n=JSON.parse(null!=(t=re.getItem(se))?t:"[]");for(n=n.filter((t=>t!==e)),n.push(e);n.length>10;)re.removeItem(ie(n.shift()));re.setItem(se,JSON.stringify(n))}const ce=e=>e.signers.reduce(((e,n)=>t.ethers.BigNumber.from(n.weight).add(e)),t.ethers.constants.Zero).gte(t.ethers.BigNumber.from(e.threshold)),le=(e,n,s=!1)=>{if("string"==typeof e){const s=t.ethers.utils.keccak256(t.ethers.utils.solidityPack(["bytes","bytes32"],[ne,t.ethers.utils.hexZeroPad(n.mainModule,32)])),i=t.ethers.utils.keccak256(t.ethers.utils.solidityPack(["bytes1","address","bytes32","bytes32"],["0xff",n.factory,e,s]));return t.ethers.utils.getAddress(t.ethers.utils.hexDataSlice(i,12))}return e.address&&!s?e.address:le(he(e),n)},he=e=>{const n=(e=de(e)).signers.reduce(((e,n)=>t.ethers.utils.keccak256(t.ethers.utils.defaultAbiCoder.encode(["bytes32","uint8","address"],[e,n.weight,n.address]))),t.ethers.utils.solidityPack(["uint256"],[e.threshold]));return function(e,t){re.setItem(ie(e),JSON.stringify(t)),oe(e)}(n,e),n},de=e=>{e.signers.sort(((e,t)=>pe(e.address,t.address))),e.signers.forEach((e=>e.address=t.ethers.utils.getAddress(e.address))),e.address&&(e.address=t.ethers.utils.getAddress(e.address));const n=e.signers.map((e=>e.address));if(n.filter(((e,t)=>n.indexOf(e)!==t)).length>0)throw new Error("invalid wallet config: duplicate signer addresses detected in the config, ${signerDupes}");return e},ue=(e,t)=>he(e)===he(t),pe=(e,n)=>{const s=t.ethers.BigNumber.from(e),i=t.ethers.BigNumber.from(n);return s.lt(i)?-1:s.eq(i)?0:1};function ge(e,n){const s=e=>({weight:t.ethers.BigNumber.from(e.weight).toNumber(),address:t.ethers.utils.getAddress(e.address)}),i=e.signers.map(s),r=n.set?n.set.map(s):[],a=n.del?n.del.map((e=>t.ethers.utils.getAddress(e.address))):[],o=r.map((e=>e.address)),c=i.filter((e=>-1===a.indexOf(e.address)&&-1===o.indexOf(e.address))).concat(...r);return de({address:e.address,threshold:n.threshold?t.ethers.BigNumber.from(n.threshold).toNumber():e.threshold,signers:c})}function fe(e,n){return de({threshold:t.ethers.BigNumber.from(e).toNumber(),signers:n.map((e=>({weight:t.ethers.BigNumber.from(e.weight).toNumber(),address:t.ethers.utils.getAddress(e.address)})))})}const we=e=>G(JSON.stringify(e),!0),me=e=>{if(null!=e)return JSON.parse(j(e))},ye=e=>"string"==typeof e?t.ethers.utils.arrayify(t.ethers.utils.keccak256(t.ethers.utils.toUtf8Bytes(e))):t.ethers.utils.arrayify(t.ethers.utils.keccak256(e)),ve=(e,n,s)=>t.ethers.utils.solidityPack(["string","uint256","address","bytes32"],["",n,e,s]),be=(e,n,s)=>t.ethers.utils.keccak256(ve(e,n,s)),Ce=()=>!1,Ee=e=>{const t=e.split(".");if(3!==t.length)throw new Error("invalid jwt");return JSON.parse(j(t[1]))};var _e;!function(e){e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.DISABLED=5]="DISABLED"}(_e||(_e={}));class ke{constructor(e){this.config=e,this.logLevel=void 0,this.configure(e)}configure(e){switch(this.config=i({},this.config,e),this.config.logLevel){case"DEBUG":this.logLevel=_e.DEBUG;break;case"INFO":default:this.logLevel=_e.INFO;break;case"WARN":this.logLevel=_e.WARN;break;case"ERROR":this.logLevel=_e.ERROR;break;case"DISABLED":this.logLevel=_e.DISABLED}void 0===this.config.silence&&(this.config.silence=!1)}debug(e,...t){!0!==this.config.silence&&this.logLevel===_e.DEBUG&&console.log(e,...t)}info(e,...t){!0!==this.config.silence&&this.logLevel<=_e.INFO&&console.log(e,...t)}warn(e,...t){!0!==this.config.silence&&this.logLevel<=_e.WARN&&(console.warn(e,...t),this.config.onwarn&&this.config.onwarn(e,t))}error(e,...t){!0!==this.config.silence&&this.logLevel<=_e.ERROR&&(console.error(e,...t),this.config.onerror&&this.config.onerror(e,t))}}const Se=new ke({logLevel:"INFO",silence:!0});function Ie(e,t){return function(...n){const s=Array.prototype.slice.call(n);return new Promise((async(n,i)=>{try{s.push(((e,t)=>e?i(e):n(t))),await e.apply(t,s)}catch(e){i(e)}}))}}const Ne=(e=0,t=Number.MAX_SAFE_INTEGER)=>(e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e);const Te=e=>{if(!e||"string"!=typeof e)return"";const t=e.match(/[\d.]+/);return t&&t.length>0?t[0].trim():""},xe=e=>{if(!e||"string"!=typeof e)return"";const t=e.match(/[\w\s\d]+/);return t&&t.length>0?t[0].trim():""},Ae=e=>{if(!e||"string"!=typeof e)return"";const t=e.match(/[\w\d.\-:\/]+/);return t&&t.length>0?t[0].trim():""},Oe=e=>{const n=i({},e.types);return delete n.EIP712Domain,t.ethers.utils._TypedDataEncoder.hash(e.domain,n,e.message)},Pe=e=>t.ethers.utils.arrayify(Oe(e)),{defineReadOnly:Re,getStatic:Me,resolveProperties:Le,checkProperties:Ue,shallowCopy:De,deepCopy:qe}=t.utils;function We(e){return null!=e&&(t.BigNumber.isBigNumber(e)||"number"==typeof e&&e%1==0||"string"==typeof e&&!!e.match(/^-?[0-9]+$/)||t.utils.isHexString(e)||"bigint"==typeof e||t.utils.isBytes(e))}class Be{constructor(e){var s=this;this.authProvider=e,this.findCurrentConfig=async function(e){const{provider:n,context:r,ignoreIndex:a,requireIndex:o,skipCache:c}=e,l=t.ethers.utils.getAddress(e.address);if(Se.info(`[findCurrentConfig] address:${l}, ignoreIndex:${a}, requireIndex:${o}`),o&&a)throw Error("findCurrentConfig: can't ignore index and require index");const h=n.getNetwork(),d=e.knownConfigs?e.knownConfigs:[],{imageHash:u,config:p}=await s.findCurrentImageHash(r,n,l,d,c);if(void 0===u)return{config:void 0};const g=await s.findConfigForImageHash(r,u,p?[p,...d]:d,c),f=(await h).chainId;return{config:g?i({},g,{chainId:f,address:l}):void 0}},this.findLastWalletOfInitialSigner=async function(e){const{signer:r,context:a,ignoreIndex:o,requireIndex:c}=e;if(Se.info(`[findLastWalletOfInitialSigner] signer:${r}`),c&&o)throw Error("findCurrentConfig: can't ignore index and require index");const l=new t.Contract(a.sequenceUtils,n.sequenceUtils.abi,s.authProvider),h=o?0:(await l.lastSignerUpdate(r)).toNumber();if(c&&0===h)return{wallet:void 0};const d=l.filters.RequiredSigner(null,r),u=await s.findLatestLog(s.authProvider,i({},d,{fromBlock:h,toBlock:0!==h?h:"latest"}));if(void 0===u)return Se.warn("publishConfig: wallet config last log not found"),{wallet:void 0};return{wallet:l.interface.decodeEventLog("RequiredSigner",u.data,u.topics)._wallet}},this.findConfigForImageHash=async function(e,r,a=[],o=!1){const c=a.find((e=>he(e)===r));if(c)return c;if(!o){const e=ae(r);if(e)return e}Se.info(`[findConfigForImageHash] image:${r}`);const l=new t.Contract(e.sequenceUtils,n.sequenceUtils.abi,s.authProvider),h=(await l.lastImageHashUpdate(r)).toNumber(),d=l.filters.RequiredConfig(void 0,r),u=await s.findLatestLog(s.authProvider,i({},d,{fromBlock:h,toBlock:0!==h?h:"latest"}));if(void 0===u)return;const p=l.interface.decodeEventLog("RequiredConfig",u.data,u.topics),g=t.ethers.utils.defaultAbiCoder.decode(["tuple(\n        uint256 weight,\n        address signer\n      )[]"],p._signers)[0],f={threshold:t.ethers.BigNumber.from(p._threshold).toNumber(),signers:g.map((e=>({address:e.signer,weight:t.ethers.BigNumber.from(e.weight).toNumber()})))};return he(f),f},this.findCurrentImageHash=async function(e,i,r,a=[],o){Se.info(`[findCurrentImageHash] address:${r}`);const c=new t.Contract(r,n.mainModuleUpgradable.abi,i),l=await c.functions.imageHash.call([]).catch((()=>[]));if(void 0!==l[0])return{imageHash:l[0],config:o?void 0:ae(l[0])};const h=t.ethers.utils.getAddress(r),d=a.find((t=>le(t,e,!0)===h));if(d)return{imageHash:he(d),config:d};const u=new t.Contract(e.sequenceUtils,n.sequenceUtils.abi,s.authProvider),p=await u.knownImageHashes(r);if(p!==t.ethers.constants.HashZero){if(le(p,e)!==r)throw Error("findCurrentImageHash: inconsistent RequireUtils results");return{imageHash:p}}const g=u.filters.RequiredConfig(r),f=await s.findFirstLog(s.authProvider,g);if(void 0!==f){const n=u.interface.decodeEventLog("RequiredConfig",f.data,f.topics),s=t.ethers.utils.defaultAbiCoder.decode(["tuple(\n          uint256 weight,\n          address signer\n        )[]"],n._signers)[0],i={threshold:t.ethers.BigNumber.from(n._threshold).toNumber(),signers:s.map((e=>({address:e.signer,weight:t.ethers.BigNumber.from(e.weight).toNumber()})))},a=he(i);if(le(a,e)===r)return{imageHash:a,config:i}}return{}},this.findLatestLog=async function(e,t){const n="latest"===t.toBlock?await e.getBlockNumber():t.toBlock,r=t.fromBlock;0===r&&Se.warn(`findLatestLog: expensive getLogs query fromBlock 0 toBlock ${n}`);try{const s=await e.getLogs(i({},t,{toBlock:n}));return 0===s.length?void 0:s[s.length-1]}catch(a){const o=Math.floor((n-r)/2+r),c=await s.findLatestLog(e,i({},t,{fromBlock:o,toBlock:n}));return void 0!==c?c:s.findLatestLog(e,i({},t,{fromBlock:r,toBlock:o}))}},this.findFirstLog=async function(e,t){const n="latest"!==t.toBlock&&t.toBlock?t.toBlock:await e.getBlockNumber(),r=t.fromBlock?t.fromBlock:0;0===r&&Se.warn(`findFirstLog: expensive getLogs query fromBlock 0 toBlock ${n}`);try{const s=await e.getLogs(i({},t,{fromBlock:r,toBlock:n}));return 0===s.length?void 0:s[0]}catch(a){const o=Math.floor((n-r)/2+r),c=await s.findFirstLog(e,i({},t,{fromBlock:r,toBlock:o}));return void 0!==c?c:s.findFirstLog(e,i({},t,{fromBlock:o,toBlock:n}))}}}}let Fe;function Ge(e,t){return e.reduce((function(e,n,s){return t(n,s)?e[0].push(n):e[1].push(n),e}),[[],[]])}!function(e){e.ethCall="eth_call",e.ethGetBalance="eth_getBalance",e.ethGetCode="eth_getCode"}(Fe||(Fe={}));const je=e=>"number"==typeof e?e:e.chainId?e.chainId:t.ethers.BigNumber.from(e).toNumber(),$e=e=>{if(e)return je(e)},He=e=>e.find((e=>e.isAuthChain)),Ve=(e,t=!1,n=!1)=>{if(!e)throw new Error("invalid network config: empty config");const s=[];if(Array.isArray(e)?s.push(...e):s.push(e),0===s.length){if(t)throw new Error("invalid network config: empty config");return!1}const i=s.map((e=>e.chainId)).sort(),r=i.filter(((e,t)=>i.indexOf(e)!==t));if(r.length>0){if(t)throw new Error(`invalid network config: duplicate chainIds ${r}`);return!1}s.forEach((e=>e.name=e.name.toLowerCase()));const a=s.map((e=>e.name)).sort(),o=a.filter(((e,t)=>a.indexOf(e)!==t));if(o.length>0){if(t)throw new Error(`invalid network config: duplicate network names ${o}`);return!1}let c=!1,l=!1;for(let e=0;e<s.length;e++){const i=s[e];if(!(i.rpcUrl&&""!==i.rpcUrl||i.provider)){if(t)throw new Error(`invalid network config for chainId ${i.chainId}: rpcUrl or provider must be provided`);return!1}if(!n&&!i.relayer){if(t)throw new Error(`invalid network config for chainId ${i.chainId}: relayer must be provided`);return!1}if(i.isDefaultChain){if(c){if(t)throw new Error(`invalid network config for chainId ${i.chainId}: DefaultChain is already set by another config`);return!1}c=!0}if(i.isAuthChain){if(l&&t)throw new Error(`invalid network config for chainId ${i.chainId}: AuthChain is already set by another config`);l=!0}}if(!c){if(t)throw new Error("invalid network config: DefaultChain must be set");return!1}if(!l){if(t)throw new Error("invalid network config: AuthChain must be set");return!1}return!0},Je=(e,t=!1)=>(Ve(e,!0,t),e),Ke=(e,t)=>{if(e&&t){if(!e.chainId&&!e.name)throw new Error("failed to update network config: source config is missing chainId or name");if(e.chainId!==t.chainId&&e.name!==t.name)throw new Error("failed to update network config: one of chainId or name must match");e.rpcUrl&&(t.rpcUrl=e.rpcUrl,t.provider=void 0),e.provider&&(t.provider=e.provider),e.relayer&&(t.relayer=e.relayer)}},ze=e=>Je(Ye(e)),Ze=(e,n)=>{if("string"==typeof n){if(n.startsWith("0x")){const s=t.ethers.BigNumber.from(n).toNumber();return e.find((e=>e.chainId===s))}return e.find((e=>e.name===n))}return"number"==typeof n?e.find((e=>e.chainId===n)):n.chainId?e.find((e=>e.chainId===n.chainId)):void 0},Ye=e=>{if(!e)return[];const t=e.sort(((e,t)=>e.chainId===t.chainId?0:e.chainId<t.chainId?-1:1)),n=t.findIndex((e=>e.isDefaultChain));n>0&&t.splice(0,0,t.splice(n,1)[0]);const s=t.findIndex((e=>e.isAuthChain&&!0!==e.isDefaultChain));return s>0&&t.splice(1,0,t.splice(s,1)[0]),t},Qe=(e,t)=>"string"==typeof e?(t=t||{},e.replace(/\$\{\s*([$#@\-\d\w]+)\s*\}/gim,(function(e,n){let s=t[n];return s="function"==typeof s?s():null==s?"":"object"==typeof s||"symbol"==typeof s?s.toString():s.valueOf(),s}))):"";let Xe;!function(e){e[e.MAINNET=1]="MAINNET",e[e.ROPSTEN=3]="ROPSTEN",e[e.RINKEBY=4]="RINKEBY",e[e.GOERLI=5]="GOERLI",e[e.KOVAN=42]="KOVAN",e[e.POLYGON=137]="POLYGON",e[e.POLYGON_MUMBAI=80001]="POLYGON_MUMBAI",e[e.BSC=56]="BSC",e[e.BSC_TESTNET=97]="BSC_TESTNET",e[e.OPTIMISM=10]="OPTIMISM",e[e.OPTIMISM_TESTNET=69]="OPTIMISM_TESTNET",e[e.ARBITRUM=42161]="ARBITRUM",e[e.ARBITRUM_TESTNET=421611]="ARBITRUM_TESTNET",e[e.ARBITRUM_NOVA=42170]="ARBITRUM_NOVA",e[e.AVALANCHE=43114]="AVALANCHE",e[e.AVALANCHE_TESTNET=43113]="AVALANCHE_TESTNET",e[e.FANTOM=250]="FANTOM",e[e.FANTOM_TESTNET=4002]="FANTOM_TESTNET",e[e.GNOSIS=100]="GNOSIS",e[e.AURORA=1313161554]="AURORA",e[e.AURORA_TESTNET=1313161556]="AURORA_TESTNET"}(Xe||(Xe={}));const et=e=>Qe("https://${network}-indexer.sequence.app",{network:e}),tt=e=>Qe("https://${network}-relayer.sequence.app",{network:e}),nt=e=>Qe("https://nodes.sequence.app/${network}",{network:e}),st={[Xe.MAINNET]:{chainId:Xe.MAINNET,name:"mainnet",title:"Ethereum",blockExplorer:{name:"Etherscan",rootUrl:"https://etherscan.io/"}},[Xe.ROPSTEN]:{chainId:Xe.ROPSTEN,name:"ropsten",title:"Ropsten",testnet:!0,blockExplorer:{name:"Etherscan (Ropsten)",rootUrl:"https://ropsten.etherscan.io/"}},[Xe.RINKEBY]:{chainId:Xe.RINKEBY,name:"rinkeby",title:"Rinkeby",testnet:!0,blockExplorer:{name:"Etherscan (Rinkeby)",rootUrl:"https://rinkeby.etherscan.io/"},disabled:!0},[Xe.GOERLI]:{chainId:Xe.GOERLI,name:"goerli",title:"Goerli",testnet:!0,blockExplorer:{name:"Etherscan (Goerli)",rootUrl:"https://goerli.etherscan.io/"}},[Xe.KOVAN]:{chainId:Xe.KOVAN,name:"kovan",title:"Kovan",testnet:!0,blockExplorer:{name:"Etherscan (Kovan)",rootUrl:"https://kovan.etherscan.io/"}},[Xe.POLYGON]:{chainId:Xe.POLYGON,name:"polygon",title:"Polygon",blockExplorer:{name:"Polygonscan",rootUrl:"https://polygonscan.com/"}},[Xe.POLYGON_MUMBAI]:{chainId:Xe.POLYGON_MUMBAI,name:"mumbai",title:"Polygon Mumbai",testnet:!0,blockExplorer:{name:"Polygonscan (Mumbai)",rootUrl:"https://mumbai.polygonscan.com/"}},[Xe.BSC]:{chainId:Xe.BSC,name:"bsc",title:"BNB Smart Chain",blockExplorer:{name:"BSCScan",rootUrl:"https://bscscan.com/"}},[Xe.BSC_TESTNET]:{chainId:Xe.BSC_TESTNET,name:"bsc-testnet",title:"BNB Smart Chain Testnet",testnet:!0,blockExplorer:{name:"BSCScan (Testnet)",rootUrl:"https://testnet.bscscan.com/"}},[Xe.OPTIMISM]:{chainId:Xe.OPTIMISM,name:"optimism",title:"Optimism",blockExplorer:{name:"Etherscan (Optimism)",rootUrl:"https://optimistic.etherscan.io/"}},[Xe.OPTIMISM_TESTNET]:{chainId:Xe.OPTIMISM_TESTNET,name:"optimism-testnet",title:"Optimistic Kovan",testnet:!0,blockExplorer:{name:"Etherscan (Optimism Testnet)",rootUrl:"https://kovan-optimistic.etherscan.io/"}},[Xe.ARBITRUM]:{chainId:Xe.ARBITRUM,name:"arbitrum",title:"Arbitrum One",blockExplorer:{name:"Arbiscan",rootUrl:"https://arbiscan.io/"}},[Xe.ARBITRUM_TESTNET]:{chainId:Xe.ARBITRUM_TESTNET,name:"arbitrum-testnet",title:"Arbitrum Testnet",testnet:!0,blockExplorer:{name:"Arbiscan (Testnet)",rootUrl:"https://testnet.arbiscan.io/"}},[Xe.ARBITRUM_NOVA]:{chainId:Xe.ARBITRUM_NOVA,name:"arbitrum-nova",title:"Arbitrum Nova",blockExplorer:{name:"Nova Explorer",rootUrl:"https://nova-explorer.arbitrum.io/"}},[Xe.AVALANCHE]:{chainId:Xe.AVALANCHE,name:"avalanche",title:"Avalanche",blockExplorer:{name:"Snowtrace",rootUrl:"https://snowtrace.io/"}},[Xe.AVALANCHE_TESTNET]:{chainId:Xe.AVALANCHE_TESTNET,name:"avalanche-testnet",title:"Avalanche Testnet",testnet:!0,blockExplorer:{name:"Snowtrace (Testnet)",rootUrl:"https://testnet.snowtrace.io/"}},[Xe.FANTOM]:{chainId:Xe.FANTOM,name:"fantom",title:"Fantom",blockExplorer:{name:"FTMScan",rootUrl:"https://ftmscan.com/"}},[Xe.FANTOM_TESTNET]:{chainId:Xe.FANTOM_TESTNET,name:"fantom-testnet",title:"Fantom Testnet",testnet:!0,blockExplorer:{name:"FTMScan (Testnet)",rootUrl:"https://testnet.ftmscan.com/"}},[Xe.GNOSIS]:{chainId:Xe.GNOSIS,name:"gnosis",title:"Gnosis Chain",blockExplorer:{name:"Gnosis Chain Explorer",rootUrl:"https://blockscout.com/xdai/mainnet/"}},[Xe.AURORA]:{chainId:Xe.AURORA,name:"aurora",title:"Aurora",blockExplorer:{name:"Aurora Explorer",rootUrl:"https://aurorascan.dev/"}},[Xe.AURORA_TESTNET]:{chainId:Xe.AURORA_TESTNET,name:"aurora-testnet",title:"Aurora Testnet",blockExplorer:{name:"Aurora Explorer (Testnet)",rootUrl:"https://testnet.aurorascan.dev/"}}},it=ze([i({},st[Xe.MAINNET],{rpcUrl:nt("mainnet"),relayer:{url:tt("mainnet")},indexerUrl:et("mainnet")}),i({},st[Xe.POLYGON],{rpcUrl:nt("polygon"),relayer:{url:tt("polygon")},indexerUrl:et("polygon"),isDefaultChain:!0,isAuthChain:!0}),i({},st[Xe.BSC],{rpcUrl:nt("bsc"),indexerUrl:et("bsc"),relayer:{url:tt("bsc")}}),i({},st[Xe.AVALANCHE],{rpcUrl:nt("avalanche"),indexerUrl:et("avalanche"),relayer:{url:tt("avalanche")}}),i({},st[Xe.ARBITRUM],{rpcUrl:nt("arbitrum"),indexerUrl:et("arbitrum"),relayer:{url:tt("arbitrum")}}),i({},st[Xe.ARBITRUM_NOVA],{rpcUrl:nt("arbitrum-nova"),indexerUrl:et("arbitrum-nova"),relayer:{url:tt("arbitrum-nova")}}),i({},st[Xe.OPTIMISM],{rpcUrl:nt("optimism"),indexerUrl:et("optimism"),relayer:{url:tt("optimism")}})]),rt=ze([i({},st[Xe.RINKEBY],{rpcUrl:nt("rinkeby"),relayer:{url:tt("rinkeby")},indexerUrl:et("rinkeby")}),i({},st[Xe.GOERLI],{rpcUrl:nt("goerli"),relayer:{url:tt("goerli")},indexerUrl:et("goerli")}),i({},st[Xe.POLYGON_MUMBAI],{rpcUrl:nt("mumbai"),relayer:{url:tt("mumbai")},indexerUrl:et("mumbai"),isDefaultChain:!0,isAuthChain:!0}),i({},st[Xe.BSC_TESTNET],{rpcUrl:nt("bsc-testnet"),relayer:{url:tt("bsc-testnet")},indexerUrl:et("bsc-testnet")})]),at={factory:"0xf9D09D634Fb818b05149329C1dcCFAeA53639d96",mainModule:"0xd01F11855bCcb95f88D7A48492F66410d4637313",mainModuleUpgradable:"0x7EFE6cE415956c5f80C6530cC6cc81b4808F6118",guestModule:"0x02390F3E6E5FD1C6786CB78FD3027C117a9955A7",sequenceUtils:"0xd130B43062D875a4B7aF3f8fc036Bc6e9D3E1B3E",libs:{requireFreshSigner:"0xE6B9B21C077F382333220a072e4c44280b873907"}},ot="2.0";class ct{constructor(e,t){this.sender=void 0,this.handler=void 0,this.sender=t,e&&this.setMiddleware(e)}setMiddleware(e){this.handler=lt(e,this.sender.sendAsync)}sendAsync(e,t,n){try{this.handler(e,t,n)}catch(e){t(e,void 0)}}}const lt=(e,t)=>{if(0===e.length)return t;const n=e=>e.sendAsyncMiddleware?e.sendAsyncMiddleware:e;let s;s=n(e[e.length-1])(t);for(let t=e.length-2;t>=0;t--)s=n(e[t])(s);return s};function ht(e){return void 0!==e&&void 0!==e.send&&void 0!==e.constructor.defaultUrl&&void 0!==e.detectNetwork&&void 0!==e.getSigner&&void 0!==e.perform}function dt(e){return void 0!==e&&void 0!==e.sendAsync}let ut=0;class pt{constructor(e,t){this.send=void 0,this.request=void 0,this.defaultChainId=void 0,this.sendAsync=(e,t,n)=>{this.send(e.method,e.params,n||this.defaultChainId).then((n=>{t(void 0,{jsonrpc:"2.0",id:e.id,result:n})})).catch((e=>{t(e,void 0)}))},this.defaultChainId=t,ht(e)?this.send=e.send.bind(e):dt(e)?this.send=(t,n,s)=>new Promise(((i,r)=>{e.sendAsync({jsonrpc:ot,id:++ut,method:t,params:n},((e,t)=>{e?r(e):i(t?t.result:void 0)}),s||this.defaultChainId)})):this.send=e,this.request=(e,t)=>this.send(e.method,e.params,t)}}const gt=e=>t=>(n,s,i)=>{if(!e(n))throw new Error("allowProvider middleware precondition is unmet.");t(n,s,i)};class ft{constructor(e){this.cachableJsonRpcMethods=["net_version","eth_chainId","eth_accounts","sequence_getWalletContext","sequence_getNetworks"],this.cache=void 0,this.onUpdateCallback=void 0,this.defaultChainId=void 0,this.sendAsyncMiddleware=e=>(t,n,s)=>{if(this.cachableJsonRpcMethods.includes(t.method)){const e=this.cacheKey(t.method,t.params,s||this.defaultChainId),i=this.getCacheValue(e);if(i&&""!==i)return void n(void 0,{jsonrpc:"2.0",id:t.id,result:i})}e(t,((e,s,i)=>{if(this.cachableJsonRpcMethods.includes(t.method)&&s&&s.result){const e=this.cacheKey(t.method,t.params,i||this.defaultChainId);this.setCacheValue(e,s.result)}n(e,s)}),s||this.defaultChainId)},this.cacheKey=(e,t,n)=>{let s="";return s=n?`${n}:${e}:`:`:${e}:`,t&&0!==t.length?s+JSON.stringify(t):s+"[]"},this.getCache=()=>this.cache,this.setCache=e=>{this.cache=e,this.onUpdateCallback&&this.onUpdateCallback()},this.getCacheValue=e=>this.cache[e],this.setCacheValue=(e,t)=>{this.cache[e]=t,this.onUpdateCallback&&this.onUpdateCallback(e,t)},this.clearCache=()=>{this.cache={}},this.cache={},this.defaultChainId=e}onUpdate(e){this.onUpdateCallback=e}}class wt{constructor(e){this.props=void 0,this.sendAsyncMiddleware=e=>(n,s,i)=>{const{id:r,method:a}=n;switch(a){case"net_version":if(this.props.chainId)return void s(void 0,{jsonrpc:"2.0",id:r,result:`${this.props.chainId}`});break;case"eth_chainId":if(this.props.chainId)return void s(void 0,{jsonrpc:"2.0",id:r,result:t.ethers.utils.hexlify(this.props.chainId)});break;case"eth_accounts":if(this.props.accountAddress)return void s(void 0,{jsonrpc:"2.0",id:r,result:[t.ethers.utils.getAddress(this.props.accountAddress)]});break;case"sequence_getWalletContext":if(this.props.walletContext)return void s(void 0,{jsonrpc:"2.0",id:r,result:this.props.walletContext})}e(n,s,i)},this.props=e}}const mt=e=>(t,n,s)=>{e(t,((e,t)=>{if(!e&&t&&t.error)throw"string"==typeof t.error?new Error(t.error):new Error(t.error.message);n(e,t)}),s)},yt=e=>(t,n,s)=>{const i=s?` chainId:${s}`:"";Se.info(`[provider request]${i} id:${t.id} method:${t.method} params:`,t.params),e(t,((e,s)=>{e?Se.warn(`[provider response]${i} id:${t.id} method:${t.method} params:`,t.params,"error:",e):Se.info(`[provider response]${i} id:${t.id} method:${t.method} params:`,t.params,"response:",s),n(e,s)}),s)},vt=e=>n=>(s,i,r)=>{const a=e(s),{id:o,method:c}=s;switch(c){case"net_version":return void i(void 0,{jsonrpc:"2.0",id:o,result:`${a}`});case"eth_chainId":return void i(void 0,{jsonrpc:"2.0",id:o,result:t.ethers.utils.hexlify(a)})}n(s,i,r)},bt=["personal_sign","eth_sign","eth_signTypedData","eth_signTypedData_v4","eth_sendTransaction","eth_sendRawTransaction","sequence_getWalletContext","sequence_getWalletConfig","sequence_getWalletState","sequence_getNetworks","sequence_updateConfig","sequence_publishConfig","sequence_gasRefundOptions","sequence_getNonce","sequence_relay","eth_decrypt","eth_getEncryptionPublicKey","wallet_addEthereumChain","wallet_switchEthereumChain","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"];class Ct{constructor(e){this.provider=void 0,this.sendAsyncMiddleware=e=>(t,n,s)=>{bt.includes(t.method)?this.provider.sendAsync(t,n,s):e(t,n,s)},this.provider=e}}const Et={batchSize:50,timeWindow:50,contract:at.sequenceUtils,verbose:!1};class _t{constructor(e){var s=this;if(this.batchableJsonRpcMethods=[Fe.ethCall,Fe.ethGetCode,Fe.ethGetBalance],this.multicallInterface=new t.ethers.utils.Interface(n.sequenceUtils.abi),this.options=void 0,this.timeout=void 0,this.queue=[],this.scheduleExecution=()=>{this.queue.length>0&&(this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(this.run,this.options.timeWindow))},this.handle=(e,t,n)=>this.batchableJsonRpcMethods.find((e=>e===t.method))?(this.queue.push({request:t,callback:n,next:e}),this.options.verbose&&console.log("Scheduling call",t.method),void this.scheduleExecution()):(this.options.verbose&&console.log("Forwarded call",t.method),e(t,n)),this.run=async function(){s.options.verbose&&console.log("Processing multicall");const e=Math.min(s.options.batchSize,s.queue.length);if(0===e)return;if(1===e)return s.forward(s.queue[0]),s.queue=[],void(s.options.verbose&&console.log("Skip multicall, single item"));s.options.verbose&&console.log("Resolving",e);var n=s.queue.slice(0,e);s.queue=e===s.queue.length?[]:s.queue.slice(e),s.options.verbose&&console.log("Updated queue",s.queue.length),0!==s.queue.length&&s.scheduleExecution();const i=n[0].next;let r;var[n,a]=Ge(n,(e=>{try{if(e.next!==i)return!1;switch(e.request.method){case Fe.ethCall:if(e.request.params[0].from||e.request.params[0].gasPrice||e.request.params[0].value)return!1;case Fe.ethGetBalance:case Fe.ethGetCode:const i=function(e){if(void 0===e)return"latest";switch(e){case"earliest":case"latest":case"pending":return e}return t.BigNumber.from(e)}(e.request.params[1]);if(void 0===r&&(r=i),(n=i)!==(s=r)&&!(t.BigNumber.isBigNumber(n)?t.BigNumber.isBigNumber(s)&&n.eq(s):!t.BigNumber.isBigNumber(s)&&n===s))return!1}return!0}catch(e){return!1}var n,s}));if(0!==a.length&&(s.options.verbose&&console.log("Forwarding incompatible calls",a.length),s.forward(a),0===n.length))return;let o=n.map((e=>{try{switch(e.request.method){case Fe.ethCall:return{delegateCall:!1,revertOnError:!1,target:e.request.params[0].to,data:e.request.params[0].data,gasLimit:e.request.params[0].gas?e.request.params[0].gas:0,value:0};case Fe.ethGetCode:return{delegateCall:!1,revertOnError:!1,target:s.options.contract,gasLimit:0,value:0,data:s.multicallInterface.encodeFunctionData(s.multicallInterface.getFunction("callCode"),[e.request.params[0]])};case Fe.ethGetBalance:return{delegateCall:!1,revertOnError:!1,target:s.options.contract,gasLimit:0,value:0,data:s.multicallInterface.encodeFunctionData(s.multicallInterface.getFunction("callBalanceOf"),[e.request.params[0]])};default:return null}}catch(e){return null}}));var[n,a]=Ge(n,((e,t)=>void 0!==o[t]));if(o=o.filter((e=>e)),0!==a.length&&(s.options.verbose&&console.log("Forwarding calls on error",a.length),s.forward(a),0===n.length))return;let c;try{c=s.multicallInterface.encodeFunctionData(s.multicallInterface.getFunction("multiCall"),[o])}catch(e){return void s.forward(n)}const l=Ne(),h=await async function(e,t){try{return await e}catch(e){return t instanceof Function?t(e):t}}(Ie(i)({id:l,jsonrpc:ot,method:Fe.ethCall,params:[{to:s.options.contract,value:0,data:c},t.BigNumber.isBigNumber(r)?r.toNumber():r]}),(e=>({jsonrpc:ot,id:l,result:void 0,error:e})));if(h.error)return s.forward(n);let d;try{d=s.multicallInterface.decodeFunctionResult(s.multicallInterface.getFunction("multiCall"),h.result)}catch(e){return void s.forward(n)}s.options.verbose&&console.log("Got response for",n.length),n.forEach(((e,n)=>{if(d[0][n])switch(e.request.method){case Fe.ethCall:e.callback(void 0,{jsonrpc:e.request.jsonrpc,id:e.request.id,result:d[1][n]});break;case Fe.ethGetCode:e.callback(void 0,{jsonrpc:e.request.jsonrpc,id:e.request.id,result:t.ethers.utils.defaultAbiCoder.decode(["bytes"],d[1][n])[0]});break;case Fe.ethGetBalance:e.callback(void 0,{jsonrpc:e.request.jsonrpc,id:e.request.id,result:t.ethers.utils.defaultAbiCoder.decode(["uint256"],d[1][n])[0]})}else s.forward(e)}))},this.options=e?i({},_t.DefaultOptions,e):_t.DefaultOptions,this.options.batchSize<=0)throw new Error(`Invalid batch size of ${this.options.batchSize}`)}forward(e){Array.isArray(e)?e.forEach((e=>e.next(e.request,e.callback))):e.next(e.request,e.callback)}static isMulticall(e){return e&&void 0!==e.handle&&void 0!==e.conf&&_t.isMulticallOptions(e.options)}static isMulticallOptions(e){return void 0!==e&&void 0!==e.batchSize&&void 0!==e.timeWindow&&void 0!==e.contract}}_t.DefaultOptions=i({},Et);const kt=["getNetwork","getBlockNumber","getGasPrice","getTransactionCount","getStorageAt","sendTransaction","estimateGas","getBlock","getTransaction","getTransactionReceipt","getLogs","emit","litenerCount","addListener","removeListener","waitForTransaction","detectNetwork","getBlockWithTransactions"];class St extends t.ethers.providers.BaseProvider{constructor(e,n){var s;super(e.getNetwork()),s=this,this.provider=e,this.multicall=void 0,this.listenerCount=this.provider.listenerCount,this.getResolver=async function(e){const n=s.provider;if(n.getResolver){const i=await n.getResolver(await e);return i?new t.ethers.providers.Resolver(s,i.address,i.name):null}return n.getResolver(await e)},this.next=async function(e,t){try{switch(e.method){case Fe.ethCall:s.callback(e,t,await s.provider.call(e.params[0],e.params[1]));break;case Fe.ethGetCode:s.callback(e,t,await s.provider.getCode(e.params[0],e.params[1]));break;case Fe.ethGetBalance:s.callback(e,t,await s.provider.getBalance(e.params[0],e.params[1]))}}catch(n){s.callback(e,t,void 0,n)}},this.multicall=_t.isMulticall(n)?n:new _t(n),kt.forEach((t=>{void 0!==e[t]&&(this[t]=(...n)=>e[t](...n))}))}callback(e,t,n,s){t(s,{jsonrpc:ot,id:e.id,result:n,error:s})}async call(e,t){return this.rpcCall(Fe.ethCall,e,t)}async getCode(e,t){return this.rpcCall(Fe.ethGetCode,e,t)}async getBalance(e,t){return this.rpcCall(Fe.ethGetBalance,e,t)}async rpcCall(e,...t){const n=Ne();return(await Ie(this.multicall.handle)(this.next,{jsonrpc:ot,id:n,method:e,params:t})).result}}var It=Object.freeze({__proto__:null,ProxyMethods:kt,MulticallProvider:St,MulticallExternalProvider:class{constructor(e,t){if(this.provider=e,this.multicall=void 0,this.multicall=_t.isMulticall(t)?t:new _t(t),e.send){const t=async function(t,n){e.send(t,n)};this.send=(e,n)=>{this.multicall.handle(t,e,n)}}if(e.sendAsync){const t=async function(t,n){e.sendAsync(t,n)};this.sendAsync=(e,n)=>{this.multicall.handle(t,e,n)}}}get isMetaMask(){return this.provider.isMetaMask}get isStatus(){return this.provider.isStatus}},multicallMiddleware:e=>t=>{const n=_t.isMulticall(e)?e:new _t(e);return(e,s)=>n.handle(t,e,s)}});function Nt(e){return void 0!==e.address&&!Tt(e)}function Tt(e){return xt(e)||At(e)||Ot(e)}function xt(e){const t=e;return void 0!==t.signature&&void 0===t.address}function At(e){const t=e;return void 0!==t.r&&void 0!==t.s&&void 0!==t.v&&void 0!==t.t}function Ot(e){const t=e;return void 0!==t.address&&void 0!==t.signature}let Pt;!function(e){e[e.EOA=0]="EOA",e[e.Address=1]="Address",e[e.Full=2]="Full"}(Pt||(Pt={}));const Rt=e=>{if("string"!=typeof e)return e;const n=e.replace("0x",""),s=t.ethers.BigNumber.from(`0x${n.slice(0,4)}`).toNumber(),i=[];for(let e=4;e<n.length;){const s=t.ethers.BigNumber.from(n.slice(e,e+2)).toNumber();e+=2;const r=t.ethers.BigNumber.from(`0x${n.slice(e,e+2)}`).toNumber();switch(e+=2,s){case Pt.Address:const s=t.ethers.utils.getAddress(n.slice(e,e+40));e+=40,i.push({weight:r,address:s});break;case Pt.EOA:const a=t.ethers.utils.arrayify(`0x${n.slice(e,e+132)}`);e+=132;const o=t.ethers.utils.splitSignature(a.slice(0,65)),c=o.r,l=o.s,h=o.v,d=t.ethers.BigNumber.from(a[a.length-1]).toNumber();i.push({weight:r,signature:a,r:c,s:l,v:h,t:d});break;case Pt.Full:const u=t.ethers.utils.getAddress(n.slice(e,e+40));e+=40;const p=t.ethers.BigNumber.from(`0x${n.slice(e,e+4)}`).mul(2).toNumber();e+=4;const g=t.ethers.utils.arrayify(`0x${n.slice(e,e+p)}`);e+=p,i.push({weight:r,address:u,signature:g});break;default:throw Error("Signature type not supported")}}return{threshold:s,signers:i}},Mt=e=>{const n=t.ethers.utils.arrayify(e.signature);return i({},e,t.ethers.utils.splitSignature(n.slice(0,65)),{t:t.ethers.BigNumber.from(n[n.length-1]).toNumber()})},Lt=(e,n)=>{const s=At(n)?n:Mt(n);switch(s.t){case 1:return t.ethers.utils.recoverAddress(e,{r:s.r,s:s.s,v:s.v});case 2:const n=t.ethers.utils.keccak256(t.ethers.utils.solidityPack(["string","bytes32"],["Ethereum Signed Message:\n32",e]));return t.ethers.utils.recoverAddress(n,{r:s.r,s:s.s,v:s.v});default:throw new Error("Unknown signature")}},Ut=(...e)=>e.map((e=>"string"==typeof e?Rt(e):e)).reduce(((e,t)=>Dt(e,t))),Dt=(e,t)=>({threshold:e.threshold,signers:e.signers.map(((e,n)=>Nt(e)?t.signers[n]:e))}),qt=e=>{if("string"==typeof e)return qt(Rt(e));const n=e.signers.map((e=>{if(Nt(e))return t.ethers.utils.solidityPack(["uint8","uint8","address"],[Pt.Address,e.weight,e.address]);if(At(e))return t.ethers.utils.solidityPack(["uint8","uint8","bytes32","bytes32","uint8","uint8"],[Pt.EOA,e.weight,e.r,e.s,e.v,e.t]);if(Ot(e)){const n=t.ethers.utils.arrayify(e.signature).length;return t.ethers.utils.solidityPack(["uint8","uint8","address","uint16","bytes"],[Pt.Full,e.weight,e.address,n,e.signature])}if(xt(e))return t.ethers.utils.solidityPack(["uint8","uint8","bytes"],[Pt.EOA,e.weight,e.signature]);throw Error("Unkwnown signature part type")}));return t.ethers.utils.solidityPack(["uint16",...Array(n.length).fill("bytes")],[e.threshold,...n])};function Wt(e,t){if(Nt(e))return e.address;if(Ot(e))return e.address;if(At(e)||xt(e))return Lt(t,e);throw Error("Unkwnown signature part type")}async function Bt(e,n){const s=new St(e);let r=(await Promise.all(n.signers.map((async(e,n)=>i({},e,{index:n,isEOA:0===t.ethers.utils.arrayify(await s.getCode(e.address)).length}))))).sort(((e,t)=>e.weight-t.weight)),a=0;r=r.map((e=>a>=n.threshold||e.isEOA?e:(a+=e.weight,i({},e,{willSign:!0})))),a<n.threshold&&(r=r.map((e=>e.willSign||a>=n.threshold?e:(a+=e.weight,i({},e,{willSign:!0})))));const o=t.ethers.utils.arrayify("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7fffffffffffffffffffffffffffffff5d576e7357a4501ddfe92f46681b20a01b02"),c=r.sort(((e,t)=>e.index-t.index));return{threshold:n.threshold,signers:c.map((e=>e.willSign?e.isEOA?{weight:e.weight,signature:o}:{weight:e.weight,address:e.address,signature:qt({threshold:1,signers:[{address:t.ethers.Wallet.createRandom().address,weight:1},{weight:1,signature:o}]})+t.ethers.utils.hexlify(3).substring(2)}:{address:e.address,weight:e.weight}))}}let Ft,Gt,jt,$t,Ht;!function(e){e.UNKNOWN="UNKNOWN",e.ERC20="ERC20",e.ERC721="ERC721",e.ERC1155="ERC1155",e.SEQUENCE_WALLET="SEQUENCE_WALLET",e.ERC20_BRIDGE="ERC20_BRIDGE",e.ERC721_BRIDGE="ERC721_BRIDGE",e.ERC1155_BRIDGE="ERC1155_BRIDGE"}(Ft||(Ft={})),function(e){e.UNKNOWN="UNKNOWN",e.BLOCK_ADDED="BLOCK_ADDED",e.BLOCK_REMOVED="BLOCK_REMOVED"}(Gt||(Gt={})),function(e){e.UNKNOWN="UNKNOWN",e.TOKEN_TRANSFER="TOKEN_TRANSFER",e.SEQUENCE_TXN="SEQUENCE_TXN"}(jt||(jt={})),function(e){e.UNKNOWN="UNKNOWN",e.SEND="SEND",e.RECEIVE="RECEIVE"}($t||($t={})),function(e){e.DESC="DESC",e.ASC="ASC"}(Ht||(Ht={}));class Vt{constructor(e,t){this.hostname=void 0,this.fetch=void 0,this.path="/rpc/Indexer/",this.ping=e=>this.fetch(this.url("Ping"),Jt({},e)).then((e=>Kt(e).then((e=>({status:e.status}))))),this.version=e=>this.fetch(this.url("Version"),Jt({},e)).then((e=>Kt(e).then((e=>({version:e.version}))))),this.runtimeStatus=e=>this.fetch(this.url("RuntimeStatus"),Jt({},e)).then((e=>Kt(e).then((e=>({status:e.status}))))),this.getChainID=e=>this.fetch(this.url("GetChainID"),Jt({},e)).then((e=>Kt(e).then((e=>({chainID:e.chainID}))))),this.getEtherBalance=(e,t)=>this.fetch(this.url("GetEtherBalance"),Jt(e,t)).then((e=>Kt(e).then((e=>({balance:e.balance}))))),this.getTokenBalances=(e,t)=>this.fetch(this.url("GetTokenBalances"),Jt(e,t)).then((e=>Kt(e).then((e=>({page:e.page,balances:e.balances}))))),this.getTokenSupplies=(e,t)=>this.fetch(this.url("GetTokenSupplies"),Jt(e,t)).then((e=>Kt(e).then((e=>({page:e.page,contractType:e.contractType,tokenIDs:e.tokenIDs}))))),this.getTokenSuppliesMap=(e,t)=>this.fetch(this.url("GetTokenSuppliesMap"),Jt(e,t)).then((e=>Kt(e).then((e=>({supplies:e.supplies}))))),this.getBalanceUpdates=(e,t)=>this.fetch(this.url("GetBalanceUpdates"),Jt(e,t)).then((e=>Kt(e).then((e=>({page:e.page,balances:e.balances}))))),this.getTransactionHistory=(e,t)=>this.fetch(this.url("GetTransactionHistory"),Jt(e,t)).then((e=>Kt(e).then((e=>({page:e.page,transactions:e.transactions}))))),this.syncBalance=(e,t)=>this.fetch(this.url("SyncBalance"),Jt(e,t)).then((e=>Kt(e).then((e=>({}))))),this.hostname=e,this.fetch=(e,n)=>t(e,n)}url(e){return this.hostname+this.path+e}}const Jt=(e={},t={})=>({method:"POST",headers:i({},t,{"Content-Type":"application/json"}),body:JSON.stringify(e||{})}),Kt=e=>e.text().then((t=>{let n;try{n=JSON.parse(t)}catch(n){throw{code:"unknown",msg:`expecting JSON, got: ${t}`,status:e.status}}if(!e.ok)throw n;return n}));let zt;!function(e){e.MAINNET="https://mainnet-indexer.sequence.app",e.POLYGON="https://polygon-indexer.sequence.app",e.POLYGON_MUMBAI="https://mumbai-indexer.sequence.app",e.ARBITRUM="https://arbitrum-indexer.sequence.app",e.ARBITRUM_NOVA="https://arbitrum-nova-indexer.sequence.app",e.OPTIMISM="https://optimism-indexer.sequence.app",e.AVALANCHE="https://avalanche-indexer.sequence.app",e.GNOSIS="https://gnosis-indexer.sequence.app",e.BSC="https://bsc-indexer.sequence.app",e.BSC_TESTNET="https://bsc-testnet-indexer.sequence.app",e.GOERLI="https://goerli-indexer.sequence.app"}(zt||(zt={}));class Zt extends Vt{constructor(e,t){super(e.endsWith("/")?e.slice(0,-1):e,global.fetch),this.jwtAuth=t,this._fetch=(e,t)=>{const n={};return this.jwtAuth&&this.jwtAuth.length>0&&(n.Authorization=`BEARER ${this.jwtAuth}`),t.headers=i({},t.headers,n),global.fetch(e,t)},this.fetch=this._fetch}}let Yt,Qt,Xt,en;!function(e){e.UNKNOWN="UNKNOWN",e.ERC20="ERC20",e.ERC721="ERC721",e.ERC1155="ERC1155"}(Yt||(Yt={})),function(e){e.INT="INT",e.STRING="STRING",e.ARRAY="ARRAY",e.GENERIC="GENERIC"}(Qt||(Qt={})),function(e){e.UNKNOWN="UNKNOWN",e.BUY="BUY",e.SELL="SELL"}(Xt||(Xt={})),function(e){e.DESC="DESC",e.ASC="ASC"}(en||(en={}));class tn{constructor(e,t){this.hostname=void 0,this.fetch=void 0,this.path="/rpc/Metadata/",this.ping=e=>this.fetch(this.url("Ping"),nn({},e)).then((e=>sn(e).then((e=>({status:e.status}))))),this.version=e=>this.fetch(this.url("Version"),nn({},e)).then((e=>sn(e).then((e=>({version:e.version}))))),this.runtimeStatus=e=>this.fetch(this.url("RuntimeStatus"),nn({},e)).then((e=>sn(e).then((e=>({status:e.status}))))),this.getTokenMetadata=(e,t)=>this.fetch(this.url("GetTokenMetadata"),nn(e,t)).then((e=>sn(e).then((e=>({tokenMetadata:e.tokenMetadata}))))),this.refreshTokenMetadata=(e,t)=>this.fetch(this.url("RefreshTokenMetadata"),nn(e,t)).then((e=>sn(e).then((e=>({status:e.status}))))),this.getTokenMetadataBatch=(e,t)=>this.fetch(this.url("GetTokenMetadataBatch"),nn(e,t)).then((e=>sn(e).then((e=>({contractTokenMetadata:e.contractTokenMetadata}))))),this.searchTokenMetadata=(e,t)=>this.fetch(this.url("SearchTokenMetadata"),nn(e,t)).then((e=>sn(e).then((e=>({page:e.page,tokenMetadata:e.tokenMetadata}))))),this.searchTokenIDs=(e,t)=>this.fetch(this.url("SearchTokenIDs"),nn(e,t)).then((e=>sn(e).then((e=>({page:e.page,tokenIds:e.tokenIds}))))),this.tokenCollectionFilters=(e,t)=>this.fetch(this.url("TokenCollectionFilters"),nn(e,t)).then((e=>sn(e).then((e=>({filters:e.filters}))))),this.getContractInfo=(e,t)=>this.fetch(this.url("GetContractInfo"),nn(e,t)).then((e=>sn(e).then((e=>({contractInfo:e.contractInfo}))))),this.getContractInfoBatch=(e,t)=>this.fetch(this.url("GetContractInfoBatch"),nn(e,t)).then((e=>sn(e).then((e=>({contractInfoMap:e.contractInfoMap}))))),this.searchContractInfo=(e,t)=>this.fetch(this.url("SearchContractInfo"),nn(e,t)).then((e=>sn(e).then((e=>({contractInfoList:e.contractInfoList}))))),this.searchContractInfoBatch=(e,t)=>this.fetch(this.url("SearchContractInfoBatch"),nn(e,t)).then((e=>sn(e).then((e=>({contractInfoByChain:e.contractInfoByChain}))))),this.getNiftyswapTokenQuantity=(e,t)=>this.fetch(this.url("GetNiftyswapTokenQuantity"),nn(e,t)).then((e=>sn(e).then((e=>({quantity:e.quantity}))))),this.getNiftyswapUnitPrices=(e,t)=>this.fetch(this.url("GetNiftyswapUnitPrices"),nn(e,t)).then((e=>sn(e).then((e=>({prices:e.prices}))))),this.hostname=e,this.fetch=(e,n)=>t(e,n)}url(e){return this.hostname+this.path+e}}const nn=(e={},t={})=>({method:"POST",headers:i({},t,{"Content-Type":"application/json"}),body:JSON.stringify(e||{})}),sn=e=>e.text().then((t=>{let n;try{n=JSON.parse(t)}catch(n){throw{code:"unknown",msg:`expecting JSON, got: ${t}`,status:e.status}}if(!e.ok)throw n;return n}));class rn extends tn{constructor(e="https://metadata.sequence.app"){super(e.endsWith("/")?e.slice(0,-1):e,global.fetch)}}class an extends t.Signer{static isSequenceSigner(e){return on(e)}}function on(e){const t=e;return t&&void 0!==t.updateConfig&&void 0!==t.publishConfig&&void 0!==t.getWalletContext&&void 0!==t.getWalletConfig}class cn extends Error{}const ln="tuple(\n  bool delegateCall,\n  bool revertOnError,\n  uint256 gasLimit,\n  address target,\n  uint256 value,\n  bytes data\n)[]";function hn(e,...n){return t.ethers.utils.defaultAbiCoder.encode(["uint256",ln],[e,bn(n)])}function dn(...e){const t=vn(...e);if(void 0===t)throw new Error("Computing hash for transactions without defined nonce");return un(t,...e)}function un(e,...n){return t.ethers.utils.keccak256(hn(e,...n))}function pn(e,t,...n){return be(e,t,dn(...n)).replace(/^0x/,"")}async function gn(e,n,s=!1,i){const r=fn(n),a=(await Promise.all(n.map((e=>e.nonce)))).filter((e=>void 0!==e)).map((e=>t.ethers.BigNumber.from(e))),o=0!==a.length?a.reduce(((e,t)=>e.lt(t)?e:t)):void 0;return Promise.all(r.map((t=>wn(e,t,s,i,o))))}function fn(e){if(!Array.isArray(e)){if("auxiliary"in e){const t=e.auxiliary,n=i({},e);return delete n.auxiliary,t?[n,...fn(t)]:[n]}return[e]}return e.flatMap(fn)}async function wn(e,s,i=!1,r,a){if(mn(s))return s;const o=void 0===s.gasLimit?s.gas:s.gasLimit;if(s.to)return{delegateCall:!1,revertOnError:i,gasLimit:o?await o:r,to:await s.to,value:s.value?await s.value:0,data:await s.data,nonce:a||await s.nonce};{const c=new t.utils.Interface(n.mainModule.abi),l=c.encodeFunctionData(c.getFunction("createContract"),[s.data]),h="string"==typeof e?e:e.getAddress();return{delegateCall:!1,revertOnError:i,gasLimit:o?await o:r,to:await h,value:s.value?await s.value:0,data:l,nonce:a||await s.nonce}}}function mn(e){return void 0!==e.delegateCall||void 0!==e.revertOnError}function yn(e){return void 0!==e.find((e=>mn(e)))}function vn(...e){const n=e.find((e=>void 0!==e.nonce));if(!n)return;const s=t.ethers.BigNumber.from(n.nonce);if(e.find((e=>void 0!==e.nonce&&!t.ethers.BigNumber.from(e.nonce).eq(s))))throw new Error("Mixed nonces on Sequence transactions");return n?n.nonce:void 0}function bn(e){return e.map((e=>{var n;return{delegateCall:!0===e.delegateCall,revertOnError:!0===e.revertOnError,gasLimit:void 0!==e.gasLimit?e.gasLimit:t.ethers.constants.Zero,target:null!=(n=e.to)?n:t.ethers.constants.AddressZero,value:void 0!==e.value?e.value:t.ethers.constants.Zero,data:void 0!==e.data?e.data:[]}}))}function Cn(e,t){return e.map((e=>i({},e,{nonce:t})))}function En(e,s,i){const r=new t.utils.Interface(n.sequenceUtils.abi);if(!e||!e.sequenceUtils)throw new Error("Undefined sequenceUtils");return[{delegateCall:!1,revertOnError:!0,gasLimit:0,to:e.sequenceUtils,value:0,data:r.encodeFunctionData(r.getFunction("requireNonExpired"),[i])},...s]}function _n(e,s,i){const r=new t.utils.Interface(n.sequenceUtils.abi);if(!e||!e.sequenceUtils)throw new Error("Undefined sequenceUtils");return[{delegateCall:!1,revertOnError:!0,gasLimit:0,to:e.sequenceUtils,value:0,data:r.encodeFunctionData(r.getFunction("requireMinNonce"),[i.address,i.space?kn(i.space,i.nonce):i.nonce])},...s]}function kn(e,n){const s=t.ethers.BigNumber.from(e),i=t.ethers.BigNumber.from(n),r=t.ethers.constants.Two.pow(t.ethers.BigNumber.from(96));if(!i.div(r).eq(t.ethers.constants.Zero))throw new Error("Space already encoded");return i.add(s.mul(r))}function Sn(e){const n=t.ethers.BigNumber.from(e),s=t.ethers.constants.Two.pow(t.ethers.BigNumber.from(96));return[n.div(s),n.mod(s)]}function In(e){return void 0!==e&&void 0!==e.chainId&&void 0!==e.config&&void 0!==e.context&&void 0!==e.signature&&void 0!==e.transactions&&Array.isArray(e.transactions)&&e.transactions.reduce(((e,t)=>e&&mn(t)),!0)}async function Nn(e,t,n){let s=[];if(s=Array.isArray(n)?yn(n)?fn(n):await gn(t,n):mn(n)?fn([n]):await gn(t,[n]),n.expiration&&(s=En(e,s,n.expiration)),n.afterNonce){const i=n.afterNonce;s=_n(e,s,i.address?{address:i.address,nonce:i.nonce,space:i.space}:{address:t,nonce:i})}return s}class Tn extends t.Signer{signMessage(e,t){return this.signMessageWithData(e)}sendTransaction(e){throw new Error("sendTransaction method is not supported in RemoteSigner")}signTransaction(e){throw new Error("signTransaction method is not supported in RemoteSigner")}connect(e){throw new Error("connect method is not supported in RemoteSigner")}static signMessageWithData(e,t,n,s){return this.isRemoteSigner(e)?e.signMessageWithData(t,n,s):e.signMessage(t)}static isRemoteSigner(e){return void 0!==e.signMessageWithData}}const xn=(e={},t={})=>({method:"POST",headers:i({},t,{"Content-Type":"application/json"}),body:JSON.stringify(e||{})}),An=e=>e.text().then((t=>{let n;try{n=JSON.parse(t)}catch(n){throw{code:"unknown",msg:`expecting JSON, got: ${t}`,status:e.status}}if(!e.ok)throw n;return n}));async function On(e){return Array.isArray(e)?Promise.all(e.map((e=>t.utils.resolveProperties(e)))):t.utils.resolveProperties(e)}class Pn extends an{constructor(e,...n){super(),this.context=void 0,this.config=void 0,this._signers=void 0,this.provider=void 0,this.sender=void 0,this.relayer=void 0,this.chainId=void 0;const{config:s,context:r,strict:a}=e;if(this.context=i({},r||at),!0===a?this.context.nonStrict=void 0:!1===a&&(this.context.nonStrict=!0),!this.context.nonStrict&&!ce(s))throw new Error("wallet config is not usable (strict mode)");this.config=de(s),this._signers=n.map((e=>t.Signer.isSigner(e)?e:new t.ethers.Wallet(e))),this.imageHash}useConfig(e,t){return new Pn({config:e,context:this.context,strict:t},...this._signers).setProvider(this.provider).setRelayer(this.relayer)}useSigners(...e){return new Pn({config:this.config,context:this.context},...e).setProvider(this.provider).setRelayer(this.relayer)}connect(e,t){if(ht(e))return new Pn({config:this.config,context:this.context},...this._signers).setProvider(e).setRelayer(t);throw new Error("Wallet provider argument is expected to be a JsonRpcProvider")}setProvider(e){if(void 0===e)return this;if(t.providers.Provider.isProvider(e))this.provider=e,this.sender=new pt(e);else{const n=new t.providers.JsonRpcProvider(e);this.provider=n,this.sender=new pt(n)}return this.chainId=void 0,this}setRelayer(e){return void 0===e||(this.relayer=e),this}async getProvider(e){return e&&await this.getChainIdNumber(e),this.provider}async getRelayer(e){return e&&await this.getChainIdNumber(e),this.relayer}async getWalletContext(){return this.context}async getWalletConfig(e){e=await this.getChainIdNumber(e);return[i({},this.config,{chainId:e})]}async getWalletState(e){const[t,n,s]=await Promise.all([this.getAddress(),this.getChainId(),this.isDeployed()]);return[{context:this.context,config:this.config,address:t,chainId:n,deployed:s,imageHash:this.imageHash,lastImageHash:s?await ts(this):void 0}]}get connected(){return void 0!==this.sender}get address(){return le(this.config,this.context)}get imageHash(){return he(this.config)}async getAddress(){return this.address}async getSigners(){return this._signers&&0!==this._signers.length?Promise.all(this._signers.map((e=>e.getAddress().then((e=>t.ethers.utils.getAddress(e)))))):[]}async getChainId(){if(this.chainId)return this.chainId;if(!this.provider)throw new Error("provider is not set, first connect a provider");return this.chainId=(await this.provider.getNetwork()).chainId,this.chainId}async getNetworks(){return[{chainId:await this.getChainId(),name:"",rpcUrl:""}]}async getNonce(e,t){return this.relayer.getNonce(this.config,this.context,t,e)}async getTransactionCount(e){const n=await this.getNonce(e,0),[s,i]=Sn(n);return t.ethers.BigNumber.from(i).toNumber()}async sendTransaction(e,t,n,s,i,r){const a=await this.signTransactions(e,t,n);if(i){i(a,pn(le(a.config,a.context),a.chainId,...a.transactions))}return this.relayer.relay(a,s,r)}async sendTransactionBatch(e,t,n=!0,s,i,r){return this.sendTransaction(e,t,n,s,i,r)}async signTransactions(e,t,n){const s=await this.getChainIdNumber(t),i=await On(e);if(!this.provider)throw new Error("missing provider");if(!this.relayer)throw new Error("missing relayer");let r=await Nn(this.context,this.address,i);if(r.some((e=>void 0===e.gasLimit))){const e=await this.relayer.simulate(this.address,...r);for(const t in r)void 0===r[t].gasLimit&&(r[t].gasLimit=e[t].gasLimit)}const a=vn(...r),o=a||await this.getNonce();r=Cn(r,o);const c=un(o,...r);return{digest:c,chainId:s,context:this.context,config:this.config,transactions:r,nonce:o,signature:await this.sign(c,!0,t,n)}}async sendSignedTransactions(e,t,n){if(!this.relayer)throw new Error("relayer is not set, first connect a relayer");return await this.getChainIdNumber(t),this.relayer.relay(e,n)}async signMessage(e,n,s,i=!1){const r="string"!=typeof e||e.startsWith("0x")?e:t.ethers.utils.toUtf8Bytes(e);return this.sign(r,i,n,s)}async signTypedData(e,n,s,i,r){const a=await this.getChainIdNumber(i),o=e.chainId?t.BigNumber.from(e.chainId).toNumber():void 0;if(o&&o!==a)throw new Error(`signTypedData: domain.chainId (${e.chainId}) is expected to be ${a}`);const c=Pe({domain:e,types:n,message:s});return this.sign(c,!0,a,r)}async _signTypedData(e,t,n,s,i){return this.signTypedData(e,t,n,s,i)}async subDigest(e,n){const s=await this.getChainIdNumber(n);return t.ethers.utils.arrayify(be(this.address,s,e))}async sign(e,n=!0,s,r){var a=this;const o=await this.getChainIdNumber(s),c=n?e:t.ethers.utils.keccak256(e),l=await this.subDigest(c,s),h=async function(e,t){const n=await Promise.all(e.map((e=>e.getAddress()))),s=await Promise.all(a.config.signers.map((async function(s){try{const c=e[n.indexOf(s.address)];if(!c)return s;if(on(c)){if(c===a)throw Error("Can't sign transactions for self");return i({},s,{signature:await c.signMessage(l,o,r,!0)+"03"})}if(Tn.isRemoteSigner(c)){const e=await c.signMessageWithData(l,t,o);try{if(Lt(l,{weight:s.weight,signature:e})===s.address)return{weight:s.weight,signature:e}}catch(e){}return i({},s,{signature:e})}return{weight:s.weight,signature:await c.signMessage(l)+"02"}}catch(e){if(r)throw e;return console.warn(`Skipped signer ${s.address}`),s}})));return{threshold:a.config.threshold,signers:s}},d=this._signers.filter((e=>!Tn.isRemoteSigner(e))),u=await h(d,this.packMsgAndSig(c,[],o));if(u.signers.filter(Tt).reduce(((e,t)=>e+t.weight),0)>=this.config.threshold)return qt(u);const p=this._signers.filter((e=>Tn.isRemoteSigner(e))),g=await h(p,this.packMsgAndSig(c,qt(u),o));return qt(Ut(u,g))}async signWeight(){return(await this.getSigners()).reduce(((e,t)=>{const n=this.config.signers.find((e=>e.address===t));return n?e.add(n.weight):e}),t.ethers.constants.Zero)}async isDeployed(e){await this.getChainIdNumber(e);const t=await this.provider.getCode(this.address);return!!t&&"0x"!==t}async updateConfig(e,t,n=!1,s,r,a,o){e||(e=this.config);const[c,l]=await Promise.all([this.buildUpdateConfigTransaction(e,n,s),null!=t?t:this.getNonce()]);return[i({address:this.address},e),await this.sendTransaction(Cn(c,l),void 0,void 0,r,a,o)]}async publishConfig(e,t,n=[],s,i,r){return this.sendTransaction(this.config.address?this.buildPublishConfigTransaction(this.config,e,t):await this.buildPublishSignersTransaction(e,t,n),void 0,void 0,s,i,r)}async buildUpdateConfigTransaction(e,s=!1,i){var r=this;if(!this.context.nonStrict&&!ce(e))throw new Error("wallet config is not usable (strict mode)");const a=await async function(){try{const e=await r.provider.getStorageAt(r.address,t.ethers.utils.defaultAbiCoder.encode(["address"],[r.address]));return 0===pe(e,r.context.mainModuleUpgradable)}catch(e){return!1}}(),o=new t.utils.Interface(n.mainModule.abi),c=2*(1e5+1800*e.signers.length),l=a?[]:[{delegateCall:!1,revertOnError:!0,gasLimit:t.ethers.constants.Zero,to:this.address,value:t.ethers.constants.Zero,data:o.encodeFunctionData(o.getFunction("updateImplementation"),[this.context.mainModuleUpgradable])}],h=new t.utils.Interface(n.mainModuleUpgradable.abi),d=[...l,{delegateCall:!1,revertOnError:!0,gasLimit:t.ethers.constants.Zero,to:this.address,value:t.ethers.constants.Zero,data:h.encodeFunctionData(h.getFunction("updateImageHash"),[he(e)])},...s?await this.buildPublishConfigTransaction(e,i):[]];return 1===d.length?d:[{delegateCall:!1,revertOnError:!1,gasLimit:c,to:this.address,value:t.ethers.constants.Zero,data:o.encodeFunctionData(o.getFunction("selfExecute"),[bn(d)])}]}buildPublishConfigTransaction(e,s=!0,i){const r=new t.utils.Interface(n.sequenceUtils.abi);return[{delegateCall:!1,revertOnError:!0,gasLimit:t.ethers.constants.Zero,to:this.context.sequenceUtils,value:t.ethers.constants.Zero,nonce:i,data:r.encodeFunctionData(r.getFunction("publishConfig"),[this.address,e.threshold,de(e).signers.map((e=>({weight:e.weight,signer:e.address}))),s])}]}async buildPublishSignersTransaction(e=!0,s,i=[]){var r;const a=new t.utils.Interface(n.sequenceUtils.abi),o=new t.utils.Interface(n.requireFreshSigner.abi),c=t.ethers.utils.randomBytes(32),l=await this.signMessage(c,this.chainId,!1),h=Rt(l),d=qt({threshold:h.threshold,signers:h.signers.map(((e,t)=>{if(Ot(e)){const e=this.config.signers[t];return{weight:e.weight,address:e.address}}return e}))}),u=null==(r=this.context.libs)?void 0:r.requireFreshSigner;if(i.length>0&&void 0===u)throw Error("requireFreshSigners missing library");return[...i.map((e=>({delegateCall:!1,revertOnError:!0,gasLimit:t.ethers.constants.Zero,to:u,value:t.ethers.constants.Zero,nonce:s,data:o.encodeFunctionData(o.getFunction("requireFreshSigner"),[e])}))),{delegateCall:!1,revertOnError:!0,gasLimit:t.ethers.constants.Zero,to:this.context.sequenceUtils,value:t.ethers.constants.Zero,nonce:s,data:a.encodeFunctionData(a.getFunction("publishInitialSigners"),[this.address,t.ethers.utils.keccak256(c),this.config.signers.length,d,e])}]}async getChainIdNumber(e){if(!e)return await this.getChainId();const t=je(e);if(this.context.nonStrict)return t;const n=await this.getChainId();if(n!==t)throw new Error(`the specified chainId ${t} does not match the wallet's connected chainId ${n}`);return n}packMsgAndSig(e,n,s){return t.ethers.utils.defaultAbiCoder.encode(["address","uint256","bytes","bytes"],[this.address,s,e,n])}signTransaction(e){throw new Error("signTransaction method is not supported in Wallet, please use signTransactions(...)")}static async singleOwner(e,n){const s=t.Signer.isSigner(e)?e:new t.ethers.Wallet(e),i={threshold:1,signers:[{weight:1,address:t.ethers.utils.getAddress(await s.getAddress())}]};return new Pn({config:i,context:n},s)}async hasEnoughSigners(e){return e&&await this.getChainIdNumber(e),(await this.signWeight()).gte(this.config.threshold)}}const Rn={bundleCreation:!0,creationGasLimit:t.ethers.constants.Two.pow(17)};class Mn{constructor(e){this.provider=void 0,this.bundleCreation=void 0,this.creationGasLimit=void 0;const n=i({},Rn,e);this.bundleCreation=n.bundleCreation,this.provider=n.provider,this.creationGasLimit=t.ethers.BigNumber.from(n.creationGasLimit)}async isWalletDeployed(e){if(!this.provider)throw new Error("Bundled creation provider not found");return"0x"!==await this.provider.getCode(e)}prepareWalletDeploy(e,s){const i=new t.utils.Interface(n.factory.abi);return{to:s.factory,data:i.encodeFunctionData(i.getFunction("deploy"),[s.mainModule,he(e)])}}async prependWalletDeploy(e){const{config:s,context:r,transactions:a,nonce:o,signature:c}=e,l=le(s,r),h=new t.utils.Interface(n.mainModule.abi),d=async function(){const e=await c;return"string"==typeof e?e:qt(e)}();return this.bundleCreation&&!await this.isWalletDeployed(l)?{to:r.guestModule,execute:{transactions:[i({},this.prepareWalletDeploy(s,r),{delegateCall:!1,revertOnError:!1,gasLimit:this.creationGasLimit,value:t.ethers.constants.Zero}),{delegateCall:!1,revertOnError:!0,gasLimit:t.ethers.constants.Zero,to:l,value:t.ethers.constants.Zero,data:h.encodeFunctionData(h.getFunction("execute"),[bn(a),o,await d])}],nonce:t.ethers.constants.Zero,signature:"0x"}}:{to:l,execute:{transactions:a,nonce:t.ethers.BigNumber.from(o),signature:await d}}}async prepareTransactions(e,s,i,...r){const a=vn(...r);if(!a)throw new Error("Unable to prepare transactions without a defined nonce");const{to:o,execute:c}=await this.prependWalletDeploy({config:e,context:s,transactions:r,nonce:a,signature:i}),l=new t.utils.Interface(n.mainModule.abi);return{to:o,data:l.encodeFunctionData(l.getFunction("execute"),[bn(c.transactions),c.nonce,c.signature])}}}const Ln=t.ethers.BigNumber.from(8e5),Un={waitPollRate:1e3,deltaBlocksLog:12,fromBlockLog:-1024};class Dn extends Mn{constructor(e){super(e),this.provider=void 0,this.waitPollRate=void 0,this.deltaBlocksLog=void 0,this.fromBlockLog=void 0;const t=i({},Un,e);this.provider=t.provider,this.waitPollRate=t.waitPollRate,this.deltaBlocksLog=t.deltaBlocksLog,this.fromBlockLog=t.fromBlockLog}async simulate(e,...n){var s=this;return(await Promise.all(n.map((async function(n){if(n.gasLimit&&!t.ethers.BigNumber.from(n.gasLimit||0).eq(t.ethers.constants.Zero))return n.gasLimit;if(n.delegateCall)return Ln;if(n.to===e&&!await s.isWalletDeployed(e))return Ln;if(!s.provider)throw new Error("signer.provider is not set, but is required");return s.provider.estimateGas({from:e,to:n.to,data:n.data,value:n.value})})))).map((e=>({executed:!0,succeeded:!0,gasUsed:t.ethers.BigNumber.from(e).toNumber(),gasLimit:t.ethers.BigNumber.from(e).toNumber()})))}async getNonce(e,s,i,r){if(!this.provider)throw new Error("provider is not set");const a=le(e,s);if("0x"===await this.provider.getCode(a))return 0;void 0===i&&(i=0);const o=new t.ethers.Contract(a,n.mainModule.abi,this.provider);return kn(i,await o.readNonce(i,{blockTag:r}))}async wait(e,t,n=this.waitPollRate,s=5){var r=this;"string"!=typeof e&&(Se.info("computing id",e.config,e.context,e.chainId,...e.transactions),e=pn(le(e.config,e.context),e.chainId,...e.transactions));let a=!1;const o=async function(e,t){let i=0;for(;!a;){try{return await e()}catch(e){if(i++,void 0!==s&&i>=s)throw Se.error(`giving up after ${i} failed attempts${t?`: ${t}`:""}`,e),e;Se.warn(`attempt #${i} failed${t?`: ${t}`:""}`,e)}n>0&&await new Promise((e=>setTimeout(e,n)))}throw new Error(`timed out after ${i} failed attempts${t?`: ${t}`:""}`)},c=async function(){let t=r.fromBlockLog;if(t<0){const e=await o((()=>r.provider.getBlockNumber()),"unable to get latest block number");t=e+t}if("string"!=typeof e)throw new Error("impossible");const s=e.replace("0x","");for(;!a;){const e=await o((()=>r.provider.getBlockNumber()),"unable to get latest block number"),c=await o((()=>r.provider.getLogs({fromBlock:Math.max(0,t-r.deltaBlocksLog),toBlock:e,topics:["0x1f180c27086c7a39ea2a7b25239d1ab92348f07ca7bb59d1438fcf527568f881"]})),`unable to get NonceChange logs for blocks ${Math.max(0,t-r.deltaBlocksLog)} to ${e}`);t=e;const l=(await Promise.all(c.map((e=>o((()=>r.provider.getTransactionReceipt(e.transactionHash)),`unable to get receipt for transaction ${e.transactionHash}`))))).find((e=>e.logs.find((e=>0===e.topics.length&&e.data.replace("0x","")===s||1===e.topics.length&&"0x3dbd1590ea96dd3253a91f24e64e3a502e1225d602a5731357bc12643070ccd7"===e.topics[0]&&e.data.length>=64&&e.data.replace("0x","").startsWith(s)))));if(l)return i({receipt:l},await o((()=>r.provider.getTransaction(l.transactionHash)),`unable to get transaction ${l.transactionHash}`));a||await new Promise((e=>setTimeout(e,n)))}throw new Error(`Timeout waiting for transaction receipt ${e}`)};return void 0!==t?Promise.race([c(),new Promise(((n,s)=>setTimeout((()=>{a=!0,s(`Timeout waiting for transaction receipt ${e}`)}),t)))]):c()}}let qn,Wn,Bn,Fn;!function(e){e.UNKNOWN="UNKNOWN",e.DROPPED="DROPPED",e.QUEUED="QUEUED",e.SENT="SENT",e.SUCCEEDED="SUCCEEDED",e.PARTIALLY_FAILED="PARTIALLY_FAILED",e.FAILED="FAILED"}(qn||(qn={})),function(e){e.SEND="SEND",e.RECEIVE="RECEIVE",e.BRIDGE_DEPOSIT="BRIDGE_DEPOSIT",e.BRIDGE_WITHDRAW="BRIDGE_WITHDRAW",e.BURN="BURN",e.UNKNOWN="UNKNOWN"}(Wn||(Wn={})),function(e){e.UNKNOWN="UNKNOWN",e.ERC20_TOKEN="ERC20_TOKEN",e.ERC1155_TOKEN="ERC1155_TOKEN"}(Bn||(Bn={})),function(e){e.DESC="DESC",e.ASC="ASC"}(Fn||(Fn={}));class Gn{constructor(e,t){this.hostname=void 0,this.fetch=void 0,this.path="/rpc/Relayer/",this.ping=e=>this.fetch(this.url("Ping"),jn({},e)).then((e=>$n(e).then((e=>({status:e.status}))))),this.version=e=>this.fetch(this.url("Version"),jn({},e)).then((e=>$n(e).then((e=>({version:e.version}))))),this.runtimeStatus=e=>this.fetch(this.url("RuntimeStatus"),jn({},e)).then((e=>$n(e).then((e=>({status:e.status}))))),this.getSequenceContext=e=>this.fetch(this.url("GetSequenceContext"),jn({},e)).then((e=>$n(e).then((e=>({data:e.data}))))),this.getChainID=e=>this.fetch(this.url("GetChainID"),jn({},e)).then((e=>$n(e).then((e=>({chainID:e.chainID}))))),this.sendMetaTxn=(e,t)=>this.fetch(this.url("SendMetaTxn"),jn(e,t)).then((e=>$n(e).then((e=>({status:e.status,txnHash:e.txnHash}))))),this.getMetaTxnNonce=(e,t)=>this.fetch(this.url("GetMetaTxnNonce"),jn(e,t)).then((e=>$n(e).then((e=>({nonce:e.nonce}))))),this.getMetaTxnReceipt=(e,t)=>this.fetch(this.url("GetMetaTxnReceipt"),jn(e,t)).then((e=>$n(e).then((e=>({receipt:e.receipt}))))),this.simulate=(e,t)=>this.fetch(this.url("Simulate"),jn(e,t)).then((e=>$n(e).then((e=>({results:e.results}))))),this.updateMetaTxnGasLimits=(e,t)=>this.fetch(this.url("UpdateMetaTxnGasLimits"),jn(e,t)).then((e=>$n(e).then((e=>({payload:e.payload}))))),this.feeTokens=e=>this.fetch(this.url("FeeTokens"),jn({},e)).then((e=>$n(e).then((e=>({isFeeRequired:e.isFeeRequired,tokens:e.tokens}))))),this.feeOptions=(e,t)=>this.fetch(this.url("FeeOptions"),jn(e,t)).then((e=>$n(e).then((e=>({options:e.options,quote:e.quote}))))),this.getMetaTxnNetworkFeeOptions=(e,t)=>this.fetch(this.url("GetMetaTxnNetworkFeeOptions"),jn(e,t)).then((e=>$n(e).then((e=>({options:e.options}))))),this.sentTransactions=(e,t)=>this.fetch(this.url("SentTransactions"),jn(e,t)).then((e=>$n(e).then((e=>({page:e.page,transactions:e.transactions}))))),this.pendingTransactions=(e,t)=>this.fetch(this.url("PendingTransactions"),jn(e,t)).then((e=>$n(e).then((e=>({page:e.page,transactions:e.transactions}))))),this.listGasSponsors=(e,t)=>this.fetch(this.url("ListGasSponsors"),jn(e,t)).then((e=>$n(e).then((e=>({page:e.page,gasSponsors:e.gasSponsors}))))),this.addGasSponsor=(e,t)=>this.fetch(this.url("AddGasSponsor"),jn(e,t)).then((e=>$n(e).then((e=>({status:e.status,gasSponsor:e.gasSponsor}))))),this.updateGasSponsor=(e,t)=>this.fetch(this.url("UpdateGasSponsor"),jn(e,t)).then((e=>$n(e).then((e=>({status:e.status,gasSponsor:e.gasSponsor}))))),this.reportGasSponsorUsage=(e,t)=>this.fetch(this.url("ReportGasSponsorUsage"),jn(e,t)).then((e=>$n(e).then((e=>({gasSponsorUsage:e.gasSponsorUsage}))))),this.hostname=e,this.fetch=(e,n)=>t(e,n)}url(e){return this.hostname+this.path+e}}const jn=(e={},t={})=>({method:"POST",headers:i({},t,{"Content-Type":"application/json"}),body:JSON.stringify(e||{})}),$n=e=>e.text().then((t=>{let n;try{n=JSON.parse(t)}catch(n){throw{code:"unknown",msg:`expecting JSON, got: ${t}`,status:e.status}}if(!e.ok)throw n;return n}));var Hn=Object.freeze({__proto__:null,WebRPCVersion:"v1",WebRPCSchemaVersion:"v0.4.0",WebRPCSchemaHash:"dd44f90f38fc726a1f1430cfece544c3316f6b4f",get ETHTxnStatus(){return qn},get TransferType(){return Wn},get FeeTokenType(){return Bn},get SortOrder(){return Fn},Relayer:Gn});const Vn=[qn.DROPPED,qn.SUCCEEDED,qn.PARTIALLY_FAILED,qn.FAILED],Jn=[qn.DROPPED,qn.PARTIALLY_FAILED,qn.FAILED];function Kn(e){return void 0!==e.url&&"string"==typeof e.url}class zn extends Mn{constructor(e){super(e),this.service=void 0,this.service=new Gn(e.url,global.fetch)}async waitReceipt(e,t=1e3,n=5,s){"string"!=typeof e&&(Se.info("computing id",e.config,e.context,e.chainId,...e.transactions),e=pn(le(e.config,e.context),e.chainId,...e.transactions)),Se.info(`[rpc-relayer/waitReceipt] waiting for ${e}`);let i=0;for(;void 0===s||!s();){try{const{receipt:t}=await this.service.getMetaTxnReceipt({metaTxID:e});if(t&&t.txnReceipt&&"null"!==t.txnReceipt&&Vn.includes(t.status))return{receipt:t}}catch(e){if(i++,i===n)throw e}void 0!==s&&s()||await new Promise((e=>setTimeout(e,t)))}throw new Error(`Cancelled waiting for transaction receipt ${e}`)}async simulate(e,...n){const s=t.ethers.utils.defaultAbiCoder.encode([ln],[bn(n)]);return(await this.service.simulate({wallet:e,transactions:s})).results}async getFeeOptions(e,s,...i){const r=await this.service.feeTokens();if(r.isFeeRequired){const a=r.tokens.map((e=>e.symbol)).join(", ");Se.info(`[rpc-relayer/getFeeOptions] relayer fees are required, accepted tokens are ${a}`);const o=le(e,s);let c=vn(...i);if(void 0===c&&(c=await this.getNonce(e,s)),!this.provider)throw Se.warn("[rpc-relayer/getFeeOptions] provider not set, needed for stub signature"),new Error("provider is not set");const{to:l,execute:h}=await this.prependWalletDeploy({config:e,context:s,transactions:i,nonce:c,signature:Bt(this.provider,e)}),d=new t.ethers.utils.Interface(n.mainModule.abi),u=d.encodeFunctionData(d.getFunction("execute"),[bn(h.transactions),h.nonce,h.signature]),{options:p,quote:g}=await this.service.feeOptions({wallet:o,to:l,data:u});return Se.info(`[rpc-relayer/getFeeOptions] got refund options ${JSON.stringify(p)}`),{options:p,quote:{_tag:"FeeQuote",_quote:g}}}return Se.info("[rpc-relayer/getFeeOptions] relayer fees are not required"),{options:[]}}async gasRefundOptions(e,t,...n){const{options:s}=await this.getFeeOptions(e,t,...n);return s}async getNonce(e,n,s){const i=le(e,n);Se.info(`[rpc-relayer/getNonce] get nonce for wallet ${i} space: ${s}`);const r=void 0!==s?t.ethers.BigNumber.from(s).toHexString():void 0,a=await this.service.getMetaTxnNonce({walletContractAddress:i,space:r}),o=t.ethers.BigNumber.from(a.nonce),[c,l]=Sn(o);return Se.info(`[rpc-relayer/getNonce] got next nonce for wallet ${i} ${l} space: ${c}`),o}async relay(e,s,i=!0){var r=this;let a;if(Se.info(`[rpc-relayer/relay] relaying signed meta-transactions ${JSON.stringify(e)} with quote ${JSON.stringify(s)}`),void 0!==s&&("string"==typeof s._quote?a=s._quote:Se.warn("[rpc-relayer/relay] ignoring invalid fee quote")),!this.provider)throw Se.warn("[rpc-relayer/relay] provider not set, failed relay"),new Error("provider is not set");const{to:o,execute:c}=await this.prependWalletDeploy(e),l=le(e.config,e.context),h=new t.ethers.utils.Interface(n.mainModule.abi),d=h.encodeFunctionData(h.getFunction("execute"),[bn(c.transactions),c.nonce,c.signature]),u=await this.service.sendMetaTxn({call:{walletAddress:l,contract:o,input:d},quote:a});if(Se.info(`[rpc-relayer/relay] got relay result ${JSON.stringify(u)}`),i)return this.wait(u.txnHash);{const e={hash:u.txnHash,confirmations:0,from:l,wait:e=>Promise.reject(new Error("impossible"))},t=async function(t){var n;if(!r.provider)throw new Error("cannot wait for receipt, relayer has no provider set");const s=await r.wait(u.txnHash),i=null==(n=s.receipt)?void 0:n.transactionHash;if(!i)throw new Error("cannot wait for receipt, unknown native transaction hash");return Object.assign(e,s),r.provider.waitForTransaction(i,t)};return e.wait=t,e}}async wait(e,n,s=1e3,i=5){var r=this;let a=!1;const{receipt:o}=await(void 0!==n?Promise.race([this.waitReceipt(e,s,i,(()=>a)),new Promise(((t,s)=>setTimeout((()=>{a=!0,s(`Timeout waiting for transaction receipt ${e}`)}),n)))]):this.waitReceipt(e,s,i));if(!o.txnReceipt||Jn.includes(o.status))throw new Zn(o);const c=JSON.parse(o.txnReceipt);return{blockHash:c.blockHash,blockNumber:t.ethers.BigNumber.from(c.blockNumber).toNumber(),confirmations:1,from:"string"==typeof e?void 0:le(e.config,e.context),hash:c.transactionHash,raw:o.txnReceipt,receipt:c,wait:async function(e){return r.provider.waitForTransaction(c.transactionHash,e)}}}}class Zn{constructor(e){this.receipt=e}}function Yn(e){return"object"==typeof e&&"function"==typeof e.simulate&&"function"==typeof e.getFeeOptions&&"function"==typeof e.gasRefundOptions&&"function"==typeof e.getNonce&&"function"==typeof e.relay&&"function"==typeof e.wait}class Qn extends an{constructor(e,...t){super(),this.options=void 0,this._wallets=void 0,this._signers=void 0,this.provider=void 0,this._chainId=void 0,this.options=e,this._signers=t,e.context||(this.options.context=i({},at)),this.options.networks?this.setNetworks(this.options.networks):this.setNetworks([...it])}useSigners(...e){return this._signers=e,this._wallets.forEach((t=>{t.wallet=t.wallet.useSigners(...e)})),this}async getWalletContext(){return this.options.context}getConfigFinder(){return this.options.configFinder?this.options.configFinder:new Be(this.authWallet().wallet.provider)}async getWalletConfig(e){let t=[];if(e){const n=this.getWalletByNetwork(e);n&&t.push(n)}else t=this._wallets;return(await Promise.all(t.map((e=>e.wallet.getWalletConfig())))).flat()}async getWalletState(e){let t=[];if(e){const n=this.getWalletByNetwork(e);n&&t.push(n)}else t=this._wallets;const n=Promise.all(t.map((e=>this.getConfigFinder().findCurrentConfig({address:e.wallet.address,provider:e.wallet.provider,context:e.wallet.context,knownConfigs:[e.wallet.config]})))),s=(await Promise.all(t.map((e=>e.wallet.getWalletState())))).flat(),r=s.findIndex((e=>e.chainId===this.getAuthChainId()));r>=0&&(s[r].config=await this.currentConfig(t[r].wallet));const a=await n;return s.map(((e,t)=>{var n;return i({},e,{config:null==(n=a[t])?void 0:n.config})}))}get address(){return this._wallets[0].wallet.address}getAddress(){return this._wallets[0].wallet.getAddress()}async getSigners(){return this._wallets[0].wallet.getSigners()}async getProvider(e){var t,n;return e?null==(n=this._wallets.find((t=>t.network.chainId===e)))?void 0:n.wallet.getProvider():null==(t=this.mainWallet())?void 0:t.wallet.getProvider()}async getRelayer(e){var t,n;return e?null==(n=this._wallets.find((t=>t.network.chainId===e)))?void 0:n.wallet.getRelayer():null==(t=this.mainWallet())?void 0:t.wallet.getRelayer()}async getNetworks(){return this.options.networks}async getChainId(){if(this._chainId)return this._chainId;const e=await this.provider.getNetwork();return this._chainId=e.chainId,this._chainId}getAuthChainId(){try{return this.options.networks.find((e=>e.isAuthChain)).chainId}catch(e){throw new Error("no auth network")}}async signMessage(e,t,n=!0,s=!1){var i=this;let{wallet:r}=await async function(){if(!t)return i.mainWallet();if(t.address){const e=await t.getChainId();return i.getWalletByNetwork(e)}return i.getWalletByNetwork(t)}(),a=await this.currentConfig(r);a=a||this._wallets[0].wallet.config,r=r.useConfig(a);const o=await r.signWeight();if(o.lt(r.config.threshold)&&!1!==n)throw new cn(`Sign message - wallet combined weight ${o.toString()} below required ${r.config.threshold.toString()}`);return r.signMessage(e,void 0,n,s)}async signAuthMessage(e,t=!0,n=!1){var s;return this.signMessage(e,null==(s=this.authWallet())?void 0:s.wallet,t,n)}async signTypedData(e,t,n,s,i=!0){const r=s?this.getWalletByNetwork(s).wallet:this.mainWallet().wallet,a=Pe({domain:e,types:t,message:n});return this.signMessage(a,r,i,!0)}async _signTypedData(e,t,n,s,i=!0){return this.signTypedData(e,t,n,s,i)}async hasEnoughSigners(e){const t=e?this.getWalletByNetwork(e).wallet:this.mainWallet().wallet,n=await this.currentConfig(t);return t.useConfig(n).hasEnoughSigners()}async getFeeOptions(e,t,n=!0){const s=t?this.getWalletByNetwork(t).wallet:this.mainWallet().wallet,i=this.options.context;if(!i)throw new Error("missing wallet context");const[r,a]=await Promise.all([this.currentConfig(s),this.prependConfigUpdate(e,t,n,!0)]);if(!r)throw new Error(`missing current config for chain ${t}`);const o=await Nn(i,this.address,a);return s.relayer.getFeeOptions(r,i,...o)}async sendTransaction(e,t,n=!0,s,i){const r=await this.signTransactions(e,t,n);if(i){i(r,pn(le(r.config,r.context),r.chainId,...r.transactions))}return(t?this.getWalletByNetwork(t).wallet:this.mainWallet().wallet).sendSignedTransactions(r,t,s)}async sendTransactionBatch(e,t,n=!0,s,i){return this.sendTransaction(e,t,n,s,i)}async signTransactions(e,t,n){const s=t?this.getWalletByNetwork(t).wallet:this.mainWallet().wallet;let i=await this.currentConfig(s);if(!i&&(i=await this.currentConfig(),!i))throw new Error("missing auth chain config");const r=await this.prependConfigUpdate(e,t,n);return s.useConfig(i).signTransactions(r)}async prependConfigUpdate(e,t,n,s){const i=await On(e),r=t?this.getWalletByNetwork(t).wallet:this.mainWallet().wallet,[a,o]=await Promise.all([this.currentConfig(r),this.currentConfig()]);if(!s){const e=await r.useConfig(a).signWeight();if(e.lt(a.threshold)&&n)throw new cn(`wallet combined weight ${e.toString()} below required threshold ${a.threshold.toString()}`)}if(await r.isDeployed()&&ue(o,a))return i;const c=Array.isArray(i)?i:[i];return[...await r.buildUpdateConfigTransaction(o,!1),...c]}async sendSignedTransactions(e,t,n){return(t?this.getWalletByNetwork(t).wallet:this.mainWallet().wallet).sendSignedTransactions(e,void 0,n)}async updateConfig(e,t,n,s){const r=this.authWallet().wallet;if(e=e?de(e):r.config,ue(r.config,e)&&!await this.isDeployed())return await r.updateConfig(e,void 0,!0,t,n,s);const a=await this.currentConfig();if(ue(a,e))return[i({},a,{address:this.address}),void 0];const[o,c]=await r.useConfig(a).updateConfig(e,void 0,!0,t,n,s);return[i({},e,{address:this.address}),c]}publishConfig(e,t=[],n,s){return this.authWallet().wallet.publishConfig(e,void 0,t,n,s)}async isDeployed(e){return(()=>e?e.address?e:this.getWalletByNetwork(e).wallet:this.authWallet().wallet)().isDeployed()}async currentConfig(e){const t=(()=>e?e.address?e:this.getWalletByNetwork(e).wallet:this.authWallet().wallet)();return(await this.getConfigFinder().findCurrentConfig({address:this.address,provider:t.provider,context:t.context,knownConfigs:[t.config]})).config}getWallets(){return this._wallets}getWalletByNetwork(e){const t=je(e),n=this._wallets.find((e=>e.network.chainId===t));if(!n)throw new Error(`network ${e} not found in wallets list`);return n}mainWallet(){const e=this._wallets.find((e=>e.network.isDefaultChain));if(!e)throw new Error("mainWallet not found");return e}authWallet(){const e=this._wallets.find((e=>e.network.isAuthChain));if(!e)throw new Error("authChain wallet not found");return e}setNetworks(e,t=[],n){let s=[];if(this._chainId=void 0,n){const i=parseInt(n),r=e.find((e=>e.name===n||e.chainId===i)),a=t.find((e=>e.name===n||e.chainId===i));if(!r&&!a)throw new Error(`unable to set default network as chain '${n}' does not exist`);r?(e.forEach((e=>e.isDefaultChain=!1)),r.isDefaultChain=!0,s=e):a&&(t.forEach((e=>e.isDefaultChain=!1)),a.isDefaultChain=!0,s=t)}else s=e;return this.options.networks=Je(Ye(s)),this._wallets=this.options.networks.map((e=>{const t=new Pn({config:this.options.initialConfig,context:this.options.context},...this._signers);if(e.provider)t.setProvider(e.provider);else{if(!e.rpcUrl||""===e.rpcUrl)throw new Error(`network config is missing provider settings for chainId ${e.chainId}`);t.setProvider(e.rpcUrl)}if(Yn(e.relayer))t.setRelayer(e.relayer);else{if(!Kn(e.relayer))throw new Error(`network config is missing relayer settings for chainId ${e.chainId}`);t.setRelayer(new zn(i({provider:t.provider},e.relayer)))}return e.isDefaultChain&&(this._chainId=e.chainId,this.provider=t.provider),{network:e,wallet:t}})),this.options.networks.find((e=>e.isDefaultChain)).chainId}connect(e){throw new Error("connect method is not supported in MultiWallet")}signTransaction(e){throw new Error("signTransaction method is not supported in MultiWallet, please use signTransactions(...)")}}async function Xn(e,s,i,r,a,o){if(function(e,n,s){try{return 0===pe(t.ethers.utils.recoverAddress(n,t.ethers.utils.splitSignature(s)),e)}catch(e){return!1}}(e,s,i)||function(e,n,s){try{const i=t.ethers.utils.keccak256(t.ethers.utils.solidityPack(["string","bytes32"],["Ethereum Signed Message:\n32",n]));return 0===pe(t.ethers.utils.recoverAddress(i,t.ethers.utils.splitSignature(s)),e)}catch(e){return!1}}(e,s,i))return!0;const c=await async function(e,s,i,r){if(!r)return;try{if("0x"===await r.getCode(e))return;const a=new t.ethers.Contract(e,n.erc1271.abi,r),o=await a.isValidSignature(s,i);return n.erc1271.returns.isValidSignatureBytes32===o}catch(e){return!1}}(e,s,i,r);return void 0===c?!!await es(e,s,i,a,r,o):c}async function es(e,n,s,i,r,a){if((r||a)&&i)try{const o=a||(await r.getNetwork()).chainId,c=Rt(s),l=t.ethers.utils.arrayify(t.ethers.utils.keccak256(ve(e,o,n))),h=await ns(l,c,r,i,a,!0),d=c.signers.reduce(((e,t)=>xt(t)||Ot(t)?e+t.weight:e),0);return 0===pe(le(h,i),e)&&d>=c.threshold}catch(e){return!1}}const ts=async e=>{const s=await e.getAddress(),i=new t.Contract(s,n.mainModuleUpgradable.abi,await e.getProvider()),r=await i.functions.imageHash.call([]).catch((()=>[]));return r&&r.length>0?r[0]:""},ns=async(e,n,s,i,r,a)=>{const o=void 0!==n.threshold?n:Rt(n),c=await Promise.all(o.signers.map((async n=>{if(xt(n))return{weight:n.weight,address:Lt(e,n)};if(Nt(n))return{weight:n.weight,address:t.ethers.utils.getAddress(n.address)};if(Ot(n)){if(a&&!await Xn(n.address,t.ethers.utils.arrayify(e),t.ethers.utils.hexlify(n.signature),s,i,r))throw Error("Invalid signature");return{weight:n.weight,address:n.address}}throw Error("Uknown signature type")})));return{threshold:o.threshold,signers:c}},ss=604800;class is{constructor(e,t,n,s,i,r,a,o,c){var l;(this.sequenceApiUrl=e,this.sequenceMetadataUrl=t,this.networks=n,this.config=s,this.context=i,this.account=r,this.metadata=a,this.authProvider=o,this._initialAuthRequest=void 0,this._jwt=void 0,this.proofStrings=new Map,this.onAuthCallbacks=[],this.apiClient=void 0,this.metadataClient=void 0,this.indexerClients=new Map,c)&&(this._jwt={token:Promise.resolve(c.token),expiration:null!=(l=c.expiration)?l:as(c.token)})}get name(){return this.metadata.name}get expiration(){return this.metadata.expiration?Math.max(this.metadata.expiration,120):ss}onAuth(e){this.onAuthCallbacks.push(e)}setAccount(e){this.account=e}setConfig(e){this.config=e}async auth(e=5){const t=this.sequenceApiUrl;if(!t)throw Error("No sequence api url");let n;for(let t=0;;t++)try{n=(await this.getJWT(!0)).token;break}catch(n){if(t===e-1)throw console.error(`couldn't authenticate after ${e} attempts`,n),n}return new d(t,n)}get isTestnetMode(){if(this.networks&&0!==this.networks.length)return!!this.networks[0].testnet}async getAPIClient(e=!0){if(!this.apiClient){const t=this.sequenceApiUrl;if(!t)throw Error("No chaind url");const n=(await this.getJWT(e)).token;this.apiClient=new d(t,n)}return this.apiClient}getMetadataClient(){return this.metadataClient||(this.metadataClient=new rn(this.sequenceMetadataUrl)),this.metadataClient}async getIndexerClient(e){const t=Ze(this.networks,e);if(!t)throw Error(`No network for chain ${e}`);const n=(await this.getJWT(!0)).token;if(!this.indexerClients.has(t.chainId))if(t.indexer)this.indexerClients.set(t.chainId,t.indexer);else{if(!t.indexerUrl)throw Error(`No indexer url for chain ${e}`);this.indexerClients.set(t.chainId,new Zt(t.indexerUrl,n))}return this.indexerClients.get(t.chainId)}async getJWT(e){var t=this;const n=this.sequenceApiUrl;if(!n)throw Error("No chaind url");if(this._jwt){const e=this._jwt,t=await e.token;if(this.now()<e.expiration)return{token:t,expiration:e.expiration};this._jwt=void 0}if(!e)throw new Error("no auth token in memory");const s=this.getProofStringKey(),{proofString:i,expiration:r}=this.getProofString(s),a={token:i.then((async function(e){const i=new d(n),r=await i.getAuthToken({ewtString:e,testnetMode:t.isTestnetMode});if(!0===(null==r?void 0:r.status)&&0!==r.jwtToken.length)return r.jwtToken;throw await t.isProofStringValid(e)||t.proofStrings.delete(s),new Error("no auth token from server")})).catch((e=>{throw this._jwt=void 0,e})),expiration:r};this._jwt=a,a.token.then((()=>{this.onAuthCallbacks.forEach((e=>{try{e({status:"fulfilled",value:void 0})}catch(e){}}))})).catch((e=>{this.onAuthCallbacks.forEach((t=>{try{t({status:"rejected",reason:e})}catch(e){}}))}));return{token:await a.token,expiration:r}}getProofString(e){if(this.proofStrings.has(e)){const t=this.proofStrings.get(e);if(this.now()<t.expiration)return t;this.proofStrings.delete(e)}const t=new J({address:this.account.address});t.claims.app=this.name,t.setExpiryIn(this.expiration);const n=new te,s=new Be(this.authProvider),i=this.account.authWallet(),r=this.now()+this.expiration-60,a={proofString:s.findCurrentConfig({address:i.wallet.address,provider:this.authProvider,context:i.wallet.context,knownConfigs:[i.wallet.config]}).then((e=>{if(!e.config)throw Error("Can't find latest config");return i.wallet.useConfig(e.config).sign(t.messageDigest()).then((e=>{const s=Rt(e),i=s.signers.filter(Tt).reduce(((e,t)=>e+t.weight),0);if(i<s.threshold)throw Error(`insufficient signing power, need ${s.threshold}, have ${i}`);return t.signature=e,n.encodeProof(t,!0)}))})).catch((t=>{throw this.proofStrings.delete(e),t})),expiration:r};return this.proofStrings.set(e,a),a}getProofStringKey(){return`${this.account.address} - ${this.name}`}async isProofStringValid(e){try{const t=new te;return t.provider=this.authProvider,await t.decodeProof(e),!0}catch(e){return!1}}async dump(){let e;if(this._jwt)try{const t=this._jwt.expiration;e={token:await this._jwt.token,expiration:t}}catch(e){}return{config:this.config,context:this.context,metadata:this.metadata,jwt:e}}now(){return Math.floor((new Date).getTime()/1e3)}static async open(e){const{sequenceApiUrl:t,sequenceMetadataUrl:n,context:s,networks:r,referenceSigner:a,signers:o,threshold:c,deepSearch:l,knownConfigs:h,noIndex:d,metadata:u}=e,p=rs(r),g=e.configFinder?e.configFinder:new Be(p),f=Promise.all(o.map((async function(e){return i({},e,{address:"string"==typeof e.signer?e.signer:await e.signer.getAddress()})}))),w=o.filter((e=>"string"!=typeof e.signer)).map((e=>e.signer)),m=(await g.findLastWalletOfInitialSigner({signer:a,context:s,provider:p,requireIndex:!l})).wallet;if(m){const e=(await g.findCurrentConfig({address:m,provider:p,context:s,knownConfigs:h})).config;if(!e)throw Error("Wallet config not found");const i=new Qn({initialConfig:e,networks:r,context:s},...w),a=new is(t,n,r,e,s,i,u,p),[o]=await i.updateConfig(ge(e,{threshold:c,set:await f}),!d);return a.setConfig(o),a.setAccount(new Qn({initialConfig:o,networks:r,context:s},...w)),a._initialAuthRequest=t?a.auth():Promise.reject("no sequence api url"),a}{const e=fe(c,await f),i=new Qn({initialConfig:e,networks:r,context:s},...w);await i.publishConfig(!d,[a]);const o=new is(t,n,r,e,s,i,u,p);return o._initialAuthRequest=t?o.auth():Promise.reject("no sequence api url"),o}}static load(e){const{sequenceApiUrl:t,sequenceMetadataUrl:n,dump:s,signers:i,networks:r}=e;return new is(t,n,r,s.config,s.context,new Qn({initialConfig:s.config,context:s.context,networks:r},...i),s.metadata,rs(r),s.jwt)}}function rs(e){var n;const s=He(e);if(!s)throw Error("Auth chain not found");return null!=(n=s.provider)?n:new t.ethers.providers.JsonRpcProvider(s.rpcUrl)}function as(e){return Ee(e).exp}const os=async(e,n)=>{const s=await e.getChainId(),i=t.ethers.utils.getAddress(await e.getAddress());if(!i||""===i||"0x"===i)throw ls;const r=new J;if(r.address=i,!n||!n.app||""===n.app)throw new cs("authorization options requires app to be set");r.claims.app=n.app,r.claims.ogn=n.origin,r.setExpiryIn(n.expiry?Math.max(n.expiry,200):ss);const a=r.messageTypedData();r.signature=await e.signTypedData(a.domain,a.types,a.message,s);const o=new te;return{typedData:a,proofString:await o.encodeProof(r,!0)}};class cs extends Error{constructor(e){super(e),this.name="AuthError"}}const ls=new cs("auth error: account address is empty");var hs=Object.freeze({__proto__:null,signAuthorization:os,AuthError:cs,ErrAccountIsRequired:ls,ValidateSequenceDeployedWalletProof:async(e,n,s)=>{if(!e||void 0===e||void 0===n)return{isValid:!1};const i=s.messageDigest(),r=await e.getCode(s.address);if("0x"===r||r.length<=2)throw new Error("ValidateSequenceDeployedWalletProof failed. unable to fetch wallet contract code");const a=new t.ethers.Contract(s.address,["function isValidSignature(bytes32, bytes) public view returns (bytes4)"],e);return await a.isValidSignature(i,t.ethers.utils.arrayify(s.signature))===Y?{isValid:!0}:{isValid:!1}},ValidateSequenceUndeployedWalletProof:e=>async(n,s,i)=>{if(!n||void 0===n||void 0===s)return{isValid:!1};if(0!==t.ethers.utils.arrayify(await n.getCode(i.address)).length)return{isValid:!1};const r=i.messageDigest(),a=t.ethers.utils.arrayify(t.ethers.utils.keccak256(r));return{isValid:!!await es(i.address,a,i.signature,e||at,n,s)}},DEFAULT_SESSION_EXPIRATION:ss,LONG_SESSION_EXPIRATION:3e7,Session:is}),ds=Object.freeze({__proto__:null,WalletContractBytecode:ne,createWalletConfig:async(e,n)=>{const s={threshold:e,signers:[]};if(n.forEach((async e=>{s.signers.push({weight:e.weight,address:t.Signer.isSigner(e.signer)?await e.signer.getAddress():e.signer})})),!ce(s))throw new Error("wallet config is not usable");return s},isUsableConfig:ce,isValidConfigSigners:(e,n)=>{if(0===n.length)return!0;const s=e.signers.map((e=>t.ethers.utils.getAddress(e.address))),i=n.map((e=>t.ethers.utils.getAddress(e)));let r=!0;return i.forEach((e=>{s.includes(e)||(r=!1)})),r},addressOf:le,imageHash:he,sortConfig:de,isConfigEqual:ue,compareAddr:pe,editConfig:ge,genConfig:fe,ConfigFinder:class{constructor(){this.findCurrentConfig=void 0,this.findLastWalletOfInitialSigner=void 0}},SequenceUtilsFinder:Be,isDecodedAddress:Nt,isDecodedSigner:Tt,isDecodedEOASigner:xt,isDecodedEOASplitSigner:At,isDecodedFullSigner:Ot,get SignatureType(){return Pt},decodeSignature:Rt,splitDecodedEOASigner:Mt,recoverEOASigner:Lt,joinSignatures:Ut,joinTwoSignatures:Dt,encodeSignature:qt,signerOf:Wt,mutateSignature:function(e,t,n){const s=e.signers.map((e=>Wt(e,n)));return{threshold:t.threshold,signers:t.signers.map((t=>{const n=s.indexOf(t.address);if(-1!==n){return i({},e.signers[n],{weight:t.weight})}return{weight:t.weight,address:t.address}}))}},buildStubSignature:Bt}),us=Object.freeze({__proto__:null,WebRPCVersion:"v1",WebRPCSchemaVersion:"v0.4.0",WebRPCSchemaHash:"8d39664df13fabe72919e65140f9563b21aa3531",Guard:class{constructor(e,t){this.hostname=void 0,this.fetch=void 0,this.path="/rpc/Guard/",this.ping=e=>this.fetch(this.url("Ping"),xn({},e)).then((e=>An(e).then((e=>({status:e.status}))))),this.version=e=>this.fetch(this.url("Version"),xn({},e)).then((e=>An(e).then((e=>({version:e.version}))))),this.runtimeStatus=e=>this.fetch(this.url("RuntimeStatus"),xn({},e)).then((e=>An(e).then((e=>({status:e.status}))))),this.getSequenceContext=e=>this.fetch(this.url("GetSequenceContext"),xn({},e)).then((e=>An(e).then((e=>({data:e.data}))))),this.getSignerConfig=e=>this.fetch(this.url("GetSignerConfig"),xn({},e)).then((e=>An(e).then((e=>({signerConfig:e.signerConfig}))))),this.sign=(e,t)=>this.fetch(this.url("Sign"),xn(e,t)).then((e=>An(e).then((e=>({sig:e.sig}))))),this.hostname=e,this.fetch=(e,n)=>t(e,n)}url(e){return this.hostname+this.path+e}}}),ps=Object.freeze({__proto__:null,WebRPCVersion:"v1",WebRPCSchemaVersion:"v0.4.0",WebRPCSchemaHash:"7cdd11a44d6d1c5371dca8be8a603b1c67d53e22",get ContractType(){return Ft},get EventLogType(){return Gt},get EventLogDataType(){return jt},get TxnTransferType(){return $t},get SortOrder(){return Ht},Indexer:Vt,get SequenceIndexerServices(){return zt},SequenceIndexerClient:Zt}),gs=Object.freeze({__proto__:null,WebRPCVersion:"v1",WebRPCSchemaVersion:"v0.4.0",WebRPCSchemaHash:"af94302de504695d49c89615d251934712903381",get ContractType(){return Yt},get PropertyType(){return Qt},get SwapType(){return Xt},get SortOrder(){return en},Metadata:tn,SequenceMetadataClient:rn}),fs=Object.freeze({__proto__:null,Multicall:_t,providers:It}),ws=Object.freeze({__proto__:null,get ChainId(){return Xe},indexerURL:et,relayerURL:tt,nodesURL:nt,networks:st,mainnetNetworks:it,testnetNetworks:rt,sequenceContext:at,JsonRpcVersion:ot,JsonRpcRouter:ct,createJsonRpcMiddlewareStack:lt,JsonRpcSender:pt,JsonRpcExternalProvider:class{constructor(e){this.provider=e,this.sendAsync=(e,t)=>{this.provider.send(e.method,e.params).then((n=>{t(void 0,{jsonrpc:"2.0",id:e.id,result:n})})).catch((e=>{t(e,void 0)}))},this.send=this.sendAsync}},AllowProvider:class{constructor(e){this.sendAsyncMiddleware=void 0,this.isAllowedFunc=void 0,this.isAllowedFunc=e||(e=>!0),this.sendAsyncMiddleware=gt(this.isAllowedFunc)}setIsAllowedFunc(e){this.isAllowedFunc=e,this.sendAsyncMiddleware=gt(this.isAllowedFunc)}},allowProviderMiddleware:gt,CachedProvider:ft,EagerProvider:wt,exceptionProviderMiddleware:mt,loggingProviderMiddleware:yt,networkProviderMiddleware:vt,PublicProvider:class{constructor(e){this.privateJsonRpcMethods=["net_version","eth_chainId","eth_accounts",...bt],this.provider=void 0,this.rpcUrl=void 0,this.sendAsyncMiddleware=e=>(t,n)=>{!this.provider||this.privateJsonRpcMethods.includes(t.method)?(Se.debug("[public-provider] sending request to signer window",t.method),e(t,n)):this.provider.send(t.method,t.params).then((e=>{n(void 0,{jsonrpc:"2.0",id:t.id,result:e})})).catch((e=>n(e)))},e&&this.setRpcUrl(e)}getRpcUrl(){return this.rpcUrl}setRpcUrl(e){e&&""!==e?(this.rpcUrl=e,this.provider=new t.providers.JsonRpcProvider(e)):(this.rpcUrl=void 0,this.provider=void 0)}},SigningProvider:Ct,isJsonRpcProvider:ht,isJsonRpcHandler:dt,isNetworkConfig:function(e){return e&&void 0!==e.chainId&&void 0!==e.name&&void 0!==e.rpcUrl&&void 0!==e.relayer},getChainId:je,maybeChainId:$e,getAuthNetwork:He,isValidNetworkConfig:Ve,ensureValidNetworks:Je,ensureUniqueNetworks:(e,t=!0)=>{const n=e.map((e=>e.chainId)).sort(),s=n.filter(((e,t)=>n.indexOf(e)!==t));if(s.length>0){if(t)throw new Error(`invalid network config: duplicate chainIds ${s}`);return!1}return!0},updateNetworkConfig:Ke,validateAndSortNetworks:ze,findNetworkConfig:Ze,checkNetworkConfig:(e,t)=>!!e&&(e.name===t||e.chainId===t),networksIndex:e=>{const t={};for(let n=0;n<e.length;n++)t[e[n].name]=e[n];return t},sortNetworks:Ye,stringTemplate:Qe});var ms=function(e,t,n){return e(n={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&n.path)}},n.exports),n.exports}((function(e,t){!function(t){var n=Object.hasOwnProperty,s=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},i="object"==typeof process&&"function"==typeof process.nextTick,r="function"==typeof Symbol,a="object"==typeof Reflect,o="function"==typeof setImmediate?setImmediate:setTimeout,c=r?a&&"function"==typeof Reflect.ownKeys?Reflect.ownKeys:function(e){var t=Object.getOwnPropertyNames(e);return t.push.apply(t,Object.getOwnPropertySymbols(e)),t}:Object.keys;function l(){this._events={},this._conf&&h.call(this,this._conf)}function h(e){e&&(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),e.maxListeners!==t&&(this._maxListeners=e.maxListeners),e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this._newListener=e.newListener),e.removeListener&&(this._removeListener=e.removeListener),e.verboseMemoryLeak&&(this.verboseMemoryLeak=e.verboseMemoryLeak),e.ignoreErrors&&(this.ignoreErrors=e.ignoreErrors),this.wildcard&&(this.listenerTree={}))}function d(e,t){var n="(node) warning: possible EventEmitter memory leak detected. "+e+" listeners added. Use emitter.setMaxListeners() to increase limit.";if(this.verboseMemoryLeak&&(n+=" Event name: "+t+"."),"undefined"!=typeof process&&process.emitWarning){var s=new Error(n);s.name="MaxListenersExceededWarning",s.emitter=this,s.count=e,process.emitWarning(s)}else console.error(n),console.trace&&console.trace()}var u=function(e,t,n){var s=arguments.length;switch(s){case 0:return[];case 1:return[e];case 2:return[e,t];case 3:return[e,t,n];default:for(var i=new Array(s);s--;)i[s]=arguments[s];return i}};function p(e,n){for(var s={},i=e.length,r=n?n.length:0,a=0;a<i;a++)s[e[a]]=a<r?n[a]:t;return s}function g(e,t,n){var s,i;if(this._emitter=e,this._target=t,this._listeners={},this._listenersCount=0,(n.on||n.off)&&(s=n.on,i=n.off),t.addEventListener?(s=t.addEventListener,i=t.removeEventListener):t.addListener?(s=t.addListener,i=t.removeListener):t.on&&(s=t.on,i=t.off),!s&&!i)throw Error("target does not implement any known event API");if("function"!=typeof s)throw TypeError("on method must be a function");if("function"!=typeof i)throw TypeError("off method must be a function");this._on=s,this._off=i;var r=e._observers;r?r.push(this):e._observers=[this]}function f(e,s,i,r){var a=Object.assign({},s);if(!e)return a;if("object"!=typeof e)throw TypeError("options must be an object");var o,c,l,h=Object.keys(e),d=h.length;function u(e){throw Error('Invalid "'+o+'" option value'+(e?". Reason: "+e:""))}for(var p=0;p<d;p++){if(o=h[p],!r&&!n.call(s,o))throw Error('Unknown "'+o+'" option');(c=e[o])!==t&&(l=i[o],a[o]=l?l(c,u):c)}return a}function w(e,t){return"function"==typeof e&&e.hasOwnProperty("prototype")||t("value must be a constructor"),e}function m(e){var t="value must be type of "+e.join("|"),n=e.length,s=e[0],i=e[1];return 1===n?function(e,n){if(typeof e===s)return e;n(t)}:2===n?function(e,n){var r=typeof e;if(r===s||r===i)return e;n(t)}:function(s,i){for(var r=typeof s,a=n;a-- >0;)if(r===e[a])return s;i(t)}}Object.assign(g.prototype,{subscribe:function(e,t,n){var s=this,i=this._target,r=this._emitter,a=this._listeners,o=function(){var s=u.apply(null,arguments),a={data:s,name:t,original:e};if(n){var o=n.call(i,a);!1!==o&&r.emit.apply(r,[a.name].concat(s))}else r.emit.apply(r,[t].concat(s))};if(a[e])throw Error("Event '"+e+"' is already listening");this._listenersCount++,r._newListener&&r._removeListener&&!s._onNewListener?(this._onNewListener=function(n){n===t&&null===a[e]&&(a[e]=o,s._on.call(i,e,o))},r.on("newListener",this._onNewListener),this._onRemoveListener=function(n){n===t&&!r.hasListeners(n)&&a[e]&&(a[e]=null,s._off.call(i,e,o))},a[e]=null,r.on("removeListener",this._onRemoveListener)):(a[e]=o,s._on.call(i,e,o))},unsubscribe:function(e){var t,n,s,i=this,r=this._listeners,a=this._emitter,o=this._off,l=this._target;if(e&&"string"!=typeof e)throw TypeError("event must be a string");function h(){i._onNewListener&&(a.off("newListener",i._onNewListener),a.off("removeListener",i._onRemoveListener),i._onNewListener=null,i._onRemoveListener=null);var e=C.call(a,i);a._observers.splice(e,1)}if(e){if(!(t=r[e]))return;o.call(l,e,t),delete r[e],--this._listenersCount||h()}else{for(s=(n=c(r)).length;s-- >0;)e=n[s],o.call(l,e,r[e]);this._listeners={},this._listenersCount=0,h()}}});var y=m(["function"]),v=m(["object","function"]);function b(e,t,n){var s,i,r,a=0,o=new e((function(c,l,h){function d(){i&&(i=null),a&&(clearTimeout(a),a=0)}n=f(n,{timeout:0,overload:!1},{timeout:function(e,t){return("number"!=typeof(e*=1)||e<0||!Number.isFinite(e))&&t("timeout must be a positive number"),e}}),s=!n.overload&&"function"==typeof e.prototype.cancel&&"function"==typeof h;var u=function(e){d(),c(e)},p=function(e){d(),l(e)};s?t(u,p,h):(i=[function(e){p(e||Error("canceled"))}],t(u,p,(function(e){if(r)throw Error("Unable to subscribe on cancel event asynchronously");if("function"!=typeof e)throw TypeError("onCancel callback must be a function");i.push(e)})),r=!0),n.timeout>0&&(a=setTimeout((function(){var e=Error("timeout");e.code="ETIMEDOUT",a=0,o.cancel(e),l(e)}),n.timeout))}));return s||(o.cancel=function(e){if(i){for(var t=i.length,n=1;n<t;n++)i[n](e);i[0](e),i=null}}),o}function C(e){var t=this._observers;if(!t)return-1;for(var n=t.length,s=0;s<n;s++)if(t[s]._target===e)return s;return-1}function E(e,t,n,s,i){if(!n)return null;if(0===s){var r=typeof t;if("string"===r){var a,o,l=0,h=0,d=this.delimiter,u=d.length;if(-1!==(o=t.indexOf(d))){a=new Array(5);do{a[l++]=t.slice(h,o),h=o+u}while(-1!==(o=t.indexOf(d,h)));a[l++]=t.slice(h),t=a,i=l}else t=[t],i=1}else"object"===r?i=t.length:(t=[t],i=1)}var p,g,f,w,m,y,v,b=null,C=t[s],_=t[s+1];if(s===i)n._listeners&&("function"==typeof n._listeners?(e&&e.push(n._listeners),b=[n]):(e&&e.push.apply(e,n._listeners),b=[n]));else{if("*"===C){for(o=(y=c(n)).length;o-- >0;)"_listeners"!==(p=y[o])&&(v=E(e,t,n[p],s+1,i))&&(b?b.push.apply(b,v):b=v);return b}if("**"===C){for((m=s+1===i||s+2===i&&"*"===_)&&n._listeners&&(b=E(e,t,n,i,i)),o=(y=c(n)).length;o-- >0;)"_listeners"!==(p=y[o])&&("*"===p||"**"===p?(n[p]._listeners&&!m&&(v=E(e,t,n[p],i,i))&&(b?b.push.apply(b,v):b=v),v=E(e,t,n[p],s,i)):v=E(e,t,n[p],p===_?s+2:s,i),v&&(b?b.push.apply(b,v):b=v));return b}n[C]&&(b=E(e,t,n[C],s+1,i))}if((g=n["*"])&&E(e,t,g,s+1,i),f=n["**"])if(s<i)for(f._listeners&&E(e,t,f,i,i),o=(y=c(f)).length;o-- >0;)"_listeners"!==(p=y[o])&&(p===_?E(e,t,f[p],s+2,i):p===C?E(e,t,f[p],s+1,i):((w={})[p]=f[p],E(e,t,{"**":w},s+1,i)));else f._listeners?E(e,t,f,i,i):f["*"]&&f["*"]._listeners&&E(e,t,f["*"],i,i);return b}function _(e,t,n){var s,i,r=0,a=0,o=this.delimiter,c=o.length;if("string"==typeof e)if(-1!==(s=e.indexOf(o))){i=new Array(5);do{i[r++]=e.slice(a,s),a=s+c}while(-1!==(s=e.indexOf(o,a)));i[r++]=e.slice(a)}else i=[e],r=1;else i=e,r=e.length;if(r>1)for(s=0;s+1<r;s++)if("**"===i[s]&&"**"===i[s+1])return;var l,h=this.listenerTree;for(s=0;s<r;s++)if(h=h[l=i[s]]||(h[l]={}),s===r-1)return h._listeners?("function"==typeof h._listeners&&(h._listeners=[h._listeners]),n?h._listeners.unshift(t):h._listeners.push(t),!h._listeners.warned&&this._maxListeners>0&&h._listeners.length>this._maxListeners&&(h._listeners.warned=!0,d.call(this,h._listeners.length,l))):h._listeners=t,!0;return!0}function k(e,t,n,s){for(var i,r,a,o,l=c(e),h=l.length,d=e._listeners;h-- >0;)i=e[r=l[h]],a="_listeners"===r?n:n?n.concat(r):[r],o=s||"symbol"==typeof r,d&&t.push(o?a:a.join(this.delimiter)),"object"==typeof i&&k.call(this,i,t,a,o);return t}function S(e){for(var t,n,s,i=c(e),r=i.length;r-- >0;)(t=e[n=i[r]])&&(s=!0,"_listeners"===n||S(t)||delete e[n]);return s}function I(e,t,n){this.emitter=e,this.event=t,this.listener=n}function N(e,n,s){if(!0===s)a=!0;else if(!1===s)r=!0;else{if(!s||"object"!=typeof s)throw TypeError("options should be an object or true");var r=s.async,a=s.promisify,c=s.nextTick,l=s.objectify}if(r||c||a){var h=n,d=n._origin||n;if(c&&!i)throw Error("process.nextTick is not supported");a===t&&(a="AsyncFunction"===n.constructor.name),n=function(){var e=arguments,t=this,n=this.event;return a?c?Promise.resolve():new Promise((function(e){o(e)})).then((function(){return t.event=n,h.apply(t,e)})):(c?process.nextTick:o)((function(){t.event=n,h.apply(t,e)}))},n._async=!0,n._origin=d}return[n,l?new I(this,e,n):this]}function T(e){this._events={},this._newListener=!1,this._removeListener=!1,this.verboseMemoryLeak=!1,h.call(this,e)}I.prototype.off=function(){return this.emitter.off(this.event,this.listener),this},T.EventEmitter2=T,T.prototype.listenTo=function(e,n,i){if("object"!=typeof e)throw TypeError("target musts be an object");var r=this;function a(t){if("object"!=typeof t)throw TypeError("events must be an object");var n,s=i.reducers,a=C.call(r,e);n=-1===a?new g(r,e,i):r._observers[a];for(var o,l=c(t),h=l.length,d="function"==typeof s,u=0;u<h;u++)o=l[u],n.subscribe(o,t[o]||o,d?s:s&&s[o])}return i=f(i,{on:t,off:t,reducers:t},{on:y,off:y,reducers:v}),s(n)?a(p(n)):a("string"==typeof n?p(n.split(/\s+/)):n),this},T.prototype.stopListeningTo=function(e,t){var n=this._observers;if(!n)return!1;var s,i=n.length,r=!1;if(e&&"object"!=typeof e)throw TypeError("target should be an object");for(;i-- >0;)s=n[i],e&&s._target!==e||(s.unsubscribe(t),r=!0);return r},T.prototype.delimiter=".",T.prototype.setMaxListeners=function(e){e!==t&&(this._maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e)},T.prototype.getMaxListeners=function(){return this._maxListeners},T.prototype.event="",T.prototype.once=function(e,t,n){return this._once(e,t,!1,n)},T.prototype.prependOnceListener=function(e,t,n){return this._once(e,t,!0,n)},T.prototype._once=function(e,t,n,s){return this._many(e,1,t,n,s)},T.prototype.many=function(e,t,n,s){return this._many(e,t,n,!1,s)},T.prototype.prependMany=function(e,t,n,s){return this._many(e,t,n,!0,s)},T.prototype._many=function(e,t,n,s,i){var r=this;if("function"!=typeof n)throw new Error("many only accepts instances of Function");function a(){return 0==--t&&r.off(e,a),n.apply(this,arguments)}return a._origin=n,this._on(e,a,s,i)},T.prototype.emit=function(){if(!this._events&&!this._all)return!1;this._events||l.call(this);var e,t,n,s,i,a,o=arguments[0],c=this.wildcard;if("newListener"===o&&!this._newListener&&!this._events.newListener)return!1;if(c&&(e=o,"newListener"!==o&&"removeListener"!==o&&"object"==typeof o)){if(n=o.length,r)for(s=0;s<n;s++)if("symbol"==typeof o[s]){a=!0;break}a||(o=o.join(this.delimiter))}var h,d=arguments.length;if(this._all&&this._all.length)for(s=0,n=(h=this._all.slice()).length;s<n;s++)switch(this.event=o,d){case 1:h[s].call(this,o);break;case 2:h[s].call(this,o,arguments[1]);break;case 3:h[s].call(this,o,arguments[1],arguments[2]);break;default:h[s].apply(this,arguments)}if(c)h=[],E.call(this,h,e,this.listenerTree,0,n);else{if("function"==typeof(h=this._events[o])){switch(this.event=o,d){case 1:h.call(this);break;case 2:h.call(this,arguments[1]);break;case 3:h.call(this,arguments[1],arguments[2]);break;default:for(t=new Array(d-1),i=1;i<d;i++)t[i-1]=arguments[i];h.apply(this,t)}return!0}h&&(h=h.slice())}if(h&&h.length){if(d>3)for(t=new Array(d-1),i=1;i<d;i++)t[i-1]=arguments[i];for(s=0,n=h.length;s<n;s++)switch(this.event=o,d){case 1:h[s].call(this);break;case 2:h[s].call(this,arguments[1]);break;case 3:h[s].call(this,arguments[1],arguments[2]);break;default:h[s].apply(this,t)}return!0}if(!this.ignoreErrors&&!this._all&&"error"===o)throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},T.prototype.emitAsync=function(){if(!this._events&&!this._all)return!1;this._events||l.call(this);var e,t,n,s,i,a,o=arguments[0],c=this.wildcard;if("newListener"===o&&!this._newListener&&!this._events.newListener)return Promise.resolve([!1]);if(c&&(e=o,"newListener"!==o&&"removeListener"!==o&&"object"==typeof o)){if(s=o.length,r)for(i=0;i<s;i++)if("symbol"==typeof o[i]){t=!0;break}t||(o=o.join(this.delimiter))}var h,d=[],u=arguments.length;if(this._all)for(i=0,s=this._all.length;i<s;i++)switch(this.event=o,u){case 1:d.push(this._all[i].call(this,o));break;case 2:d.push(this._all[i].call(this,o,arguments[1]));break;case 3:d.push(this._all[i].call(this,o,arguments[1],arguments[2]));break;default:d.push(this._all[i].apply(this,arguments))}if(c?(h=[],E.call(this,h,e,this.listenerTree,0)):h=this._events[o],"function"==typeof h)switch(this.event=o,u){case 1:d.push(h.call(this));break;case 2:d.push(h.call(this,arguments[1]));break;case 3:d.push(h.call(this,arguments[1],arguments[2]));break;default:for(n=new Array(u-1),a=1;a<u;a++)n[a-1]=arguments[a];d.push(h.apply(this,n))}else if(h&&h.length){if(h=h.slice(),u>3)for(n=new Array(u-1),a=1;a<u;a++)n[a-1]=arguments[a];for(i=0,s=h.length;i<s;i++)switch(this.event=o,u){case 1:d.push(h[i].call(this));break;case 2:d.push(h[i].call(this,arguments[1]));break;case 3:d.push(h[i].call(this,arguments[1],arguments[2]));break;default:d.push(h[i].apply(this,n))}}else if(!this.ignoreErrors&&!this._all&&"error"===o)return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(d)},T.prototype.on=function(e,t,n){return this._on(e,t,!1,n)},T.prototype.prependListener=function(e,t,n){return this._on(e,t,!0,n)},T.prototype.onAny=function(e){return this._onAny(e,!1)},T.prototype.prependAny=function(e){return this._onAny(e,!0)},T.prototype.addListener=T.prototype.on,T.prototype._onAny=function(e,t){if("function"!=typeof e)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),t?this._all.unshift(e):this._all.push(e),this},T.prototype._on=function(e,n,s,i){if("function"==typeof e)return this._onAny(e,n),this;if("function"!=typeof n)throw new Error("on only accepts instances of Function");this._events||l.call(this);var r,a=this;return i!==t&&(n=(r=N.call(this,e,n,i))[0],a=r[1]),this._newListener&&this.emit("newListener",e,n),this.wildcard?(_.call(this,e,n,s),a):(this._events[e]?("function"==typeof this._events[e]&&(this._events[e]=[this._events[e]]),s?this._events[e].unshift(n):this._events[e].push(n),!this._events[e].warned&&this._maxListeners>0&&this._events[e].length>this._maxListeners&&(this._events[e].warned=!0,d.call(this,this._events[e].length,e))):this._events[e]=n,a)},T.prototype.off=function(e,t){if("function"!=typeof t)throw new Error("removeListener only takes instances of Function");var n,i=[];if(this.wildcard){var r="string"==typeof e?e.split(this.delimiter):e.slice();if(!(i=E.call(this,null,r,this.listenerTree,0)))return this}else{if(!this._events[e])return this;n=this._events[e],i.push({_listeners:n})}for(var a=0;a<i.length;a++){var o=i[a];if(n=o._listeners,s(n)){for(var c=-1,l=0,h=n.length;l<h;l++)if(n[l]===t||n[l].listener&&n[l].listener===t||n[l]._origin&&n[l]._origin===t){c=l;break}if(c<0)continue;return this.wildcard?o._listeners.splice(c,1):this._events[e].splice(c,1),0===n.length&&(this.wildcard?delete o._listeners:delete this._events[e]),this._removeListener&&this.emit("removeListener",e,t),this}(n===t||n.listener&&n.listener===t||n._origin&&n._origin===t)&&(this.wildcard?delete o._listeners:delete this._events[e],this._removeListener&&this.emit("removeListener",e,t))}return this.listenerTree&&S(this.listenerTree),this},T.prototype.offAny=function(e){var t,n=0,s=0;if(e&&this._all&&this._all.length>0){for(n=0,s=(t=this._all).length;n<s;n++)if(e===t[n])return t.splice(n,1),this._removeListener&&this.emit("removeListenerAny",e),this}else{if(t=this._all,this._removeListener)for(n=0,s=t.length;n<s;n++)this.emit("removeListenerAny",t[n]);this._all=[]}return this},T.prototype.removeListener=T.prototype.off,T.prototype.removeAllListeners=function(e){if(e===t)return!this._events||l.call(this),this;if(this.wildcard){var n,s=E.call(this,null,e,this.listenerTree,0);if(!s)return this;for(n=0;n<s.length;n++)s[n]._listeners=null;this.listenerTree&&S(this.listenerTree)}else this._events&&(this._events[e]=null);return this},T.prototype.listeners=function(e){var n,s,i,r,a,o=this._events;if(e===t){if(this.wildcard)throw Error("event name required for wildcard emitter");if(!o)return[];for(r=(n=c(o)).length,i=[];r-- >0;)"function"==typeof(s=o[n[r]])?i.push(s):i.push.apply(i,s);return i}if(this.wildcard){if(!(a=this.listenerTree))return[];var l=[],h="string"==typeof e?e.split(this.delimiter):e.slice();return E.call(this,l,h,a,0),l}return o&&(s=o[e])?"function"==typeof s?[s]:s:[]},T.prototype.eventNames=function(e){var t=this._events;return this.wildcard?k.call(this,this.listenerTree,[],null,e):t?c(t):[]},T.prototype.listenerCount=function(e){return this.listeners(e).length},T.prototype.hasListeners=function(e){if(this.wildcard){var n=[],s="string"==typeof e?e.split(this.delimiter):e.slice();return E.call(this,n,s,this.listenerTree,0),n.length>0}var i=this._events,r=this._all;return!!(r&&r.length||i&&(e===t?c(i).length:i[e]))},T.prototype.listenersAny=function(){return this._all?this._all:[]},T.prototype.waitFor=function(e,n){var s=this,i=typeof n;return"number"===i?n={timeout:n}:"function"===i&&(n={filter:n}),b((n=f(n,{timeout:0,filter:t,handleError:!1,Promise:Promise,overload:!1},{filter:y,Promise:w})).Promise,(function(t,i,r){function a(){var r=n.filter;if(!r||r.apply(s,arguments))if(s.off(e,a),n.handleError){var o=arguments[0];o?i(o):t(u.apply(null,arguments).slice(1))}else t(u.apply(null,arguments))}r((function(){s.off(e,a)})),s._on(e,a,!1)}),{timeout:n.timeout,overload:n.overload})};var x=T.prototype;Object.defineProperties(T,{defaultMaxListeners:{get:function(){return x._maxListeners},set:function(e){if("number"!=typeof e||e<0||Number.isNaN(e))throw TypeError("n must be a non-negative number");x._maxListeners=e},enumerable:!0},once:{value:function(e,t,n){return b((n=f(n,{Promise:Promise,timeout:0,overload:!1},{Promise:w})).Promise,(function(n,s,i){var r;if("function"==typeof e.addEventListener)return r=function(){n(u.apply(null,arguments))},i((function(){e.removeEventListener(t,r)})),void e.addEventListener(t,r,{once:!0});var a,o=function(){a&&e.removeListener("error",a),n(u.apply(null,arguments))};"error"!==t&&(a=function(n){e.removeListener(t,o),s(n)},e.once("error",a)),i((function(){a&&e.removeListener("error",a),e.removeListener(t,o)})),e.once(t,o)}),{timeout:n.timeout,overload:n.overload})},writable:!0,configurable:!0}}),Object.defineProperties(x,{_maxListeners:{value:10,writable:!0,configurable:!0},_observers:{value:null,writable:!0,configurable:!0}}),e.exports=T}()}));class ys extends URLSearchParams{static new(e){return new URLSearchParams(e)}}let vs,bs,Cs;!function(e){e.OPEN="open",e.CLOSE="close",e.MESSAGE="message",e.CONNECT="connect",e.DISCONNECT="disconnect",e.ACCOUNTS_CHANGED="accountsChanged",e.CHAIN_CHANGED="chainChanged",e.NETWORKS="networks",e.WALLET_CONTEXT="walletContext",e.INIT="init",e.DEBUG="_debug"}(vs||(vs={})),function(e){e[e.CLOSED=0]="CLOSED",e[e.OPENING=1]="OPENING",e[e.OPENED=2]="OPENED"}(bs||(bs={})),function(e){e[e.NIL=0]="NIL",e[e.SENT_NONCE=1]="SENT_NONCE",e[e.OK=2]="OK"}(Cs||(Cs={}));class Es extends Error{constructor(e){super(e),this.name="ProviderError"}}const _s=new Es("Wallet is not signed in. Connect a wallet and try again."),ks=3e4;let Ss=0;const Is=()=>++Ss;class Ns{constructor(){var e=this;this.pendingMessageRequests=[],this.responseCallbacks=new Map,this.state=void 0,this.confirmationOnly=!1,this.events=new ms.EventEmitter2,this.openPayload=void 0,this.connectPayload=void 0,this.accountsChangedPayload=void 0,this.networksPayload=void 0,this.walletContextPayload=void 0,this._sessionId=void 0,this._init=void 0,this._registered=void 0,this.sendAsync=async function(t,n,s){e.state===bs.CLOSED&&(e.confirmationOnly=!0),e.openWallet(void 0,{type:"jsonRpcRequest",method:t.method},s);try{e.isOpened()||await e.waitUntilOpened();n(void 0,(await e.sendMessageRequest({idx:Is(),type:vs.MESSAGE,data:t,chainId:s})).data)}catch(e){n(e)}},this.sendMessageRequest=async function(t){return new Promise(((n,s)=>{(!t.idx||t.idx<=0)&&"init"!==t.type&&s(new Error("message idx not set"));const i=(e,t)=>{if(e)s(e);else{if(!t)throw new Error("no valid response to return");n(t)}},r=t.idx;e.responseCallbacks.get(r)?s(new Error("duplicate message idx, should never happen")):e.responseCallbacks.set(r,i),e.isOpened()?e.sendMessage(t):(Se.debug("pushing to pending requests",t),e.pendingMessageRequests.push(t))}))},this.waitUntilOpened=async function(t=3e4){let n=!1;return Promise.race([new Promise(((s,i)=>{const r=setTimeout((()=>{clearTimeout(r),n||(e.state=bs.CLOSED,e.events.emit("close",{code:1005,message:"opening wallet timed out"})),i(new Error("opening wallet timed out"))}),t)})),new Promise((t=>{var s;if(e.isOpened())return n=!0,void t(null==(s=e.openPayload)?void 0:s.session);e.events.once("open",(s=>{e.openPayload=s,n=!0,t(s.session)}))}))])},this.waitUntilConnected=async function(){await e.waitUntilOpened();const t=new Promise((t=>{e.connectPayload?t(e.connectPayload):e.events.once("connect",(n=>{e.connectPayload=n,t(n)}))})),n=new Promise(((t,n)=>{e.events.once("close",(e=>{n(e?new Error(`wallet closed due to ${JSON.stringify(e)}`):new Error("user closed the wallet"))}))}));return Promise.race([t,n])},this.state=bs.CLOSED,this._registered=!1,this._init=Cs.NIL}get registered(){return this._registered}register(){throw new Error("abstract method")}unregister(){throw new Error("abstract method")}openWallet(e,t,n){throw new Error("abstract method")}closeWallet(){throw new Error("abstract method")}isOpened(){return this.registered&&this.state===bs.OPENED}isConnected(){var e;const t=null==(e=this.openPayload)?void 0:e.session;return this.registered&&void 0!==t&&!!t.accountAddress&&42===t.accountAddress.length&&!!t.networks&&t.networks.length>0}handleMessage(e){var n=this;if(e.type===vs.INIT){Se.debug("MessageProvider, received INIT message",e);const{nonce:t}=e.data;if(!t||0==t.length)return void Se.error("invalid init nonce");this._init=Cs.OK,this.sendMessage({idx:-1,type:vs.INIT,data:{sessionId:this._sessionId,nonce:t}})}if(this._init!==Cs.OK)return;Se.debug("RECEIVED MESSAGE FROM WALLET",e.idx,e);const s=e.idx,i=this.responseCallbacks.get(s);if(s&&this.responseCallbacks.delete(s),e.type!==vs.OPEN||this.isOpened()){if(e.type===vs.MESSAGE){if(this.confirmationOnly&&setTimeout((()=>{0===this.responseCallbacks.size&&this.closeWallet()}),500),!i)throw new Error("impossible state");if(i)return this.events.emit("message",e),void i(e.data.error,e)}if(e.type===vs.ACCOUNTS_CHANGED)return this.accountsChangedPayload={accounts:[]},void(e.data&&e.data.length>0?(this.accountsChangedPayload={accounts:[t.ethers.utils.getAddress(e.data[0])],origin:e.origin},this.events.emit("accountsChanged",this.accountsChangedPayload.accounts,this.accountsChangedPayload.origin)):this.events.emit("accountsChanged",[],e.origin));if(e.type!==vs.CHAIN_CHANGED){if(e.type===vs.NETWORKS)return this.networksPayload=e.data,void this.events.emit("networks",this.networksPayload);if(e.type===vs.WALLET_CONTEXT)return this.walletContextPayload=e.data,void this.events.emit("walletContext",this.walletContextPayload);e.type===vs.CLOSE&&this.state!==bs.CLOSED&&this.close(e.data),e.type===vs.CONNECT&&(this.connectPayload=e.data,this.events.emit("connect",this.connectPayload)),e.type===vs.DISCONNECT&&this.isConnected()&&(this.events.emit("disconnect",e.data),this.close())}else this.events.emit("chainChanged",e.data)}else{var r,a;if(this._sessionId&&this._sessionId!==(null==(r=e.data)?void 0:r.sessionId))return void Se.debug("open event received from wallet, but does not match sessionId",this._sessionId);if(null!=(a=e.data)&&a.error){var o;const t=new Error(`opening wallet failed: received ${null==(o=e.data)?void 0:o.error}`);throw Se.error(t),this.close(),t}if(this.state=bs.OPENED,this.openPayload=e.data,this.events.emit("open",this.openPayload),0!==this.pendingMessageRequests.length){this.pendingMessageRequests.splice(0,this.pendingMessageRequests.length).forEach((async function(e){n.sendMessage(e)}))}}}sendMessage(e){throw new Error("abstract method")}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}emit(e,...t){return this.events.emit(e,...t)}close(e){this.state!==bs.CLOSED&&(this.state=bs.CLOSED,this.confirmationOnly=!1,this._sessionId=void 0,Se.info("closing wallet and flushing!"),this.pendingMessageRequests.length=0,this.responseCallbacks.forEach((e=>{e(i({},new Error("wallet closed"),{code:4001}))})),this.responseCallbacks.clear(),this.connectPayload=void 0,this.openPayload=void 0,this.accountsChangedPayload=void 0,this.networksPayload=void 0,this.walletContextPayload=void 0,this.events.emit("close",e))}}class Ts{constructor(e,n,s,r,a=[]){var o=this;this.signer=void 0,this.signerReadyCallbacks=[],this.prompter=void 0,this.auxDataProvider=void 0,this.mainnetNetworks=void 0,this.testnetNetworks=void 0,this._openIntent=void 0,this._connectOptions=void 0,this._defaultNetworkId=void 0,this._chainId=void 0,this.events=new ms.EventEmitter2,this.promptConnect=async function(e){if(!e&&!o._connectOptions)throw new Error("prompter connect options are empty");if(!o.prompter)return o.connect(e);const t=await o.prompter.promptConnect(e||o._connectOptions).catch((e=>({connected:!1}))),n=t;return n.connected&&!n.session&&(n.session=await o.walletSession()),t},this.sendAsync=async function(e,n,s){const r={jsonrpc:"2.0",id:e.id,result:null};await o.getSigner();try{if(!(o.signer&&null!==o.signer||xs.includes(e.method)))throw _s;const n=o.signer;if(!n)throw new Error("WalletRequestHandler: wallet signer is not configured");const i=await n.getProvider(s);if(!i)throw new Error(`WalletRequestHandler: wallet provider is not configured for chainId ${s}`);switch(e.method){case"net_version":{const e=await i.send("net_version",[]);r.result=e;break}case"eth_chainId":{const e=await i.send("eth_chainId",[]);r.result=e;break}case"eth_accounts":{const e=await n.getAddress();r.result=[e];break}case"eth_getBalance":{const[t,n]=e.params,s=await i.getBalance(t,n);r.result=s.toHexString();break}case"personal_sign":case"eth_sign":{let t;if("personal_sign"===e.method){const[n,s]=e.params;t=n}else{const[n,s]=e.params;t=s}let i="";const a=Fs(t);if(null===o.prompter)i=await n.signMessage(a,s);else{await o.handleConfirmWalletDeployPrompt(o.prompter,n,s)&&(i=await o.prompter.promptSignMessage({chainId:s,message:a},o.connectOptions))}if(!(i&&i.length>0))throw new Error("declined by user");r.result=i;break}case"eth_signTypedData":case"eth_signTypedData_v4":{const[t,i]=e.params;let a;if("string"==typeof i)try{a=JSON.parse(i)}catch(e){}else a=i;if(!(a&&a.domain&&a.types&&a.message))throw new Error("invalid typedData object");let c="";if(null===o.prompter)c=await n.signTypedData(a.domain,a.types,a.message,s);else{await o.handleConfirmWalletDeployPrompt(o.prompter,n,s)&&(c=await o.prompter.promptSignMessage({chainId:s,typedData:a},o.connectOptions))}if(!(c&&c.length>0))throw new Error("declined by user");r.result=c;break}case"eth_sendTransaction":{const[t]=e.params;"gas"in t&&void 0===t.gasLimit&&(t.gasLimit=t.gas,delete t.gas);let i="";if(null===o.prompter){i=(await n.sendTransaction(t,s)).hash}else i=await o.prompter.promptSendTransaction(t,s,o.connectOptions);if(!i)throw new Error("declined by user");r.result=i;break}case"eth_signTransaction":{const[i]=e.params;if(t.ethers.utils.getAddress(i.from)!==await n.getAddress())throw new Error("sender address does not match wallet");null===o.prompter?r.result=await n.signTransactions(i,s):r.result=await o.prompter.promptSignTransaction(i,s,o.connectOptions);break}case"eth_sendRawTransaction":if(In(e.params[0])){const s=t.BigNumber.from(e.params[0].chainId).toNumber(),i=await(await n.getRelayer(s)).relay(e.params[0]);r.result=(await i).hash}else{const t=await i.sendTransaction(e.params[0]);r.result=t.hash}break;case"eth_getTransactionCount":{const s=t.ethers.utils.getAddress(e.params[0]),a=e.params[1];if(s===t.ethers.utils.getAddress(await n.getAddress())){const e=await n.getTransactionCount(a);r.result=t.ethers.BigNumber.from(e).toHexString()}else{const e=await i.getTransactionCount(s,a);r.result=t.ethers.BigNumber.from(e).toHexString()}break}case"eth_blockNumber":r.result=await i.getBlockNumber();break;case"eth_getBlockByNumber":case"eth_getBlockByHash":r.result=await i.getBlock(e.params[0]);break;case"eth_getTransactionByHash":r.result=await i.getTransaction(e.params[0]);break;case"eth_call":{const[t,n]=e.params;r.result=await i.call(t,n);break}case"eth_getCode":{const[t,n]=e.params;r.result=await i.getCode(t,n);break}case"eth_estimateGas":{const[t]=e.params;r.result=await i.estimateGas(t);break}case"eth_gasPrice":{const e=await i.getGasPrice();r.result=e.toHexString();break}case"wallet_switchEthereumChain":{const[n]=e.params;if(!n.chainId||0===n.chainId.length)throw new Error("invalid chainId");const s=t.ethers.BigNumber.from(n.chainId);if(!await o.setDefaultNetwork(s.toString(),!0))throw new Error(`unable to set chainId ${s}`);r.result=null;break}case"sequence_getWalletContext":r.result=await n.getWalletContext();break;case"sequence_getWalletConfig":{const[t]=e.params;r.result=await n.getWalletConfig(t);break}case"sequence_getWalletState":{const[t]=e.params;r.result=await n.getWalletState(t);break}case"sequence_getNetworks":r.result=await o.getNetworks(!0);break;case"sequence_updateConfig":throw new Error("sequence_updateConfig method is not allowed from a dapp");case"sequence_publishConfig":throw new Error("sequence_publishConfig method is not allowed from a dapp");case"sequence_gasRefundOptions":case"sequence_getNonce":case"sequence_relay":break;case"sequence_setDefaultNetwork":{const[t]=e.params;if(!t)throw new Error("invalid request, method argument defaultNetworkId cannot be empty");if(!await o.setDefaultNetwork(t))throw new Error(`unable to set default network ${t}`);r.result=await o.getNetworks(!0);break}default:{const t=await i.send(e.method,e.params);r.result=t}}}catch(e){Se.error(e),r.result=null,r.error=i({},new Error(e),{code:4001})}n(void 0,r)},this.isSignedIn=async function(){return await o.signerReady(),!!o.signer},this.getSigner=async function(){if(await o.signerReady(),void 0===o.signer)throw new Error("signerReady failed resolve");return o.signer},this.signer=e,this.prompter=n,this.auxDataProvider=s,this.mainnetNetworks=r,this.testnetNetworks=a}async signIn(e,t={}){this.setSigner(e);const{connect:n,mainnetNetworks:s,testnetNetworks:i,defaultNetworkId:r}=t;if(s&&s.length>0&&(this.mainnetNetworks=s),i&&i.length>0&&(this.testnetNetworks=i),!(this.mainnetNetworks&&0!==this.mainnetNetworks.length||this.testnetNetworks&&0!==this.testnetNetworks.length))throw new Error("signIn failed as network configuration is empty");const a=r||this._defaultNetworkId;if(a&&!await this.setDefaultNetwork(a,!1))throw new Error(`WalletRequestHandler setup unable to set defaultNetworkId ${a}`);if(n){const e=this._connectOptions,t=await this.connect(e);this.notifyConnect(t),e&&!0===e.keepWalletOpened||this.notifyClose()}}signOut(){this.setSigner(null)}signerReset(){this.signer=void 0}signerReady(e=1e4){return new Promise(((t,n)=>{void 0!==this.signer?t():(setTimeout((()=>{void 0===this.signer&&(this.signerReadyCallbacks=[],n("signerReady timed out"))}),e),this.signerReadyCallbacks.push(t))}))}async connect(e){if(!this.signer)return{connected:!1,chainId:"0x0",error:"unable to connect without signed in account"};const n={connected:!0,chainId:t.ethers.utils.hexlify(await this.getChainId())};if(e&&e.askForEmail){var s;const e=await(null==(s=this.auxDataProvider)?void 0:s.get("email"));e&&(n.email=e)}if(e&&e.authorize){const t={app:e.app,origin:e.origin,expiry:e.expiry};try{n.proof=await os(this.signer,t)}catch(t){return Se.warn(`connect, signAuthorization failed for options: ${JSON.stringify(e)}, due to: ${t.message}`),{connected:!1,chainId:"0x0",error:`signAuthorization failed: ${t.message}`}}}return n.session=await this.walletSession(),n}sendMessageRequest(e){return new Promise((t=>{this.sendAsync(e.data,((n,s)=>{const r=i({},e,{data:s});t(r)}),e.chainId)}))}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}async getAddress(){return this.signer?this.signer.getAddress():""}async getChainId(){return this.signer?(this._chainId||(this._chainId=await this.signer.getChainId()),this._chainId):0}get openIntent(){return this._openIntent}setOpenIntent(e){this._openIntent=e}get connectOptions(){return this._connectOptions}setConnectOptions(e){this._connectOptions=e}get defaultNetworkId(){return this._defaultNetworkId}async setDefaultNetwork(e,t=!0){if(e&&(this._defaultNetworkId=e,this._chainId=void 0,this.signer&&this.signer.setNetworks)){const n=this.signer.setNetworks(this.mainnetNetworks,this.testnetNetworks,e);return n&&t&&await this.notifyNetworks(),n}}async getNetworks(e){if(!this.signer)return Se.warn("signer not set: getNetworks is returning an empty list"),[];const t=await this.signer.getNetworks();return e?t.map((e=>{const t=i({},e);return t.provider=void 0,t.relayer=void 0,t})):t}async walletSession(){return this.signer?{walletContext:await this.signer.getWalletContext(),accountAddress:await this.signer.getAddress(),networks:await this.getNetworks(!0)}:void 0}notifyConnect(e,t){var n,s;(this.events.emit("connect",e),null!=(n=e.session)&&n.accountAddress)&&this.events.emit("accountsChanged",[null==(s=e.session)?void 0:s.accountAddress],t)}notifyDisconnect(e){this.events.emit("accountsChanged",[],e),this.events.emit("disconnect")}async notifyNetworks(e){const n=e||await this.getNetworks(!0);if(this.events.emit("networks",n),n.length>0){const e=n.find((e=>e.isDefaultChain));e&&this.events.emit("chainChanged",t.ethers.utils.hexlify(e.chainId))}else this.events.emit("chainChanged","0x0")}async notifyWalletContext(){if(!this.signer)return void Se.warn("signer not set: skipping to notify wallet context");const e=await this.signer.getWalletContext();this.events.emit("walletContext",e)}notifyClose(e){this.events.emit("close",e)}setSigner(e){if(this.signer=e,void 0!==e){for(let e=0;e<this.signerReadyCallbacks.length;e++)this.signerReadyCallbacks[e]();this.signerReadyCallbacks=[]}}async handleConfirmWalletDeployPrompt(e,t,n){if(!n)return!0;if(await Ks(t,n))return!0;if(await e.promptConfirmWalletDeploy(n,this.connectOptions)){return!!await Ks(t,n)||(Se.error("WalletRequestHandler: result for promptConfirmWalletDeploy is not correct"),!1)}return!1}}const xs=["net_version","eth_chainId","eth_getBalance","eth_getTransactionCount","eth_blockNumber","eth_getBlockByNumber","eth_getBlockByHash","eth_getTransactionByHash","eth_getCode","eth_estimateGas","eth_gasPrice","sequence_getWalletContext","sequence_getNetworks","sequence_setDefaultNetwork"];class As extends t.providers.Web3Provider{static isSequenceProvider(e){return Os(e)}constructor(e,t){const n=new pt(e,$e(t));super(e=n,"any"),this._sender=void 0,this._isSequenceProvider=void 0,this._defaultChainId=void 0,this._sender=n,this._isSequenceProvider=!0,this._defaultChainId=$e(t)}sendAsync(e,t,n){this._sender.sendAsync(e,t,n)}send(e,t,n){return this._sender.send(e,t,n)}request(e){return this.send(e.method,e.params||[],e.chainId)}getSigner(){return new Ps(this,this._defaultChainId)}async getChainId(){const e=await this.send("eth_chainId",[]),n=t.ethers.BigNumber.from(e).toNumber();if(this._defaultChainId&&this._defaultChainId!==n)throw new Error(`provider chainId (${n}) does not match provider-bound chainId ${this._defaultChainId}`);return n}}function Os(e){const t=e;return t&&void 0!==t.send&&!0===t._isSequenceProvider}class Ps extends an{constructor(e,t){super(),this.provider=void 0,this.defaultChainId=void 0,this._address=void 0,this._index=void 0,this._context=void 0,this._networks=void 0,this._providers={},this.provider=e,this.defaultChainId=t}async getAddress(){if(this._address)return this._address;const e=await this.provider.send("eth_accounts",[]);return this._address=e[0],this._index=0,t.ethers.utils.getAddress(this._address)}signTransaction(e){throw new Error("signTransaction is unsupported, use signTransactions instead")}connect(e){throw new Error("unsupported: cannot alter JSON-RPC Signer connection")}async getProvider(e){if(e){const t=await this.getChainId();if(t!==e)throw new Error(`signer is attempting to access chain ${e}, but is already bound to chain ${t}`)}return this.provider}async getSender(e){return!e||e&&e===this.defaultChainId?this.provider:(this._providers[e]||(this._providers[e]=new As(new pt(this.provider,e),e)),this._providers[e])}getRelayer(e){throw new Error("TODO")}async getWalletContext(){return this._context||(this._context=await this.provider.send("sequence_getWalletContext",[])),this._context}async getWalletConfig(e){return await this.provider.send("sequence_getWalletConfig",[$e(e)],$e(e)||this.defaultChainId)}async getWalletState(e){return await this.provider.send("sequence_getWalletState",[$e(e)],$e(e)||this.defaultChainId)}async getNetworks(){return this._networks||(this._networks=await this.provider.send("sequence_getNetworks",[])),this._networks}async getSigners(){const e=(await this.getNetworks()).find((e=>e.isAuthChain));if(!e)throw new Error("authChainId could not be determined from network list");const t=await this.getWalletConfig(e);if(!t||0===t.length)throw new Error("walletConfig returned zero results for authChainId {authChainId}");return t[0].signers.map((e=>e.address))}async signMessage(e,n,s){const i=await this.getSender($e(n)||this.defaultChainId),r="string"==typeof e?t.ethers.utils.toUtf8Bytes(e):e,a=await this.getAddress();return await i.send("personal_sign",[t.ethers.utils.hexlify(r),a])}async signTypedData(e,n,s,i,r){return await this.provider.send("eth_signTypedData_v4",[await this.getAddress(),t.ethers.utils._TypedDataEncoder.getPayload(e,n,s)],$e(i)||this.defaultChainId)}async sendTransaction(e,n,s){const i=await this.getSender($e(n)||this.defaultChainId);return this.sendUncheckedTransaction(e,n).then((e=>t.ethers.utils.poll((()=>i.getTransaction(e).then((t=>{if(null!==t)return i._wrapTransaction(t,e)}))),{onceBlock:this.provider}).catch((t=>{throw t.transactionHash=e,t}))))}async sendTransactionBatch(e,t,n){const s=await On(e);if(!s||0===s.length)throw new Error("cannot send empty batch");if(s.find((e=>void 0!==e.wait&&null!==e.wait)))throw new Error("transaction request expected for sendTransactionBatch, transaction response found");const r=i({},s[0]);return s.length>1&&(r.auxiliary=s.splice(1)),this.sendTransaction(r,t,n)}signTransactions(e,t,n){return e=De(e),this.provider.send("eth_signTransaction",[e],$e(t)||this.defaultChainId)}sendSignedTransactions(e,t){throw new Error("TODO")}async updateConfig(e){const[t,n]=await this.provider.send("sequence_updateConfig",[e],this.defaultChainId);if(null===n)return[t,void 0];return[t,(await this.getSender(this.defaultChainId))._wrapTransaction(n,n.hash)]}async publishConfig(){const e=await this.getSender(this.defaultChainId),t=await e.send("sequence_publishConfig",[]);if(null!==t)return e._wrapTransaction(t,t.hash)}async isDeployed(e){const t=await this.getSender($e(e)),n=await t.getCode(await this.getAddress());return!!n&&"0x"!==n}async _legacySignMessage(e,n,s){const i=await this.getSender($e(n)||this.defaultChainId),r="string"==typeof e?t.ethers.utils.toUtf8Bytes(e):e,a=await this.getAddress();return await i.send("eth_sign",[a,t.ethers.utils.hexlify(r)])}async _signTypedData(e,t,n,s,i){return this.signTypedData(e,t,n,s,i)}async sendUncheckedTransaction(e,n){e=De(e);const s=this.getAddress(),i=await this.getSender($e(n)||this.defaultChainId);return Le({tx:Le(e),sender:await s}).then((({tx:n,sender:s})=>{if(null!=n.from){if(t.ethers.utils.getAddress(n.from)!==s)throw new Error(`from address mismatch for transaction ${e}`)}else n.from=s;const r=Ms(n);return i.send("eth_sendTransaction",[r]).then((e=>e),(e=>{throw e}))}))}connectUnchecked(){return new Ls(this.provider,this.defaultChainId)}async unlock(e){const t=await this.getAddress();return this.provider.send("personal_unlockAccount",[t,e,null])}}const Rs={chainId:!0,data:!0,gasLimit:!0,gasPrice:!0,nonce:!0,to:!0,value:!0,from:!0,auxiliary:!0,expiration:!0,afterNonce:!0,delegateCall:!0,revertOnError:!0},Ms=(e,n)=>{const s=De(Rs);if(n)for(const e in n)n[e]&&(s[e]=!0);t.ethers.utils.checkProperties(e,s);const i={};["gasLimit","gasPrice","nonce","value"].forEach((n=>{const s=e[n];if(null==s)return;const r=t.ethers.utils.hexValue(s);"gasLimit"===n&&(n="gas"),i[n]=r})),["from","to","data"].forEach((n=>{e[n]&&(i[n]=t.ethers.utils.hexlify(e[n]))})),["delegateCall","revertOnError"].forEach((t=>{const n=e[t];null!=n&&(i[t]=n)}));const r=e.auxiliary;return r&&r.length>0&&(i.auxiliary=[],r.forEach((e=>{i.auxiliary.push(Ms(e))}))),i};class Ls extends Ps{sendTransaction(e){return this.sendUncheckedTransaction(e).then((e=>({chainId:0,confirmations:0,data:"",from:"",gasLimit:t.ethers.constants.Zero,gasPrice:t.ethers.constants.Zero,hash:e,nonce:0,value:t.ethers.constants.Zero,wait:t=>this.provider.waitForTransaction(e,t)})))}}const Us=[{name:"Decentraland Exception",predicate:function(e){try{const n=t.ethers.utils.toUtf8String(e);return Ds.test(n)}catch(e){return!1}}},{name:"0x v3 Exception",predicate:function(e){const n=new t.ethers.utils.Interface(qs);try{return n.decodeFunctionData("OrderWithHash",e),!0}catch(e){return!1}}}],Ds=/^Decentraland Login\nEphemeral address: 0x[a-fA-F0-9]{40}\nExpiration: (\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)((-(\d{2}):(\d{2})|Z)?)$/;const qs=[{inputs:[{components:[{internalType:"address",name:"makerAddress",type:"address"},{internalType:"address",name:"takerAddress",type:"address"},{internalType:"address",name:"feeRecipientAddress",type:"address"},{internalType:"address",name:"senderAddress",type:"address"},{internalType:"uint256",name:"makerAssetAmount",type:"uint256"},{internalType:"uint256",name:"takerAssetAmount",type:"uint256"},{internalType:"uint256",name:"makerFee",type:"uint256"},{internalType:"uint256",name:"takerFee",type:"uint256"},{internalType:"uint256",name:"expirationTimeSeconds",type:"uint256"},{internalType:"uint256",name:"salt",type:"uint256"},{internalType:"bytes",name:"makerAssetData",type:"bytes"},{internalType:"bytes",name:"takerAssetData",type:"bytes"},{internalType:"bytes",name:"makerFeeAssetData",type:"bytes"},{internalType:"bytes",name:"takerFeeAssetData",type:"bytes"}],internalType:"struct IEIP1271Data.Order",name:"order",type:"tuple"},{internalType:"bytes32",name:"orderHash",type:"bytes32"}],name:"OrderWithHash",outputs:[],stateMutability:"pure",type:"function"}],Ws=t.ethers.utils.toUtf8Bytes("Ethereum Signed Message:\n"),Bs=e=>t.ethers.utils.isBytes(e)||t.ethers.utils.isHexString(e)?t.ethers.utils.arrayify(e):t.ethers.utils.toUtf8Bytes(e),Fs=e=>{const n=Bs(e);return function(e){return Us.some((t=>t.predicate(e)))}(n)?n:t.ethers.utils.concat([Ws,t.ethers.utils.toUtf8Bytes(String(n.length)),n])},Gs=async(e,t,n,s,i,r)=>{var a;i||(i=null==(a=await s.getNetwork())?void 0:a.chainId);return!r&&As.isSequenceProvider(s)&&(r=await s.getSigner().getWalletContext()),Xn(e,t,n,s,r,i)},js=async(e,t,n,s,i,r)=>{const a=Fs(t),o=ye(a);return Gs(e,o,n,s,i,r)},$s=(e,t,n,s,i,r)=>Gs(e,Pe(t),n,s,i,r),Hs=async(e,n,s,i,r)=>{const a=ve(e,i,n),o=await(async(e,n,s,i,r,a)=>{const o=t.ethers.utils.arrayify(t.ethers.utils.keccak256(e));return ns(o,n,s,i,r,a)})(a,s);if(r){const e=le(o,r);if(o.address&&o.address!==e)throw new Error("recovered address does not match the WalletConfig address, check the WalletContext");o.address=e}return o},Vs=()=>"chrome-extension:"===window.location.protocol||"moz-extension:"===window.location.protocol,Js=()=>!!navigator.userAgent.match(/UnitySequence/i),Ks=async(e,t)=>{var n;const s=await e.getWalletState(),i=await e.getNetworks(),r=s.find((e=>e.chainId===t));if(!r)throw new Error(`WalletRequestHandler: could not find wallet state for chainId ${t}`);const a=r.deployed;if(!i)throw new Error("isWalletUpToDate util: could not get networks from signer");const o=i.find((e=>e.isAuthChain));if(!o)throw new Error("isWalletUpToDate util: could not get auth chain network information");const c=o.chainId,l=null==(n=s.find((e=>e.chainId===c)))?void 0:n.config;if(!l)throw new Error("isWalletUpToDate util: could not get auth chain config");const h=r.config;if(!h)throw new Error(`isWalletUpToDate util: could not get config for chainId ${t}`);const d=ue(l,h);return a&&d};class zs{constructor(){}static getInstance(){return zs._instance||(zs._instance={getItem:e=>Promise.resolve(window.localStorage.getItem(e)),setItem:(e,t)=>Promise.resolve(window.localStorage.setItem(e,t)),removeItem:e=>Promise.resolve(window.localStorage.removeItem(e))}),this._instance}static use(e){zs._instance=e}}zs._instance=void 0;class Zs{constructor(e,t){this.def=t,this.key=void 0,this.key=e}async get(){const e=await zs.getInstance().getItem(this.key);if(null===e)return this.def;try{return JSON.parse(e)}catch(e){console.error(e)}}set(e){e?zs.getInstance().setItem(this.key,JSON.stringify(e)):zs.getInstance().removeItem(this.key)}del(){zs.getInstance().removeItem(this.key)}}const Ys="@sequence.transportSession";class Qs{constructor(e){var n=this;this.walletRequestHandler=void 0,this._sessionId=void 0,this._registered=void 0,this._init=void 0,this._initNonce=void 0,this._initCallback=void 0,this.appOrigin=void 0,this.sendAsync=async function(e,t,n){throw new Error("abstract method")},this.handleMessage=async function(e){const t=e;if(n._init===Cs.OK)switch(t.type){case vs.OPEN:{if(n._init!==Cs.OK)return;const e={sessionId:t.data.sessionId,intent:t.data.intent,networkId:t.data.networkId};return void await n.open(e)}case vs.CLOSE:return n._init,void Cs.OK;case vs.MESSAGE:{const e=await n.walletRequestHandler.sendMessageRequest(t);return n.sendMessage(e),void e.data.error}default:Se.error(`unexpected payload type ${t.type}`)}else if(t.type===vs.INIT){if(!n.isValidInitAck(e))return void(n._initCallback&&n._initCallback("invalid init"));n._initCallback&&n._initCallback()}},this.sendMessageRequest=async function(e){return n.walletRequestHandler.sendMessageRequest(e)},this.open=async function({sessionId:e,intent:t,networkId:s}){if(e&&(n._sessionId=Te(e),n.saveTransportSession({sessionId:e,intent:t,networkId:s})),n.walletRequestHandler.setOpenIntent(t),await n.init(),t&&"connect"===t.type&&t.options){const e=t.options,i=e;if(n.appOrigin&&null!=i&&i.origin){if(!Vs()&&i.origin!==n.appOrigin)throw new Error("origin is invalid")}else!n.appOrigin&&null!=i&&i.origin?e.origin=Ae(i.origin):n.appOrigin&&(e.origin=n.appOrigin);e.app&&(e.app=xe(e.app)),n.walletRequestHandler.setConnectOptions(e),e.networkId?s=e.networkId:s&&(e.networkId=s)}else n.walletRequestHandler.setConnectOptions(void 0);if(await n.walletRequestHandler.getSigner(),!await n.walletRequestHandler.isSignedIn())return n.notifyOpen({sessionId:n._sessionId}),!0;if(t&&"connect"===t.type){let e;try{e=s?await n.walletRequestHandler.setDefaultNetwork(s,!1):await n.walletRequestHandler.getChainId()}catch(e){console.error(e)}(!e||e<=0)&&console.log("Failed to set default network on open"),n.notifyOpen({sessionId:n._sessionId});try{const e=await n.walletRequestHandler.promptConnect(t.options);e.connected&&n.walletRequestHandler.notifyConnect(e)}catch(e){Se.warn("promptConnect not connected:",e)}finally{t.options&&!0===t.options.keepWalletOpened||n.notifyClose()}}else{let e;try{e=s?await n.walletRequestHandler.setDefaultNetwork(s,!1):await n.walletRequestHandler.getChainId()}catch(e){console.error(e)}if(!e||e<=0)return n.notifyOpen({sessionId:n._sessionId,error:`failed to open wallet on network ${s}`}),!1;n.notifyOpen({sessionId:n._sessionId,chainId:`${e}`,session:await n.walletRequestHandler.walletSession()})}return!0},this.saveTransportSession=e=>{zs.getInstance().setItem(Ys,JSON.stringify(e))},this.getCachedTransportSession=async function(){const e=await zs.getInstance().getItem(Ys);try{return e?JSON.parse(e):null}catch(t){return console.error(`unable to parse transport session: ${e}`),null}},this.walletRequestHandler=e,this._init=Cs.NIL,this.walletRequestHandler.on("connect",(e=>{this.registered&&this.notifyConnect(e)})),this.walletRequestHandler.on("disconnect",(e=>{this.registered&&this.notifyDisconnect(e)})),this.walletRequestHandler.on("accountsChanged",((e,t)=>{this.registered&&this.notifyAccountsChanged(e,t)})),this.walletRequestHandler.on("networks",(e=>{this.registered&&(this.notifyNetworks(e),e&&0!==e.length?this.notifyChainChanged(t.ethers.utils.hexlify(e.find((e=>e.isDefaultChain)).chainId)):this.notifyChainChanged("0x0"))})),this.walletRequestHandler.on("walletContext",(e=>{this.registered&&e&&this.notifyWalletContext(e)})),this.walletRequestHandler.on("close",(e=>{this.registered&&this.notifyClose(e)}))}get registered(){return this._registered}register(){throw new Error("abstract method")}unregister(){throw new Error("abstract method")}sendMessage(e){throw new Error("abstract method")}notifyOpen(e){const{chainId:t,sessionId:n,session:s,error:i}=e;this.sendMessage({idx:-1,type:vs.OPEN,data:{chainId:t,sessionId:n,session:s,error:i}})}notifyClose(e){this.sendMessage({idx:-1,type:vs.CLOSE,data:e?{error:e}:null})}notifyConnect(e){this.sendMessage({idx:-1,type:vs.CONNECT,data:e})}notifyDisconnect(e){this.sendMessage({idx:-1,type:vs.DISCONNECT,data:e?{error:e}:null})}notifyAccountsChanged(e,t){this.sendMessage({idx:-1,type:vs.ACCOUNTS_CHANGED,data:e,origin:t})}notifyChainChanged(e){this.sendMessage({idx:-1,type:vs.CHAIN_CHANGED,data:e})}notifyNetworks(e){this.sendMessage({idx:-1,type:vs.NETWORKS,data:e})}notifyWalletContext(e){this.sendMessage({idx:-1,type:vs.WALLET_CONTEXT,data:e})}isValidInitAck(e){if(this._init===Cs.OK)return Se.warn("isValidInitAck, already in init'd state, so inquiry is invalid."),!1;if(e.type!==vs.INIT)return Se.warn("isValidInitAck, invalid message type, expecting init"),!1;const{sessionId:t,nonce:n}=e.data;return t&&0!==t.length&&n&&0!==n.length?t===this._sessionId&&n===this._initNonce||(Se.error("invalid init ack match"),!1):(Se.error("invalid init ack"),!1)}init(){return new Promise(((e,t)=>{if(this._init===Cs.OK)return void e();if(this._init!==Cs.NIL||this._initCallback)return void t("transport init is in progress");const n=setTimeout((()=>{Se.warn("transport init timed out"),this._initCallback&&this._initCallback("transport init timed out")}),15e3);this._initCallback=s=>{this._initCallback=void 0,clearTimeout(n),s?t(s):(this._init=Cs.OK,e())},this._initNonce=`${performance.now()}`,this.sendMessage({idx:-1,type:vs.INIT,data:{nonce:this._initNonce}}),this._init=Cs.SENT_NONCE}))}}class Xs{constructor(){this.conn=void 0,this.events=new ms.EventEmitter2,this.handleMessage=e=>{throw new Error("ProxyMessageChannelPort is not registered")},this.sendMessage=e=>{this.conn.handleMessage(e),"open"===e.type&&this.events.emit("open",e),"close"===e.type&&this.events.emit("close",e),"connect"===e.type&&this.events.emit("connect",e),"disconnect"===e.type&&this.events.emit("disconnect",e)}}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}}class ei extends Ns{constructor(e){if(super(),this.port=void 0,this.register=()=>{this.port.handleMessage=e=>{this.handleMessage(e)},this.on("open",((...e)=>{this.port.events.emit("open",...e)})),this.on("close",((...e)=>{this.port.events.emit("close",...e)})),this.on("connect",((...e)=>{this.port.events.emit("connect",...e)})),this.on("disconnect",((...e)=>{this.port.events.emit("disconnect",...e)})),this._registered=!0},this.unregister=()=>{this._registered=!1,this.closeWallet(),this.events.removeAllListeners(),this.port.handleMessage=void 0},this.openWallet=(e,t,n)=>{if(this.state===bs.CLOSED){this.state=bs.OPENING;const s=`${performance.now()}`;this._sessionId=s,this.sendMessage({idx:-1,type:vs.OPEN,data:{path:e,intent:t,networkId:n,sessionId:s}})}},this.state=bs.CLOSED,this.port=e,!e)throw new Error("port argument cannot be empty");this._init=Cs.OK}closeWallet(){this.sendMessage({idx:-1,type:vs.CLOSE,data:null}),this.close()}sendMessage(e){if(!e.idx)throw new Error("message idx is empty");this.port.sendMessage(e)}}class ti{constructor(...e){var t=this;this.messageProviders=void 0,this.provider=void 0,this.register=()=>{if(1===this.messageProviders.length)return this.provider=this.messageProviders[0],void this.provider.register();this.messageProviders.forEach((e=>{e.register(),e.once("open",(()=>{this.provider||(this.provider=e,this.messageProviders.forEach((e=>{this.provider!==e&&e.unregister()})))}))}))},this.unregister=()=>{this.messageProviders.forEach((e=>e.unregister())),this.provider=void 0},this.openWallet=(e,t,n)=>{this.provider?this.provider.openWallet(e,t,n):this.messageProviders.forEach((s=>s.openWallet(e,t,n)))},this.sendAsync=async function(e,n,s){if(!t.provider)throw new Error("impossible state, wallet must be opened first");t.provider.sendAsync(e,n,s)},this.sendMessageRequest=async function(e){if(t.provider)return t.provider.sendMessageRequest(e);throw new Error("impossible state, wallet must be opened first")},this.waitUntilOpened=async function(){return t.provider?t.provider.waitUntilOpened():Promise.race(t.messageProviders.map((e=>e.waitUntilOpened())))},this.waitUntilConnected=async function(){if(t.provider)return t.provider.waitUntilConnected();throw new Error("impossible state, wallet must be opened first")},this.messageProviders=e,this.provider=void 0}add(...e){this.messageProviders.push(...e)}closeWallet(){this.provider&&this.provider.closeWallet()}isOpened(){return!!this.provider&&this.provider.isOpened()}isConnected(){return!!this.provider&&this.provider.isConnected()}on(e,t){this.provider?this.provider.on(e,t):this.messageProviders.forEach((n=>{n.on(e,t)}))}once(e,t){this.provider?this.provider.once(e,t):this.messageProviders.forEach((n=>{n.once(e,t)}))}emit(e,...t){if(this.provider)return this.provider.emit(e,...t);for(let n=0;n<this.messageProviders.length;n++)this.messageProviders[n].emit(e,...t);return!0}sendMessage(e){if(!e.idx||e.idx<=0)throw new Error("message idx is empty");if(!this.provider)throw new Error("impossible state, wallet must be opened first");this.provider.sendMessage(e)}handleMessage(e){if(!this.provider)throw new Error("impossible state, wallet must be opened first");this.provider.handleMessage(e)}}let ni;class si extends Ns{constructor(e){super(),this.walletURL=void 0,this.walletWindow=void 0,this.register=()=>{ni&&(ni.unregister(),ni=this),window.addEventListener("message",this.onWindowEvent),ni=this,this.on("open",(()=>{const e=this.walletWindow,t=setInterval((()=>{e&&e.closed&&(clearInterval(t),this.close())}),500)})),this.on("close",(()=>{this.walletWindow&&(this.walletWindow.close(),this.walletWindow=null)})),this._registered=!0},this.unregister=()=>{this._registered=!1,this.closeWallet(),ni===this&&(ni=void 0),window.removeEventListener("message",this.onWindowEvent),this.events.removeAllListeners()},this.openWallet=(e,t,n)=>{if(this.walletWindow&&this.isOpened())return void this.walletWindow.focus();const s=new URL(this.walletURL.href),i=new ys;let r,a;e&&""!==e&&(s.pathname=e.toLowerCase()),this._init=Cs.NIL,this._sessionId=`${performance.now()}`,i.set("sid",this._sessionId),t&&("connect"===t.type&&(t.options||(t.options={}),Vs()||Js()||(t.options.origin=window.location.origin)),i.set("intent",we(t))),n&&i.set("net",`${n}`),Vs()?(r=[450,750],a=[Math.abs(window.screen.width/2-r[0]/2),Math.abs(window.screen.height/2-r[1]/2)]):(r=[450,750],a=[Math.abs(window.screenX+window.innerWidth/2-r[0]/2),Math.abs(window.screenY+window.innerHeight/2-r[1]/2)]);const o=`toolbar=0,location=0,menubar=0,scrollbars=yes,status=yes,width=${r[0]},height=${r[1]},left=${a[0]},top=${a[1]}`;s.search=i.toString(),this.walletWindow=window.open(s.href,"sequence.app",o)},this.onWindowEvent=e=>{if(e.origin!==this.walletURL.origin)return;let t;try{t=JSON.parse(e.data)}catch(e){return}if(!t)throw new Error("ProviderMessage object is empty");this.handleMessage(t)},this.walletURL=new URL(e)}closeWallet(){var e;this.close(),null==(e=this.walletWindow)||e.close()}sendMessage(e){if(!this.walletWindow)return void Se.warn("WindowMessageProvider: sendMessage failed as walletWindow is unavailable");const t="string"!=typeof e?JSON.stringify(e):e;this.walletWindow.postMessage(t,this.walletURL.origin)}}const ii="sequence-extension-message-handler";class ri extends Ns{constructor(e){super(),this.register=()=>{this._registered=!0},e.onConnect.addListener((e=>{e.name===ii&&(this._init=Cs.OK,e.onMessage.addListener((e=>{this.handleMessage(e)})))}))}sendMessage(e){}unregister(){}openWallet(e,t,n){}closeWallet(){}}class ai extends ms.EventEmitter2{constructor(e){var t;super(),t=this,this.stream=e,this.responseCallbacks=new Map,this._messageIdx=0,this.nextMessageIdx=()=>++this._messageIdx,this.handleMessage=e=>{if(!e.type||!e.data)return;Se.info("[received message]",e);const t=e.idx,n=this.responseCallbacks.get(t);switch(t&&this.responseCallbacks.delete(t),e.type){case vs.MESSAGE:if(!n)throw new Error("impossible state");this.emit(vs.MESSAGE,e),n(e.data.error,e);break;case vs.DISCONNECT:case vs.ACCOUNTS_CHANGED:case vs.CHAIN_CHANGED:this.emit(e.type,e.data);break;default:console.error("unknown message type",e)}},this.sendMessageRequest=async function(e){return new Promise(((n,s)=>{(!e.idx||e.idx<=0)&&s(new Error("message idx not set"));const i=(e,t)=>{if(e)s(e);else{if(!t)throw new Error("no valid response to return");n(t)}},{idx:r}=e;t.responseCallbacks.get(r)?s(new Error("duplicate message idx, should never happen")):t.responseCallbacks.set(r,i),t.sendMessage(e)}))},this.stream.on("data",this.handleMessage)}sendMessage(e){this.stream.writable||console.error("window post message stream is not writable"),this.stream.write(e)}}function oi(e){var t;if(null!=(t=window.ue)&&t.sequencewallettransport&&!window.logsOverriddenForUnreal){var n;const t=null==(n=window.ue)?void 0:n.sequencewallettransport;console.log=(...n)=>{t.logfromjs(`${e}: ${ci(n)}`)},console.warn=(...n)=>{t.warnfromjs(`${e}: ${ci(n)}`)},console.error=(...n)=>{t.errorfromjs(`${e}: ${ci(n)}`)},window.logsOverriddenForUnreal=!0}}function ci(e){return e.map((e=>"object"==typeof e?e instanceof Error?e.message:JSON.stringify(e):String(e))).join(" ")}let li;class hi extends Ns{constructor(e){super(),this.walletURL=void 0,this.register=()=>{var e;oi("dapp"),li&&(li.unregister(),li=this),null!=(e=window.ue)&&e.sequencewallettransport&&(window.ue.sequencewallettransport.onmessagefromwallet=this.onUnrealCallback),li=this,this._registered=!0,console.log("registering transport!")},this.unregister=()=>{var e,t;this._registered=!1,this.closeWallet(),li===this&&(li=void 0),(null==(e=window.ue)||null==(t=e.sequencewallettransport)?void 0:t.onmessagefromwallet)===this.onUnrealCallback&&delete window.ue.sequencewallettransport.onmessagefromwallet,this.events.removeAllListeners()},this.openWallet=(e,t,n)=>{if(this.isOpened())return void console.log("wallet already open!");console.log("opening wallet!");const s=new URL(this.walletURL.href),i=new ys;e&&(s.pathname=e.toLowerCase()),this._init=Cs.NIL,this._sessionId=`${performance.now()}`,i.set("sid",this._sessionId),t&&i.set("intent",we(t)),n&&i.set("net",`${n}`),s.search=i.toString(),console.log("opening wallet to",s.href),window.open(s.href)},this.onUnrealCallback=e=>{if(!e)throw new Error("ProviderMessage object is empty");console.log(" got message from wallet",e),this.handleMessage(e)},this.walletURL=new URL(e)}closeWallet(){this.close()}sendMessage(e){var t,n;const s="string"!=typeof e?JSON.stringify(e):e;console.log("Sending message to wallet:",s),null==(t=window.ue)||null==(n=t.sequencewallettransport)||n.sendmessagetowallet(s)}}class di{constructor(e){var t=this;this.wallet=void 0,this.recoverWalletConfig=async function(e,n,s,i,r){return r=r||await t.wallet.getWalletContext(),Hs(e,n,s,i,r)},this.recoverWalletConfigFromMessage=async function(e,n,s,i,r){return r=r||await t.wallet.getWalletContext(),Hs(e,ye(Fs(n)),s,i,r)},this.recoverWalletConfigFromTypedData=async function(e,n,s,i,r){return r=r||await t.wallet.getWalletContext(),Hs(e,Pe(n),s,i,r)},this.wallet=e}signMessage(e,t,n){const s=this.wallet.getSigner();if(!s)throw new Error("unable to get signer");return s.signMessage(e,t,n)}async signAuthMessage(e,t){const n=await this.wallet.getAuthSigner();if(!n)throw new Error("unable to get AuthChain signer");return n.signMessage(e,await n.getChainId(),t)}signTypedData(e,t,n,s,i){const r=this.wallet.getSigner();if(!r)throw new Error("unable to get signer");return r.signTypedData(e,t,n,s,i)}async signAuthTypedData(e,t,n,s){const i=await this.wallet.getAuthSigner();if(!i)throw new Error("unable to get AuthChain signer");return i.signTypedData(e,t,n,await i.getChainId(),s)}async isValidSignature(e,t,n,s,i){const r=this.wallet.getProvider(s);if(!r)throw new Error(`unable to get provider for chainId ${s}`);return Gs(e,t,n,r,s,i)}async isValidMessageSignature(e,t,n,s,i){const r=this.wallet.getProvider(s);if(!r)throw new Error(`unable to get provider for chainId ${s}`);const a=Fs(t),o=ye(a);return Gs(e,o,n,r,s,i)}isValidTypedDataSignature(e,t,n,s,i){return this.isValidSignature(e,Pe(t),n,s,i)}}class ui{constructor(e,n){var s=this;this.utils=void 0,this.config=void 0,this.session=void 0,this.connectedSites=void 0,this.transport=void 0,this.networks=void 0,this.providers=void 0,this.init=()=>{var e,t,n,s,i,r,a,o;this.transport.provider||(this.transport.messageProvider=new ti,null!=(e=this.config.transports)&&null!=(t=e.windowTransport)&&t.enabled&&(this.transport.windowMessageProvider=new si(this.config.walletAppURL),this.transport.messageProvider.add(this.transport.windowMessageProvider)),null!=(n=this.config.transports)&&null!=(s=n.proxyTransport)&&s.enabled&&(this.transport.proxyMessageProvider=new ei(this.config.transports.proxyTransport.appPort),this.transport.messageProvider.add(this.transport.proxyMessageProvider)),null!=(i=this.config.transports)&&null!=(r=i.extensionTransport)&&r.enabled&&(this.transport.extensionMessageProvider=new ri(this.config.transports.extensionTransport.runtime),this.transport.messageProvider.add(this.transport.extensionMessageProvider)),null!=(a=this.config.transports)&&null!=(o=a.unrealTransport)&&o.enabled&&(this.transport.unrealMessageProvider=new hi(this.config.walletAppURL),this.transport.messageProvider.add(this.transport.unrealMessageProvider)),this.transport.messageProvider.register(),this.transport.allowProvider=gt((e=>{if("sequence_setDefaultNetwork"===e.method)return!0;const t=this.isConnected();if(!t)throw new Error("Sequence: wallet not connected");return t})),this.transport.networkProvider=vt((e=>this.networks&&0!==this.networks.length?this.networks.find((e=>e.isDefaultChain)).chainId:0)),this.transport.cachedProvider=new ft,this.transport.cachedProvider.onUpdate((()=>{this.session||(this.session={providerCache:{}}),this.session.providerCache=this.transport.cachedProvider.getCache(),this.saveSession(this.session)})),this.transport.router=new ct([yt,this.transport.networkProvider,this.transport.allowProvider,mt,this.transport.cachedProvider],this.transport.messageProvider),this.transport.provider=new As(this.transport.router),this.transport.messageProvider.on("open",(e=>{const{session:t}=e;t?this.useSession(t,!0):(this.session&&this.session.accountAddress&&this.transport.messageProvider.emit("disconnect"),this.clearSession())})),this.transport.messageProvider.on("accountsChanged",((e,t)=>{t?e.length>0&&this.useSession({accountAddress:e[0]},!0):e&&0!==e.length&&""!==e[0]?this.useSession({accountAddress:e[0]},!0):this.clearSession()})),this.transport.messageProvider.on("networks",(e=>{this.useSession({networks:e},!0)})),this.transport.messageProvider.on("walletContext",(e=>{this.useSession({walletContext:e},!0)})))},this.loadSession=async function(e){const t=await zs.getInstance().getItem("@sequence.session");if(t&&""!==t)try{const r=JSON.parse(t);if(r){if(void 0!==e){var n;const t="string"==typeof e?parseInt(e):e,s=n=>n.name===e||n.chainId===t,a=null==(n=r.networks)?void 0:n.find(s),o=null==a?void 0:a.isDefaultChain;if(r.networks&&a&&!o){const e=r.networks.map((e=>i({},e,{isDefaultChain:s(e)})));r.networks=Ye(e),r.providerCache=void 0}}s.useSession(r,!0)}return r}catch(e){return void Se.warn("loadSession failed, unable to parse session payload from storage.")}},this.connect=async function(e){if(!0===(null==e?void 0:e.refresh)&&s.disconnect(),s.isConnected()&&await s.isSiteConnected(null==e?void 0:e.origin)&&s.session&&(null==e||!e.authorize)&&(null==e||!e.askForEmail))return{connected:!0,session:s.session,chainId:t.ethers.utils.hexlify(await s.getChainId())};if(e&&e.authorize&&(!e.app||""===e.app))throw new Error("connecting with 'authorize' option also requires 'app' to be set");await s.openWallet(void 0,{type:"connect",options:e});const n=await s.transport.messageProvider.waitUntilConnected().catch((e=>e instanceof Error?{connected:!1,error:e.message}:{connected:!1,error:JSON.stringify(e)}));if(n.connected){if(!n.session)throw new Error("impossible state, connect response is missing session");s.useSession(n.session,!0),s.addConnectedSite(null==e?void 0:e.origin)}return n},this.authorize=async function(e){return s.connect(i({},e,{authorize:!0}))},this.getSession=()=>{if(this.isConnected())return this.session},this.getAddress=async function(){if(!s.isConnected())throw new Error("connect first");return s.getSession().accountAddress},this.getNetworks=async function(e){if(!s.isConnected()||!s.networks)throw new Error("connect first");if(e){const t=Ze(s.networks,e);return t?[t]:[]}return s.networks},this.getChainId=async function(){if(!s.networks||s.networks.length<1)throw new Error("networks have not been set by session. connect first.");const e=s.networks.find((e=>e.isDefaultChain));if(!e)throw new Error("networks must have a default chain specified");return e.chainId},this.getAuthChainId=async function(){if(!s.networks||s.networks.length<1)throw new Error("networks have not been set by session. connect first.");const e=s.networks.find((e=>e.isAuthChain));if(!e)throw new Error("networks must have an auth chain specified");return e.chainId},this.openWallet=async function(e,t,n){if("connect"!==(null==t?void 0:t.type)&&!s.isConnected())throw new Error("connect first");let i;return i=!s.networks||s.networks.length<1?s.config.defaultNetworkId:await s.getChainId(),s.transport.messageProvider.openWallet(e,t,n||i),await s.transport.messageProvider.waitUntilOpened(),!0},this.closeWallet=()=>{this.transport.messageProvider.closeWallet()},this.saveSession=async function(e){Se.debug("wallet provider: saving session");const t=JSON.stringify(e);await zs.getInstance().setItem("@sequence.session",t)},this.useSession=async function(e,t=!0){s.session||(s.session={}),s.config.walletContext?s.session.walletContext=s.config.walletContext:e.walletContext&&(s.session.walletContext=e.walletContext),e.accountAddress&&s.useAccountAddress(e.accountAddress),e.networks&&s.useNetworks(e.networks),e.providerCache?s.transport.cachedProvider.setCache(e.providerCache):s.transport.cachedProvider.clearCache(),t&&s.saveSession(s.session)},this.config=i({},pi),n&&(this.config=i({},this.config,n)),e?this.config.defaultNetworkId=e:this.config.defaultNetworkId||(this.config.defaultNetworkId="mainnet"),null!=n&&n.localStorage&&zs.use(n.localStorage),this.transport={},this.networks=[],this.providers={},this.connectedSites=new Zs("@sequence.connectedSites",[]),this.utils=new di(this),this.init()}async addConnectedSite(e){e=e||window.location.origin;const t=await this.connectedSites.get();if(t){if(t.includes(e))return;this.connectedSites.set([...t,e])}else this.connectedSites.set([e])}async removeConnectedSite(e){const t=await this.connectedSites.get();t&&this.connectedSites.set(t.filter((t=>t!==e)))}getConnectedSites(){return this.connectedSites.get()}async isSiteConnected(e){const t=await this.connectedSites.get();return!!t&&t.includes(e||window.location.origin)}disconnect(){this.isOpened()&&this.closeWallet(),this.clearSession()}getProviderConfig(){return this.config}isOpened(){return this.transport.messageProvider.isOpened()}isConnected(){return void 0!==this.session&&void 0!==this.session.networks&&this.session.networks.length>0&&void 0!==this.networks&&this.networks.length>0&&!!this.session.accountAddress&&this.session.accountAddress.startsWith("0x")}getProvider(e){if(!this.isConnected()){if(e)throw new Error("session is empty. connect and try again.");return this.transport.provider}let n,s=this.networks.find((e=>e.isDefaultChain));if(e&&(s=Ze(this.networks,e),!s))throw new Error(`network ${e} is not in the network list`);if(this.providers[s.chainId])return this.providers[s.chainId];const i=s.provider?s.provider:new t.providers.JsonRpcProvider(s.rpcUrl,s.chainId);if(s.isDefaultChain){const e=new ct([yt,mt,new wt({accountAddress:this.session.accountAddress,walletContext:this.session.walletContext}),new Ct(this.transport.provider),this.transport.cachedProvider],new pt(i));n=new As(e,s.chainId)}else{const e=new ct([yt,mt,new wt({accountAddress:this.session.accountAddress,walletContext:this.session.walletContext,chainId:s.chainId}),new Ct(this.transport.provider),new ft(s.chainId)],new pt(i));n=new As(e,s.chainId)}return this.providers[s.chainId]=n,n}async getAuthProvider(){return this.getProvider((await this.getAuthNetwork()).chainId)}async getAuthNetwork(){return(await this.getNetworks()).find((e=>e.isAuthChain))}getAllProviders(){return this.providers}getSigner(e){return this.getProvider(e).getSigner()}async getAuthSigner(){return(await this.getAuthProvider()).getSigner()}getWalletConfig(e){return this.getSigner().getWalletConfig(e)}getWalletState(e){return this.getSigner().getWalletState(e)}getWalletContext(){return this.getSigner().getWalletContext()}isDeployed(e){return this.getSigner(e).isDeployed()}on(e,t){this.transport.messageProvider.on(e,t)}once(e,t){this.transport.messageProvider.once(e,t)}useAccountAddress(e){this.session||(this.session={}),this.session.accountAddress=t.ethers.utils.getAddress(e)}useNetworks(e){if(this.session||(this.session={}),this.session.networks=e,this.session.networks&&0!==this.session.networks.length)if(this.config.networks||this.config.networkRpcUrl){if(this.networks=e,this.config.networks&&(this.networks=e.map((e=>i({},e))),this.config.networks.forEach((e=>{const t=Ze(this.networks,e.chainId||e.name);t&&Ke(e,t)})),Je(this.networks,!0)),this.config.networkRpcUrl){const e=this.networks.find((e=>e.isDefaultChain));e&&(e.rpcUrl=this.config.networkRpcUrl)}}else this.networks=e}clearSession(){var e;Se.debug("wallet provider: clearing session"),zs.getInstance().removeItem("@sequence.session"),this.session=void 0,this.networks=[],this.providers={},null==(e=this.transport.cachedProvider)||e.clearCache()}}const pi={walletAppURL:"https://sequence.app",transports:{windowTransport:{enabled:!0},proxyTransport:{enabled:!1}}};let gi;const fi=async(e,t)=>(gi&&gi.isOpened()&&gi.closeWallet(),gi=new ui(e,t),await gi.loadSession(e),gi),wi=()=>{if(!gi)throw new Error("Wallet has not been initialized, call sequence.initWallet(network, config) first.");return gi};var mi=Object.freeze({__proto__:null,PROVIDER_OPEN_TIMEOUT:ks,nextMessageIdx:Is,BaseProviderTransport:Ns,BaseWalletTransport:Qs,ProxyMessageChannel:class{constructor(){this.app=void 0,this.wallet=void 0;const e=new Xs,t=new Xs;e.conn=t,t.conn=e,this.app=e,this.wallet=t}},ProxyMessageChannelPort:Xs,ProxyMessageProvider:ei,ProxyMessageHandler:class extends Qs{constructor(e,t){super(e),this.port=void 0,this.port=t,this._init=Cs.OK}register(){this.port.handleMessage=e=>{this.handleMessage(e)},this._registered=!0}async restoreSession(){const e=await this.getCachedTransportSession();e&&this.open(e)}unregister(){this.port.handleMessage=void 0,this._registered=!1}sendMessage(e){this.port.sendMessage(e)}},MuxMessageProvider:ti,WindowMessageProvider:si,WindowMessageHandler:class extends Qs{constructor(e){var t;super(e),t=this,this.parentWindow=void 0,this._isPopup=!1,this.onWindowEvent=async function(e){if(!e.origin||""===e.origin)return;if(t.appOrigin&&e.origin!==t.appOrigin)return;let n;try{n=JSON.parse(e.data)}catch(e){return}Se.debug("RECEIVED MESSAGE",n),t._init!==Cs.OK&&t.isValidInitAck(n)&&(t.appOrigin=e.origin),t._init!==Cs.OK||t.appOrigin&&!(t.appOrigin.length<8)?t.handleMessage(n):Se.error("impossible state, init.OK and appOrigin required")},this.getWindowTransportSession=e=>{const t=new ys(e);return{sessionId:t.get("sid"),networkId:t.get("net"),intent:me(t.get("intent"))}},this._init=Cs.NIL}async register(e){const t=null!==parent.window.opener;if(this._isPopup=t,!0!==t)return;const{pathname:n,search:s}=new URL(e||window.location.href);let i=this.getWindowTransportSession(s);!!i.sessionId||(i=await this.getCachedTransportSession()),i?(this.parentWindow=parent.window.opener,window.addEventListener("message",this.onWindowEvent,!1),this._registered=!0,this.open(i).then((e=>{if(!e){var t;const e=`failed to open to network ${null==(t=i)?void 0:t.networkId}`;Se.error(e),this.notifyClose({message:e}),window.close()}})).catch((e=>{var t;const n=`failed to open to network ${null==(t=i)?void 0:t.networkId}, due to: ${e}`;Se.error(n),this.notifyClose({message:n}),window.close()}))):Se.error("window session is undefined")}unregister(){window.removeEventListener("message",this.onWindowEvent),this._registered=!1}sendMessage(e){const t=JSON.stringify(e);e.type===vs.INIT?this.postMessage(t,!0):this.postMessage(t)}get isPopup(){return this._isPopup}postMessage(e,t=!1){!0===t||this._init===Cs.OK?t?this.parentWindow.postMessage(e,"*"):this.appOrigin&&this.appOrigin.length>4?this.parentWindow.postMessage(e,this.appOrigin):Se.error("unable to postMessage as parentOrigin is invalid"):Se.error("impossible state, should not be calling postMessage until inited")}},WalletRequestHandler:Ts,CHANNEL_ID:ii,ExtensionMessageHandler:class extends Qs{constructor(e,t){super(e),this.runtime=t,this.port=void 0,this._init=Cs.OK}register(){this._registered=!0,this.port=this.runtime.connect({name:ii})}sendMessage(e){Se.info("[ExtensionMessageHandler send]",e),this.port.postMessage(e)}},ExtensionMessageProvider:ri,BaseInjectedTransport:ai,UnrealMessageProvider:hi,UnrealMessageHandler:class extends Qs{constructor(e){super(e),this.onMessageFromUnreal=e=>{Se.debug("RECEIVED MESSAGE",e),this.handleMessage(e)},this.getUnrealTransportSession=e=>{const t=new ys(e);return{sessionId:t.get("sid"),networkId:t.get("net"),intent:me(t.get("intent"))}},this._init=Cs.NIL}async register(e){var t;if(void 0===(null==(t=window.ue)?void 0:t.sequencewallettransport))return;oi("wallet");const{search:n}=new URL(e||window.location.href);let s=this.getUnrealTransportSession(n);!!s.sessionId||(s=await this.getCachedTransportSession()),s?(window.ue.sequencewallettransport.onmessagefromsequencejs=this.onMessageFromUnreal,this._registered=!0,this.open(s).then((e=>{if(!e){var t;const e=`failed to open to network ${null==(t=s)?void 0:t.networkId}`;Se.error(e),this.notifyClose({message:e}),window.close()}})).catch((e=>{var t;const n=`failed to open to network ${null==(t=s)?void 0:t.networkId}, due to: ${e}`;Se.error(n),this.notifyClose({message:n}),window.close()}))):Se.error("unreal session is undefined")}unregister(){var e,t;(null==(e=window.ue)||null==(t=e.sequencewallettransport)?void 0:t.onmessagefromsequencejs)===this.onMessageFromUnreal&&delete window.ue.sequencewallettransport.onmessagefromsequencejs,this._registered=!1}sendMessage(e){var t,n;if(e.type!==vs.INIT&&this._init!==Cs.OK)return void Se.error("impossible state, should not be calling postMessage until inited");const s=JSON.stringify(e);console.log("sending message to dapp",s),null==(t=window.ue)||null==(n=t.sequencewallettransport)||n.sendmessagetosequencejs(s)}},WindowSessionParams:ys,get EventType(){return vs},get OpenState(){return bs},get InitState(){return Cs},ProviderError:Es,ErrSignedInRequired:_s,Wallet:ui,DefaultProviderConfig:pi,initWallet:fi,getWallet:wi,Web3Provider:As,isSequenceProvider:Os,LocalWeb3Provider:class extends As{constructor(e,t){super(new Ts(e,null,null,t||[]))}},Web3Signer:Ps,messageToBytes:Bs,prefixEIP191Message:Fs,isValidSignature:Gs,isValidMessageSignature:js,isValidTypedDataSignature:$s,recoverWalletConfig:Hs,isBrowserExtension:Vs,isUnityPlugin:Js,isWalletUpToDate:Ks,LocalStorage:zs,LocalStore:Zs}),yi=Object.freeze({__proto__:null,RpcRelayerProto:Hn,isLocalRelayerOptions:function(e){return void 0!==e.signer&&t.Signer.isSigner(e.signer)},LocalRelayer:class extends Dn{constructor(e){if(super(t.Signer.isSigner(e)?{provider:e.provider}:i({},e,{provider:e.signer.provider})),this.signer=void 0,this.txnOptions=void 0,this.signer=t.Signer.isSigner(e)?e:e.signer,!this.signer.provider)throw new Error("Signer must have a provider")}async deployWallet(e,n){const s=this.prepareWalletDeploy(e,n);return this.signer.sendTransaction(i({},s,{gasLimit:t.ethers.constants.Two.pow(17)}))}async getFeeOptions(e,t,...n){return{options:[]}}async gasRefundOptions(e,t,...n){const{options:s}=await this.getFeeOptions(e,t,...n);return s}setTransactionOptions(e){this.txnOptions=e}async relay(e,s,r=!0){if(void 0!==s&&Se.warn("LocalRelayer doesn't accept fee quotes"),!e.context.guestModule||42!==e.context.guestModule.length)throw new Error("LocalRelayer requires the context.guestModule address");const{to:a,execute:o}=await this.prependWalletDeploy(e),c=new t.ethers.utils.Interface(n.mainModule.abi),l=c.encodeFunctionData(c.getFunction("execute"),[bn(o.transactions),o.nonce,o.signature]),h=this.signer.sendTransaction(i({to:a,data:l},this.txnOptions));if(r){const e=await h;return e.receipt=await e.wait(),e}return h}},isBaseRelayerOptions:function(e){return void 0!==e.bundleCreation&&"boolean"==typeof e.bundleCreation||void 0!==e.creationGasLimit&&We(e.creationGasLimit)||void 0!==e.provider&&(t.providers.Provider.isProvider(e.provider)||"string"==typeof e.provider)},BaseRelayerDefaults:Rn,BaseRelayer:Mn,ProviderRelayerDefaults:Un,isProviderRelayerOptions:function(e){return void 0!==e.provider&&t.providers.Provider.isProvider(e.provider)},ProviderRelayer:Dn,proto:Hn,isRpcRelayerOptions:Kn,RpcRelayer:zn,isRelayer:Yn}),vi=Object.freeze({__proto__:null,MetaTransactionsType:ln,packMetaTransactionsData:function(...e){const t=vn(...e);if(void 0===t)throw new Error("Encoding transactions without defined nonce");return hn(t,...e)},packMetaTransactionsNonceData:hn,digestOfTransactions:dn,digestOfTransactionsNonce:un,computeMetaTxnHash:pn,toSequenceTransactions:gn,flattenAuxTransactions:fn,toSequenceTransaction:wn,isAsyncSendable:function(e){return e.send||e.sendAsync},isSequenceTransaction:mn,hasSequenceTransactions:yn,readSequenceNonce:vn,sequenceTxAbiEncode:bn,appendNonce:Cn,makeExpirable:En,makeAfterNonce:_n,encodeNonce:kn,decodeNonce:Sn,isSignedTransactions:In,fromTransactionish:Nn}),bi=Object.freeze({__proto__:null,isValidSignature:Gs,isValidMessageSignature:js,isValidTypedDataSignature:$s,recoverWalletConfig:Hs,isWalletUpToDate:Ks,base64Encode:e=>G(e,!0),base64EncodeObject:we,base64Decode:e=>{if(null!=e)return j(e)},base64DecodeObject:me,encodeMessageDigest:ye,packMessageData:ve,subDigestOf:be,isNode:Ce,isBrowser:()=>!0,jwtDecodeClaims:Ee,Logger:ke,logger:Se,configureLogger:e=>Se.configure(e),promisify:Ie,getRandomInt:Ne,queryStringFromObject:function(e,t){return`${encodeURIComponent(e)}=${encodeURIComponent(JSON.stringify(t))}`},queryStringToObject:function(e){const t=e.split("&"),n={};for(const e of t){const t=e.split("=");n[decodeURIComponent(t[0])]=JSON.parse(decodeURIComponent(t[1]))}return n},sanitizeNumberString:Te,sanitizeAlphanumeric:xe,sanitizeHost:Ae,sleep:e=>new Promise((t=>{const n=setTimeout((()=>{clearTimeout(n),t()}),e)})),encodeTypedDataHash:Oe,encodeTypedDataDigest:Pe,defineReadOnly:Re,getStatic:Me,resolveProperties:Le,checkProperties:Ue,shallowCopy:De,deepCopy:qe,urlClean:e=>e.replace(/([^:]\/)\/+/g,"$1"),isBigNumberish:We}),Ci=Object.freeze({__proto__:null,abi:s,api:u,auth:hs,config:ds,guard:us,indexer:ps,metadata:gs,multicall:fs,network:ws,provider:mi,relayer:yi,transactions:vi,utils:bi,initWallet:fi,getWallet:wi,Wallet:ui});e.Wallet=ui,e.getWallet=wi,e.initWallet=fi,e.sequence=Ci,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=0xsequence.umd.min.js.map
